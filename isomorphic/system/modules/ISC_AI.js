/*

  SmartClient Ajax RIA system
  Version v14.1p_2025-06-14/EVAL Development Only (2025-06-14)

  Copyright 2000 and beyond Isomorphic Software, Inc. All rights reserved.
  "SmartClient" is a trademark of Isomorphic Software, Inc.

  LICENSE NOTICE
     Use of this software is governed by a contract between your organization
     and Isomorphic Software.  Do not use or deploy this software unless you
     are familiar with the terms of this agreement and have verified that you
     have rights to do so.

  PROPRIETARY & PROTECTED MATERIAL
     This software contains proprietary materials that are protected by
     contract and intellectual property law. YOU ARE EXPRESSLY PROHIBITED
     FROM ATTEMPTING TO REVERSE ENGINEER THIS SOFTWARE OR MODIFY THIS
     SOFTWARE FOR HUMAN READABILITY.

  CONTACT ISOMORPHIC
     For more information regarding license rights and restrictions, or to
     report possible license violations, please contact Isomorphic Software
     by email (licensing@isomorphic.com) or web (www.isomorphic.com).

*/

if(window.isc&&window.isc.module_Core&&!window.isc.module_AI){isc.module_AI=1;isc._moduleStart=isc._AI_start=(isc.timestamp?isc.timestamp():new Date().getTime());if(isc._moduleEnd&&(!isc.Log||(isc.Log&&isc.Log.logIsDebugEnabled('loadTime')))){isc._pTM={message:'AI load/parse time: '+(isc._moduleStart-isc._moduleEnd)+'ms',category:'loadTime'};if(isc.Log&&isc.Log.logDebug)isc.Log.logDebug(isc._pTM.message,'loadTime');else if(isc._preLog)isc._preLog[isc._preLog.length]=isc._pTM;else isc._preLog=[isc._pTM]}isc.definingFramework=true;isc.defineClass("InternalAIMessagesBuilder").addProperties({init:function(){this.Super("init",arguments);this.aiMessages=[]},appendPrompt:function(_1){if(_1=="${userMessages}"){this.aiMessages.addList(this.userMessages.map(function(_2){return{source:"user",content:_2.content,type:_2.type}}))}else{this.aiMessages.add({source:"system",content:_1.evalDynamicString(this.target,this.evalVars)})}},appendPrompts:function(_1){if(!isc.isAn.Array(_1)){this.appendPrompt(_1);return}
for(var i=0;i<_1.length;++i){this.appendPrompt(_1[i])}}});isc.defineClass("InternalAIMessagesBuilder2").addProperties({messagesSource:"user",init:function(){this.Super("init",arguments);this.aiMessages=[]},appendPrompt:function(_1){if(_1=="${ssMessages}"){var _2=this.messagesSource;this.aiMessages.addList(this.ssMessages.map(function(_3){return{source:_2,content:_3.content,type:_3.type}}))}else{this.aiMessages.add({source:"system",content:_1.evalDynamicString(this.target,this.evalVars)})}},appendPrompts:function(_1){if(!isc.isAn.Array(_1)){this.appendPrompt(_1);return}
for(var i=0;i<_1.length;++i){this.appendPrompt(_1[i])}}});isc.defineClass("AIEngine").addClassProperties({defaultHistoryIntroduction:"You have previously interacted with the user as follows. Each prior message from the user is delineated by ^^^^^^^ both before and after their message. Your responses are delineated by ####### both before and after your message.",defaultHistoryConclusion:"That is the end of your previous interaction with the user. You are now to respond to the following.",defaultHistoryDelimiters:{"system":"\n\n","user":"^^^^^^^\n","AI":"#######\n"},$272z:function(_1){return _1==null||_1=="text"},$2720:function(_1){return _1=="jpegImage"||_1=="pngImage"},isImageMessage:function(_1){return this.$2720(_1.type)},$269b:function(_1){this.$102q(this.isImageMessage(_1));return _1.type=="jpegImage"?"image/jpeg":"image/png"},containsImageMessage:function(_1){if(_1!=null){for(var i=0;i<_1.length;++i){if(this.isImageMessage(_1[i])){return true}}}
return false},isVisionRequest:function(_1){if(this.containsImageMessage(_1.messages)){return true}
return false},cloneAIRequest:function(_1){var _2=isc.addPropertiesWithAssign({},_1);delete _2.$260u;if(isc.isAn.Array(_2.messages)){_2.messages=_2.messages.duplicate()}
return _2}});isc.A=isc.AIEngine.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$258j=[];isc.A.recordPickingBatchTimeout=20000;isc.A.fieldPagingPrompts=["A user is interacting with an Isomorphic SmartClient web application.\nThey wish to take the following action - \"${actionDescription}\" - on a data-bound component (such as a ListGrid) based on the following query prompt:","${userMessages}","The dataSource the component is bound to has a large number of fields, many of which are unlikely to be relevant to the action being performed.\nThe objects in the source-array below represent a subset of these available fields.Using the properties on each field object for the dataSource and your own knowledge, determine which fields are relevant to the user-supplied query prompt.\nFor example, if the query was 'amount is larger than 100', you should look for a field with a name, title or description most related to 'amount'. Note that the user may not use the exact field name or title in their query. For example if the user refers to 'amount' they may be referring to 'quantity', 'price', 'cost' or similar fields. Please return all field objects that could be relevant.\n\nYour response should be an object serialized in JSON format with a single property called 'result'. This property should be set to an array of integers, where each integer is the index of a matching record in the source-array below.  For example, if the first field object in the array below may be relevant to the user's query, your response array must include its source-array index (0) as the first entry.  Similarly, the source-array indices of any other matching field objects must also be in your response array.\n\nIf a field object is not relevant to the query prompt, do not include its index in your response array.\n\nIf no field objects are relevant, the 'result' property in your response object should be set to an empty array.\n\nApart from this object, your response must not include any other preamble or content of any kind."];isc.A.$50a=[null,"text","number","object","array"];isc.A.requestOperationId="createChatCompletion";isc.B.push(isc.A.getRecordsPerPrompt=function isc_AIEngine_getRecordsPerPrompt(_1,_2,_3){this.$102q(isc.isAn.Array(_1));var _4=_1;_2=_2||0;_3=_3||{};_3.startIndex=_3.startIndex||0;var _5={};_5.fixedTokens=isc.isA.Number(parseInt(_2))?parseInt(_2):this.estimateTokenCount(_2);if(_3.responseTokensPerRecord){_5.responseTokensPerRecord=_3.responseTokensPerRecord}
var _6={};_6.totalRecords=_4.length;_6.startIndex=_3.startIndex;_6.numRecords=0;_6.exactNumRecords=0;_6.variance=1;var _7=[];_6.engineId=this.engineId;var _8=this.tokenLimit-_5.fixedTokens;var _9=0;var _10=_3.serializationFormat||this.serializationFormat;var _11=_10!="csv";var _12=_10=="compactJSON";var _13=(_12?",":(_11?",\n":"\n"));for(var i=_3.startIndex;i<_4.length;i++){var _15=_4[i];var _16={};_16.record=isc.AI.serializeIndexedRecord(_15,i,_3);_16.tokenCount=this.estimateTokenCount(_16.record+_13);if(_6.numRecords==0||_8>=_16.tokenCount){_7.add(_16);_6.numRecords++;_6.exactNumRecords=_6.numRecords;_9+=_16.tokenCount;_8-=_16.tokenCount;if(_8<0){_6.status="The number of fixed tokens already exceeds the token limit.";_6.exactNumRecords=0;break}}else{var _17=_16.tokenCount-_8;_6.exactNumRecords=_6.numRecords+(_17/_16.tokenCount);break}
if(_3.aiPageSize&&_6.numRecords>=_3.aiPageSize){break}}
_5.totalTokens=_9;_5.minTokens=_7.getProperty("tokenCount").min();_5.maxTokens=_7.getProperty("tokenCount").max();_5.avgTokens=Math.ceil(_7.getProperty("tokenCount").sum()/_6.numRecords);_5.remainingTokens=_8;_6.variance=_5.maxTokens/_5.minTokens;_6.tokenStats=_5;_6.serializedForm=_7;return _6},isc.A.getBatches=function isc_AIEngine_getBatches(_1,_2,_3){this.$102q(isc.isAn.Array(_2));_3=_3||{};var _4=isc.AI.getFormatDescription(_3);_1=isc.AIEngine.cloneAIRequest(_1);if(!_1.messages)_1.messages=[];_1.messages.push({source:"system",content:_4});var _5=_1.messages.length-1;var _6=this.estimateRequestTokenCount(_1);if(_3.aiPageSize==0)_3.aiPageSize=null;var _7=[];for(var i=0,_9=_2.length;i<_9;){var _10=isc.addPropertiesWithAssign({},_3);_10.startIndex=i;var _11=this.getRecordsPerPrompt(_2,_6,_10);this.$102q(_11.numRecords>0);var _12=_11.serializedForm.getProperty("record");this.$102q(_12.length==_11.numRecords);var _13=isc.AIEngine.cloneAIRequest(_1);_13.messages[_5]={source:"system",content:_4+isc.AI.$2590(_12,_3)};_7.push({aiRequest:_13,startIndex:i,length:_11.numRecords,$270e:_4,$270f:_12,$270g:_3});i+=_11.numRecords}
return _7},isc.A.splitBatch=function isc_AIEngine_splitBatch(_1){this.$102q(_1.length>=2);var _2=_1.startIndex,_3=_1.length>>1,_4=_1.startIndex+_3,_5=_1.length-_3;this.$102q(_3>=1&&_5>=1);var _6=_1.aiRequest,_7=_6.messages.length-1,_8=_1.$270e,_9=_1.$270g;var _10=_1.$270f.slice(0,_3),_11=isc.AIEngine.cloneAIRequest(_6);this.$102q(_10.length==_3);_11.messages[_7]={source:"system",content:_8+isc.AI.$2590(_10,_9)};var _12=_1.$270f.slice(_3),_13=isc.AIEngine.cloneAIRequest(_6);this.$102q(_12.length==_5);_13.messages[_7]={source:"system",content:_8+isc.AI.$2590(_12,_9)};return[{aiRequest:_11,startIndex:_2,length:_3,$270e:_8,$270f:_10,$270g:_9},{aiRequest:_13,startIndex:_4,length:_5,$270e:_8,$270f:_12,$270g:_9}]},isc.A.doPageRecordsPicking=function isc_AIEngine_doPageRecordsPicking(_1,_2,_3,_4){_4=_4||{};var _5=this;var _6=this.$258j;var _7={id:"aiTransaction_"+_6.length,engineId:this.engineId,postProcessCallback:_3,progressCallback:_4.progressCallback,batches:[],results:[]};_6.add(_7);var _8=_4.cancellationController,_9=isc.CancellationController.create();var _10=_2;if(_10.localData)_10=_10.localData;var _11=function(_7){_6.remove(_7);var _12=[];for(var i=0;i<_7.batches.length;i++){var _14=_7.batches[i];if(_4.keepEmptyMatches){_5.$102q(_14.result.getLength()==_14.length);_12.addList(_14.result)}else{for(var j=0;j<_14.result.length;j++){var _16=_14.result[j];var _17=_10.get(_16);if(_17==null){_5.logWarn("Unable to find match for index in data: "+_16,"AI")}else{_12.add(_17)}}}}
_5.logDebug("Completing AI Transaction "+_7.id+", with "+_7.batches.length+" batches covering "+_10.length+" total records, and "+_12.length+" matches","AI");_5.fireCallback(_7.postProcessCallback,"matches,batches",[_12,_7.batches])};if(!isc.isAn.Array(_10)||_10.length<=0){this.delayCall("fireCallback",[_11,"transaction",[_7]]);return _7}
var _18=0;var _19=function(_7,_14){_5.logDebug("Adding batch "+_14.batchId+" to AI-transaction "+_7.id,"AI");_7.batches.add(_14);var _20=_14.aiRequest;_5.sendRequest(_20,function(_29){_18+=_14.length;var _21;if(_29.type!="success"){_21=[];_14.nonSuccessfulResult=_29}else{_21=_29.message&&_29.message.content&&_29.message.content.result;if(!isc.isAn.Array(_21))_21=[_21]}
if(_4.keepEmptyMatches){while(_21.length<_14.length){_21.push(isc.AI.invalidSummaryValue)}
if(_21.length>_14.length)_21.setLength(_14.length)}else{_21.removeEmpty()}
_14.result.addList(_21);_7.results.addList(_21);_14.executing=0;var _12=_7.results.length;if(_7.progressCallback){var _22=_8&&_8.canceled,_23=_7.progressCallback(_18,_10.length,_12),_24=!_22&&_23!==false;if(!_24){var _25=_22?_8.cancellationReason:"progressCallback() returned `false`.";if(!_9.canceled){_9.cancel(_25,"application")}
_5.logDebug("doPageRecordsPicking() transaction "+_7.id+" was canceled by the progressCallback.","AI");return}}
if(_7.batches.getProperty("executing").sum()==0){_11(_7)}},{showPrompt:false,ignoreTokenLimit:true,requestProperties:{timeout:this.recordPickingBatchTimeout},maxRetries:_4.maxRetries})};var _26={messages:_1,responseType:"object",cancellationController:_9};var _27=this.getBatches(_26,_10,_4);for(var _28=0;_28<_27.length;++_28){var _14=_27[_28];isc.addPropertiesWithAssign(_14,{batchId:_28,range:[_14.startIndex,_14.startIndex+_14.length-1],executing:1,result:[]});_19(_7,_14)}
return _7},isc.A.shouldUseAIFieldPaging=function isc_AIEngine_shouldUseAIFieldPaging(_1,_2,_3){if(!isc.AI.useAIFieldPaging)return false;var _4={engineId:this.engineId,fieldNames:_3.salientFieldAttributes||isc.AI.salientFieldAttributes,serializationFormat:_3.serializationFormat};var _5=this.estimateRequestTokenCount(_1);var _6=this.getRecordsPerPrompt(_2,_5,_4);return(_6.totalRecords>_6.numRecords)},isc.A.retrieveFieldsForPrompt=function isc_AIEngine_retrieveFieldsForPrompt(_1,_2,_3,_4,_5,_6){var _7=isc.InternalAIMessagesBuilder.create({userMessages:_1,target:this,evalVars:{actionDescription:_2}});_7.appendPrompts(this.fieldPagingPrompts);_5=_5||{};var _8=_5.progressCallback;var _9=_5.aiPageSize;if(_9==0)_9=null;var _10=_6&&_6.salientFieldAttributes;if(_10==null)_10=isc.AI.salientFieldAttributes;var _11={engineId:this.engineId,fieldNames:_10,aiPageSize:_9,progressCallback:_8};this.doPageRecordsPicking(_7.aiMessages,_3,function(_12){isc.AI.fireCallback(_4,"finalFields",[_12])},_11)},isc.A.asyncRetrieveFieldsForPrompt=function isc_AIEngine_asyncRetrieveFieldsForPrompt(_1,_2,_3,_4,_5){var _6=Promise.withResolvers();this.retrieveFieldsForPrompt(_1,_2,_3,function(_7){_6.resolve(_7)},_4,_5);return _6.promise},isc.A.estimateTokenCount=function isc_AIEngine_estimateTokenCount(_1){_1=_1||"";var _2=_1.trim().split(/\s/);var _3=3;var _4=0;for(var i=0;i<_2.length;i++){var _6=_2[i].split(/\W/);_4+=_6.length-1;for(var _7=0;_7<_6.length;_7++){_4+=Math.max(1,_6[_7].length/_3)}}
return Math.ceil(_4)},isc.A.estimateMessageTokenCount=function isc_AIEngine_estimateMessageTokenCount(_1){if(_1.type=="jpegImage"||_1.type=="pngImage"){return 1000}
var _2=_1.content;if((_1.type=="array"||_1.type=="object")&&!isc.isA.String(_2)&&isc.isAn.Object(_2))
{_2=isc.AI.$260x(_2)}
return this.estimateTokenCount(String(_2))},isc.A.estimateRequestTokenCount=function isc_AIEngine_estimateRequestTokenCount(_1){_1=this.normalizeRequest(_1);this.$102q(_1.prompt==null);var _2=this.makePromptText(_1);return this.estimateTokenCount(_2)},isc.A.getTokenLimit=function isc_AIEngine_getTokenLimit(_1){return this.tokenLimit},isc.A.couldSupportRequest=function isc_AIEngine_couldSupportRequest(_1){_1=this.normalizeRequest(_1);if(!this.$50a.contains(_1.responseType)){return false}
var _2=_1.messages;if(_2!=null){for(var i=0;i<_2.length;++i){var _4=_2[i];if(!this.$50a.contains(_4.type)){return false}}}
var _5=this.estimateRequestTokenCount(_1);if(_5>this.getTokenLimit(_1)){return false}
return true},isc.A.canSupportVisionRequests=function isc_AIEngine_canSupportVisionRequests(){return false},isc.A.sendRequest=function isc_AIEngine_sendRequest(_1,_2,_3){_3=isc.addProperties({retryIndex:0},_3);var _4=this.transformRequest(_1,_3);this.handleSendRequest(_4,_1,_2,_3)},isc.A.asyncSendRequest=function isc_AIEngine_asyncSendRequest(_1,_2){if(_1.cancellationController&&_1.cancellationController.canceled){return Promise.reject(_1.cancellationController.asCanceledResult())}
var _3=Promise.withResolvers();this.sendRequest(_1,function(_4){if(_4.type=="success")_3.resolve(_4);else _3.reject(_4)},_2);return _3.promise},isc.A.normalizeRequest=function isc_AIEngine_normalizeRequest(_1){if(_1.$260u)return _1;var _2=_1.messages;var _3=false;var _4=function(){_1=isc.addProperties({},_1);_2=_1.messages=(_2==null?null:_2.duplicate());_3=true}
if(_2!=null){for(var i=0;i<_2.length;++i){var _6=_2[i],_7=false;if(_6.source==null||(_6.source!="system"&&_6.source!="user"&&_6.source!="AI"))
{if(_6.source!=null){this.logWarn("Unrecognized AIMessageSource '"+_6.source+"'. Changing to 'user'","AI")}
if(!_3)_4();if(!_7){_6=_2[i]=isc.addProperties({},_6);_7=true}
_6.source="user"}
if(_6.type=="number"&&!isc.isA.String(_6.content)){if(!_3)_4();if(!_7){_6=_2[i]=isc.addProperties({},_6);_7=true}
_6.content=String(_6.content);delete _6.type}
if((_6.type=="object"||_6.type=="array")&&!isc.isA.String(_6.content)&&isc.isAn.Object(_6.content))
{if(!_3)_4();if(!_7){_6=_2[i]=isc.addProperties({},_6);_7=true}
_6.content=isc.AI.$260x(_6.content);delete _6.type}}}
if(_1.prompt!=null){if(!_3)_4();_1.$260n=_1.prompt;if(_2==null){_2=_1.messages=[]}
_2.push({source:"user",content:_1.prompt});delete _1.prompt}
if(_1.responseType=="number"){if(!_3)_4();if(_2==null){_2=_1.messages=[]}
var _8="Your response must only be a number";if(_1.responseMinimum!=null){if(_1.responseMaximum!=null){_8+=(" between "+_1.responseMinimum+" and "+_1.responseMaximum+" inclusive.")}else{_8+=" at least "+_1.responseMinimum+"."}}else if(_1.responseMaximum!=null){_8+=" no more than "+_1.responseMaximum+"."}else{_8+="."}
_2.push({source:"system",content:_8});delete _1.responseType}
if(_1.responseType=="array"||_1.responseType=="object"){var _9=false;if(_2!=null){for(var i=0;i<_2.length;++i){var _6=_2[i];if(isc.AIEngine.$272z(_6.type)&&/JSON/i.test(_6.content))
{_9=true;break}}}
if(!_9){if(!_3)_4();if(_2==null){_2=_1.messages=[]}
_2.push({source:"system",content:"Your response must only be a JSON "+_1.responseType+"."})}}
_1.$260u=true;return _1},isc.A.getTemperature=function isc_AIEngine_getTemperature(_1){return(_1&&_1.temperature!=null?_1.temperature:this.temperature)},isc.A.makeNonTextPromptPart=function isc_AIEngine_makeNonTextPromptPart(_1){return"*non-text content*\n"},isc.A.makePromptParts=function isc_AIEngine_makePromptParts(_1){_1=this.normalizeRequest(_1);this.$102q(_1.prompt==null);var _2=isc.addProperties({},isc.AIEngine.defaultHistoryDelimiters,_1.historyDelimiters);var _3=[],_4=_1.messages;var _5=(function(_15){this.$102q(_3.length>0);var _6=_3[_3.length-1];if(!isc.isA.String(_6))return true;return _6.endsWith(_15)}).bind(this);var _7=function(_15){if(isc.isA.String(_15)&&_3.length>0&&isc.isA.String(_3[_3.length-1]))
{_3[_3.length-1]+=_15}else{_3.push(_15)}};if(_4!=null){var _8=(function(_14){if(_3.length>0){var _9=String(_2["system"]);if(_14.source=="system"&&!_5(_9)){_7(_9)}else if(!_5('\n')){_7("\n")}}
if(!isc.AIEngine.$272z(_14.type)){_7(this.makeNonTextPromptPart(_14))}else{_7(String(_14.content))}}).bind(this);var _10=0;for(;_10<_4.length;++_10){var i=_10;if(_4[i].source!="system"){break}
_8(_4[i])}
var i=_10,_12=_4.length;for(;_12>i&&_4[_12-1].source=="system";--_12){}
if(i<_12){var _13=_4[_12-1].source;this.$102q(_13!="system");for(;_12-1>i&&(_4[_12-1-1].source=="system"||_4[_12-1-1].source==_13);--_12)
{}}
if(i<=_12-2){_8({source:"system",content:(_1.historyIntroduction!=null?_1.historyIntroduction:isc.AIEngine.defaultHistoryIntroduction)});for(;i<_12-1;++i){var _14=_4[i],_9=String(_2[_14.source||"user"]);if(_14.source!="system"){if(_3.length>0&&!_5("\n"))_7("\n");_7(_9)}
_8(_14);if(_14.source!="system"){if(_3.length>0&&!_5("\n"))_7("\n");_7(_9)}}
_8({source:"system",content:(_1.historyConclusion!=null?_1.historyConclusion:isc.AIEngine.defaultHistoryConclusion)})}
for(;i<_4.length;++i){_8(_4[i])}}
return _3},isc.A.makePromptText=function isc_AIEngine_makePromptText(_1){var _2=this.makePromptParts(_1);return _2.join("")},isc.A.transformRequest=function isc_AIEngine_transformRequest(_1,_2){_1=this.normalizeRequest(_1);var _3=this.makePromptText(_1);if(!_2.ignoreTokenLimit&&this.tokenLimit!=null){var _4=this.estimateTokenCount(_3);if(_4>this.tokenLimit){this.logWarn("Approximate token count for prompt text is: "+_4+". This exceeds the token limit for the ai engine: "+this.name+". This request may be rejected by the AI server (proceeding anyway).","AI")}else{this.logDebug("Estimated token count for prompt is: "+_4,"AI")}}
return{engineId:this.engineId,model:this.model,temperature:this.getTemperature(_1),text:_3}},isc.A.getDataSourceName=function isc_AIEngine_getDataSourceName(_1){return this.dataSourceName||isc.AI.dataSourceName},isc.A.$2500=function isc_AIEngine__getDataSource(_1,_2,_3,_4){var _5=isc.AI.$2500(this.engineId,_2),_6=this.getDataSourceName(_2);if(_5==null&&_6){if(isc.AI.autoLoadDataSource&&!isc.AI.$257k[_6]){isc.AI.$260m.add({engine:this,rawRequest:_1,aiRequest:_2,callback:_3,config:_4});isc.AI.loadDataSource(_6)}else{this.logWarn("No AI DataSource configured","AI")}}
return _5},isc.A.handleSendRequest=function isc_AIEngine_handleSendRequest(_1,_2,_3,_4){if(_2.cancellationController&&_2.cancellationController.canceled){var _5=_2.cancellationController.asCanceledResult();this.delayCall("fireCallback",[_3,"aiResponse,aiRequest,config",[_5,_2,_4]]);return}
var _6=this.$2500(_1,_2,_3,_4);if(!_6)return;if(this.logIsEnabledFor(isc.Log.DEBUG,"AI")){this.logDebug("Prompt text to send to AI: "+this.makePromptText(_2),"AI")}
var _7={operationId:this.requestOperationId,willHandleError:true,clientContext:_4.context,showPrompt:!!_4.showPrompt};if(_4.requestProperties!=null){isc.addProperties(_7,_4.requestProperties)}
var _8=_4.responseSpoofingMode||isc.AI.responseSpoofingMode;if(_8!="none"){var _9=isc.AI.getSpoofedResponse(_2,this);if(_9!=null||_8=="full"){this.logDebug("* Using a spoofed response for the current interaction. responseSpoofingMode is \""+_8+"\". *","AI");_7.dataProtocol="clientCustom";if(_7.clientContext==null){_7.clientContext={}}
_7.clientContext.dataSource=_6;_7.clientContext.aiEngine=this;_7.clientContext.aiRequest=_2;_7.clientContext.spoofingMode=_8;_7.clientContext.spoofedResponse=_9}}
var _10=this;_6.fetchData(_1,function(_17,_18,_7){var _5,_11;if(_2.cancellationController&&_2.cancellationController.canceled){_5=_2.cancellationController.asCanceledResult()}else{if(_17.$260o&&(_18.makeAIResponse||_18.aiResponse)){_5=_18.makeAIResponse?_18.makeAIResponse(_2,_10):_18.aiResponse;_11=_18.makeErrorResponseInfo?_18.makeErrorResponseInfo(_2,_10):_18.errorResponseInfo}else{var _12=(_17.$260o?_10.makeSpoofedRawResponse(_2,_18.value):_17.completeData||_18);if(_17.status<0||_10.isErrorResponse(_12,_2)){_11=_10.getErrorResponseInfo(_12,_1,_2);_5=isc.createErrorResult(_11&&_11.errorMessage)}else{_5=_10.transformRawResponse(_12,_1,_2,_4)}}
if(_5.type!="success"){var _13=_11&&_11.errorType;if(_13)_5.errorType=_13;var _14=Math.max(0,+_4.retryIndex);if(isNaN(_14))_14=0;var _15=Math.max(0,_4.maxRetries!=null?_4.maxRetries:isc.AI.defaultMaxRetries);if(isNaN(_15))_15=0;if(_14>=_15){_5=isc.createErrorResult("Exceeded the maximum number of retries ("+_15+").",{lastAIResponse:_5})}else if(_11&&_11.recoverable){var _16=_11.retryDelay||isc.AI.sendPromptRetryDelay;_1=_11.newRawRequest||_1;_4.retryIndex=_14+1;_10.delayCall("handleSendRequest",[_1,_2,_3,_4],_16);return}}}
_5=_10.normalizeResponse(_5,_2,_4);_10.fireCallback(_3,"aiResponse,aiRequest,config",[_5,_2,_4])},_7)},isc.A.makeSpoofedRawResponse=function isc_AIEngine_makeSpoofedRawResponse(_1,_2){return[{chat_role:"assistant",chat_content:_2}]},isc.A.isErrorResponse=function isc_AIEngine_isErrorResponse(_1,_2){return!_1||isc.isA.String(_1)||!!_1.error},isc.A.getErrorResponseInfo=function isc_AIEngine_getErrorResponseInfo(_1,_2,_3){if(isc.isA.String(_1)){var _4=isc.AI._extractJsonResult(_1);if(_4&&_4.error)_1=_4;else return{errorMessage:"An error occurred. The response from the server was: "+_1}}else if(!_1||!_1.error)return null;return{errorMessage:_1.error.message}},isc.A.extractAIMessage=function isc_AIEngine_extractAIMessage(_1,_2,_3){var _4="text";if(_3.responseType=="array"||_3.responseType=="object"){var _5=_1.indexOf("```");if(_5>=0){if(_1.indexOf("```json",_5)>=0){_1=isc.AI._extractJsonResult(_1,"```json","```",true)}else{_1=isc.AI._extractJsonResult(_1,"```","```",true)}}else if(_3.responseType=="array"&&_1.indexOf("[")>=0){_1=isc.AI._extractJsonResult(_1,"[","]")}else{_1=isc.AI._extractJsonResult(_1)}
_4=isc.isAn.Array(_1)?"array":"object"}
return{source:"AI",content:_1,type:_4}},isc.A.transformRawResponse=function isc_AIEngine_transformRawResponse(_1,_2,_3,_4){var _5=isc.isAn.Array(_1)&&_1[0]&&_1[0].chat_content;if(!isc.isA.String(_5)){var _6="Unable to extract the message from the AI response";this.logWarn(_6,"AI");return isc.createErrorResult(_6)}
this.logDebug("Response text from AI: "+_5,"AI");return{type:"success",message:this.extractAIMessage(_5,_2,_3)}},isc.A.normalizeResponse=function isc_AIEngine_normalizeResponse(_1,_2,_3){if(!_1)_1={};if(_1.type==null||_1.type=="error"){_1.type="error"}else{var _4=_1.message;if(_4){var _5=_2.responseType||"text";if(_5=="array"){if(!isc.isAn.Array(_4.content)){_4.content=[_4.content];_4.type="array"}}else if(_5=="object"){if(!isc.isAn.Object(_4.content)||isc.isAn.Array(_4.content)){_4.content={result:_4.content};_4.type="object"}}else if(_5=="number"){_4.content=Number(_4.content);if(_2.responseMinimum!=null){_4.content=Math.max(_2.responseMinimum,_4.content)}
if(_2.responseMaximum!=null){_4.content=Math.min(_4.content,_2.responseMaximum)}
_4.type="number"}}}
return _1});isc.B._maxIndex=isc.C+30;isc.A=isc.AIEngine.getPrototype();isc.A.temperature=0.7;isc.A.tokenLimit=4096;isc.defineClass("BaseOpenAIEngine",isc.AIEngine);isc.A=isc.BaseOpenAIEngine.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.provider="OpenAI";isc.A.dataSourceName="openAIRestConnector";isc.A.requestOperationId="fetch";isc.A.tokenLimit=4096;isc.A.supportsJSONMode=false;isc.A.supportsStructuredOutputs=false;isc.B.push(isc.A.estimateRequestTokenCount=function isc_BaseOpenAIEngine_estimateRequestTokenCount(_1){_1=this.normalizeRequest(_1);this.$102q(_1.prompt==null);var _2=0,_3=_1.messages;if(_3!=null){for(var i=0;i<_3.length;++i){_2+=this.estimateMessageTokenCount(_3[i])}}
return _2},isc.A.$277z=function isc_BaseOpenAIEngine__mapAIMessageSourceToRole(_1){if(!_1)return"user";return _1=="AI"?"assistant":_1},isc.A.transformRequest=function isc_BaseOpenAIEngine_transformRequest(_1){_1=this.normalizeRequest(_1);var _2=this.canSupportVisionRequests()&&isc.AIEngine.isVisionRequest(_1);var _3={model:_2&&this.visionModel?this.visionModel:this.model||this.engineId,temperature:this.getTemperature(_1),messages:null};var _4=_1.messages;if(_4!=null){var _5=_3.messages=new Array(_4.length);for(var i=0;i<_5.length;++i){var _7=_4[i];_5[i]={role:this.$277z(_7.source),content:null};if(_2&&isc.AIEngine.isImageMessage(_7)){_5[i].content=[{type:"image_url",image_url:{url:"data:image/"+(_7.type=="jpegImage"?"jpeg":"png")+";base64,"+_7.content}}]}else if(!isc.AIEngine.$272z(_7.type)){_5[i].content=this.makeNonTextPromptPart(_7)}else{_5[i].content=String(_7.content)}}}
if(this.supportsJSONMode){if(_1.responseType=="object"&&_1.responseType!="array")
{_3.response_format={type:"json_object"}}}
if(this.seed!=null)_3.seed=this.seed;return _3},isc.A.makeSpoofedRawResponse=function isc_BaseOpenAIEngine_makeSpoofedRawResponse(_1,_2){return{choices:[{finish_reason:"stop",index:0,message:{content:_2,role:"assistant"}}]}},isc.A.extractAIMessage=function isc_BaseOpenAIEngine_extractAIMessage(_1,_2,_3){if((_1.contains('{')||_1.contains('['))&&_2&&_2.response_format&&_2.response_format.type=="json_object")
{try{_1=isc.JSON.decode(_1);var _4=isc.isAn.Array(_1)?"array":"object";return{source:"AI",content:_1,type:_4}}catch(e){this.logWarn("JSON mode was enabled, but the response did not parse as JSON: "+e,"AI")}}
return this.Super("extractAIMessage",arguments)},isc.A.transformRawResponse=function isc_BaseOpenAIEngine_transformRawResponse(_1,_2,_3){var _4={type:"error"};if(!_1){_4.errorMessage="The response was empty."}else if(_1.error){_4.errorMessage=_1.error.message}else{var _5=isc.isAn.Array(_1.choices)&&_1.choices[0];var _6=_5&&_5.message&&_5.message.content;if(!isc.isA.String(_6)){this.logWarn(_4.errorMessage="Unable to extract the message from the AI response","AI")}else{this.logDebug("Response text from AI: "+_6,"AI");_4.type="success";_4.message=this.extractAIMessage(_6,_2,_3)}}
return _4});isc.B._maxIndex=isc.C+6;isc.defineClass("OpenAIO1Engine",isc.BaseOpenAIEngine);isc.A=isc.OpenAIO1Engine.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.tokenLimit=128000-32768-25000;isc.B.push(isc.A.$277z=function isc_OpenAIO1Engine__mapAIMessageSourceToRole(_1){return _1=="AI"?"assistant":"user"},isc.A.transformRequest=function isc_OpenAIO1Engine_transformRequest(_1){var _2=this.Super("transformRequest",arguments);_2.max_completion_tokens=25000;return _2});isc.B._maxIndex=isc.C+2;isc.defineClass("MultimodalGPTEngine",isc.BaseOpenAIEngine);isc.A=isc.MultimodalGPTEngine.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.tokenLimit=128000;isc.B.push(isc.A.canSupportVisionRequests=function isc_MultimodalGPTEngine_canSupportVisionRequests(){return true},isc.A.estimateMessageTokenCount=function isc_MultimodalGPTEngine_estimateMessageTokenCount(_1){if(isc.AIEngine.isImageMessage(_1)){return 85}
return this.Super("estimateMessageTokenCount",arguments)});isc.B._maxIndex=isc.C+2;isc.defineClass("GeminiProAIEngine",isc.AIEngine);isc.A=isc.GeminiProAIEngine.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.name="Gemini Pro";isc.A.provider="Google";isc.A.tokenLimit=30720;isc.A.visionTokenLimit=12288;isc.A.requestOperationId="fetch";isc.A.dataSourceName="geminiProRestConnector";isc.A.visionDataSourceName="geminiProVisionRestConnector";isc.B.push(isc.A.canSupportVisionRequests=function isc_GeminiProAIEngine_canSupportVisionRequests(){return true},isc.A.estimateRequestTokenCount=function isc_GeminiProAIEngine_estimateRequestTokenCount(_1){_1=this.normalizeRequest(_1);this.$102q(_1.prompt==null);if(isc.AIEngine.isVisionRequest(_1)){var _2=this.makePromptParts(_1),_3=0;for(var i=0;i<_2.length;++i){var _5=_2[i];if(isc.isA.String(_5)){_3+=this.estimateTokenCount(_5)}}
return _3}
var _3=0,_6=_1.messages;if(_6!=null){for(var i=0;i<_6.length;++i){_3+=this.estimateMessageTokenCount(_6[i])}}
return _3},isc.A.getTokenLimit=function isc_GeminiProAIEngine_getTokenLimit(_1){return(isc.AIEngine.isVisionRequest(_1)?this.visionTokenLimit:this.tokenLimit)},isc.A.getDataSourceName=function isc_GeminiProAIEngine_getDataSourceName(_1){return(isc.AIEngine.isVisionRequest(_1)?this.visionDataSourceName:this.dataSourceName)},isc.A.makeNonTextPromptPart=function isc_GeminiProAIEngine_makeNonTextPromptPart(_1){if(isc.AIEngine.isImageMessage(_1)){return{inlineData:{mimeType:isc.AIEngine.$269b(_1),data:_1.content}}}
return this.Super("makeNonTextPromptPart",arguments)},isc.A.makePromptParts=function isc_GeminiProAIEngine_makePromptParts(_1){_1=this.normalizeRequest(_1);var _2=_1.messages,_3=0,_4;if(_2!=null&&_2.length>0&&isc.AIEngine.isImageMessage(_4=_2[_2.length-1]))
{for(var _5=_2.length;_5>0;--_5){var _6=_2[_5-1];if(!isc.AIEngine.isImageMessage(_6)||_4.source!=_6.source)
{break}
++_3}}
if(_3==0||_3==_2.length){return this.Super("makePromptParts",[_1])}
var _7=_2.duplicate();_7.setLength(_7.length-_3);var _8=_7[_7.length-1];if(_8.source!=_4.source){_7.push({source:_4.source,content:""})}
var _9;try{_1.messages=_7;_9=this.Super("makePromptParts",[_1])}finally{_1.messages=_2}
for(var i=0;i<_3;++i){_9.push(this.makeNonTextPromptPart(_2[_2.length-_3+i]))}
return _9},isc.A.transformRequest=function isc_GeminiProAIEngine_transformRequest(_1){_1=this.normalizeRequest(_1);var _2=_1.messages;var _3={contents:null,generationConfig:{temperature:this.getTemperature(_1)}};if(isc.AIEngine.isVisionRequest(_1)){var _4=this.makePromptParts(_1);for(var i=0;i<_4.length;++i){if(isc.isA.String(_4[i])){_4[i]={text:String(_4[i])}}}
_3.contents=[{parts:_4,role:"user"}]}else if(_2!=null){var _6=_3.contents=[];for(var _7=0;_7<_2.length;++_7){var _8=_2[_7];this.$102q(!isc.AIEngine.isImageMessage(_8));var _9={text:String(_8.content)};var _10=(_8.source=="AI"?"model":"user");if(_6.length>0&&_6[_6.length-1].role==_10){_6[_6.length-1].parts.push(_9)}else{_6.push({parts:[_9],role:_10})}}}
return _3},isc.A.isErrorResponse=function isc_GeminiProAIEngine_isErrorResponse(_1,_2){if(!_1)return true;var _3=_1.promptFeedback;if(_3&&_3.blockReason)return true;var _4=_1.candidates;if(!isc.isAn.Array(_4)||_4.length==0)return true;return _4[0].finishReason!="STOP"},isc.A.getErrorResponseInfo=function isc_GeminiProAIEngine_getErrorResponseInfo(_1,_2,_3){if(isc.isA.String(_1)){var _4=isc.AI._extractJsonResult(_1);if(_4&&_4.finishReason)_1=_4;else return{errorMessage:"An error occurred. The response from the server was: "+_1}}else if(!_1)return null;var _5,_6;var _7=_1.promptFeedback,_8=_1.candidates;if(_7&&_7.blockReason){if(_7.blockReason=="SAFETY"){_5="The request was deemed unsafe.";_6="requestUnsafe"}else{var _9=_1.usageMetadata;if(_9&&isc.isA.Number(_9.promptTokenCount)&&_9.promptTokenCount>this.getTokenLimit(_3))
{_5="The request contained too many tokens.";_6="requestSizeLimitExceeded"}else{_5="The request was blocked for an unspecified reason."}}}else if(!isc.isAn.Array(_8)||_8.length==0){_5="No candidates were generated."}else{var _10=_8[0].finishReason;if(_10=="MAX_TOKENS"){_5="The response contained too many tokens.";_6="responseSizeLimitExceeded"}else if(_10=="SAFETY"){_5="The response was blocked for safety reasons.";_6="responseUnsafe"}else if(_10=="RECITATION"){_5="The response was blocked for recitation reasons."}else{_5="The first candidate's finishReason was: "+_10}}
return{errorMessage:_5,errorType:_6}},isc.A.makeSpoofedRawResponse=function isc_GeminiProAIEngine_makeSpoofedRawResponse(_1,_2){if(_1.responseType=="array"||_1.responseType=="object"){_2="```json\n"+_2+"\n```"}
return{candidates:[{content:{parts:[{text:_2}],role:"model"},finishReason:"STOP"}]}},isc.A.transformRawResponse=function isc_GeminiProAIEngine_transformRawResponse(_1,_2,_3){var _4={type:"error"};var _5=_1&&isc.isAn.Array(_1.candidates)&&_1.candidates[0];var _6=_5&&_5.content&&_5.content.parts;if(_6==null||_6.length==0){this.logWarn(_4.errorMessage="Unable to extract the message from the AI response","AI")}else{var _7="";if(_6.length>1)this.logWarn(_6.length+" parts were in the AI response","AI");for(var i=0;i<_6.length;++i){var _9=_6[i];if(!("text"in _9)){this.logWarn("message part was not text: "+isc.JSON.encode(_9),"AI")}else{_7=(_7!=""?"\n":"")+_9.text}}
this.logDebug("Response text from AI: "+_7,"AI");_4.type="success";_4.message=this.extractAIMessage(_7,_2,_3)}
return _4});isc.B._maxIndex=isc.C+11;if(!isc.AI)isc.defineClass("AI");isc.A=isc.AI;isc.A.aiWasDisabledMessage="AI was disabled.";isc.A.defaultAIEngineNotRegisteredErrorMessage="The default AI engine '${defaultEngineId}' is not registered.";isc.A.noAIEngineSupportingVisionRequestsIsRegisteredErrorMessage="No AI engine is registered which supports vision requests.";isc.A.aiNotAbleToProcessRequestErrorMessage="AI is not able to process your request.";isc.A.noDataSourcesAvailableOrFoundErrorMessage="There were no data sources available or found.";isc.A.startingYourRequestDetailMessage="Starting your request\u2026";isc.A.willSubsetFieldsDetailMessage="Since the data source has a large number of fields, AI will be asked to select which ones are likely to be relevant to your request.";isc.A.finishedSubsettingFieldsDetailMessage="Finished the request to select the relevant fields.";isc.A.dataSourceIsRequiredErrorMessage="A globally-installed DataSource with a non-composite primary key is required.";isc.A.exampleResponseDelineator="$$$$$$$";isc.A.aiResponseDelineator="#######";isc.A.scPostDelineator="^^^^^^^";isc.A.$272z=isc.AIEngine.$272z;isc.A.$2720=isc.AIEngine.$2720;isc.A.$262j="context,numStepsCompleted,estimatedNumTotalSteps,newMessages";isc.A=isc.AI;isc.A.responseTypes=["Execute JavaScript","Clarify","Inspect","Explain Why Not","Ad Hoc UI","Send A Message"];isc.A.messageTypes=["Notify","Modal Message"];isc.A.errorTypes={"ContainsAIDelineator":"The Response should not contain "+isc.AI.aiResponseDelineator+" or "+isc.AI.scPostDelineator,"NoResponseType":"The Response has no ResponseType, which is invalid.","BadResponseType":"The Response has ResponseType ${responseType}, which is not a valid ResponseType.","NoMessageType":"The Response has a Message but there is no MessageType, which is invalid.","BadMessageType":"The Response has MessageType ${messageType}, which is not a valid MessageType.","NoMessage":"ResponseType is ${responseType} but there is no Message in the Response, which is invalid.","NoJavaScript":"ResponseType is ${responseType} but there is no JavaScript in the Response, which is invalid.","NoCommandComplete":"ResponseType is ${responseType} but the JavaScript code in the Response does not contain a call to isc.AI.commandComplete(). This method should be invoked exactly once when the script's actions are completed","JavaScriptError":"Your attempt to execute JavaScript in the user's session resulted in a JavaScript error.\nThe error message is as follows:\n    ${error.message}\nEnd of error message.\n${hint}The attempted changes have been reverted and no messages have been displayed to the end user.\nPlease provide a revised response in the same format previously described."};isc.A=isc.AI;isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.serializationFormat="compactJSON";isc.A.csvFormatDescription="Objects are formatted in a character-separated-values format where each line shows the attribute-values of an object for the following fields:\n${fieldNames}\nAttribute values are separated by ${separator}.\n";isc.A.separatorCharacter="|";isc.A.jsonFormatDescription="Objects are serialized as an array of JSON formatted objects.\n";isc.A.defaultRecordIndexFieldName="data-record index";isc.A.disabled=true;isc.A.engineConfigs=[{engineId:"gpt-3.5-turbo",_constructor:"BaseOpenAIEngine",name:"GPT-3.5 Turbo",model:"gpt-3.5-turbo",tokenLimit:4096,supportsJSONMode:true},{engineId:"gpt-4",_constructor:"BaseOpenAIEngine",name:"GPT-4",model:"gpt-4",tokenLimit:8192,supportsJSONMode:true},{engineId:"gpt-4-turbo",_constructor:"MultimodalGPTEngine",name:"GPT-4 Turbo",supportsJSONMode:true},{engineId:"gpt-4o",_constructor:"MultimodalGPTEngine",name:"GPT-4o",supportsJSONMode:true},{engineId:"gpt-4o-mini",_constructor:"MultimodalGPTEngine",name:"GPT-4o mini",supportsJSONMode:true},{engineId:"gpt-4.1",_constructor:"BaseOpenAIEngine",name:"GPT-4.1"},{engineId:"gemini-pro",_constructor:"GeminiProAIEngine"},{engineId:"o1-preview",_constructor:"OpenAIO1Engine"},{engineId:"o1-mini",_constructor:"OpenAIO1Engine"},{engineId:"o3-mini",_constructor:"OpenAIO1Engine"}];isc.A.defaultEngineId="gpt-4o";isc.A.engines={};isc.A.assistantKey={altKey:true,keyName:"J"};isc.A.$273s="result,request";isc.A.defaultMaxRetries=2;isc.A.sendPromptRetryDelay=5000;isc.A.$260m=[];isc.A.useClientSessionHistory=true;isc.A.adjacentValidationFailureCount=0;isc.A.$2542=0;isc.A.canExport=true;isc.A.canExportCharts=true;isc.A.canExportGrids=true;isc.A.canSaveScreens=true;isc.A.adHocUIWindowDefaults={_constructor:"Window",width:"80%",height:"80%",canDragResize:true,canDragReposition:true,keepInParentRect:false,autoCenter:true,isModal:true,title:"AI created User Interface",showHeaderIcon:true,bodyProperties:{padding:10,layoutMargin:10,membersMargin:9},toolStripDefaults:{_constructor:"ToolStrip",autoDraw:false,width:"100%",height:40},helpButtonDefaults:{_constructor:"ToolStripButton",autoDraw:false,name:"helpWithUI",prompt:"Ask for help with the dynamically created UI",click:function(){this.creator.getHelpWithThisUI()}},saveButtonDefaults:{_constructor:"ToolStripButton",autoDraw:false,name:"helpWithUI",icon:"[SKINIMG]actions/save.png",prompt:"Save this UI for future use",click:function(){this.creator.saveAdHocUI()}},exportButtonDefaults:{_constructor:"ToolStripButton",name:"exportUI",icon:"[SKINIMG]actions/export.png",click:function(){this.creator.exportUI()}},initWidget:function(){this.headerIconDefaults.src=isc.AI.getIconURL(true);this.addAutoChild("helpButton",{icon:isc.AI.getIconURL(true)});this.addAutoChild("saveButton",{showIf:"isc.AI.canSaveScreens"});this.addAutoChild("exportButton",{showIf:"isc.AI.canExport"});this.addAutoChild("toolStrip",{members:[this.helpButton,this.saveButton,this.exportButton]});this.addItem(this.toolStrip);return this.Super("initWidget",arguments)},showCloseButton:true,showMinimizeButton:false,showMaximizeButton:true,closeClick:function(){this.destroy()},setAdHocUI:function(_1,_2){this.adHocUI=isc.isAn.Array(_1)?_1[0]:_1;this.response=_2;var _3=this.adHocUI&&this.adHocUI.getFirstDBC();if(!_3){this.exportButton.hide()}else{this.exportButton.show();this.exportButton.prompt=isc.isA.ListGrid(_3)?"Export Grid Data":"Export Chart"}
this.firstDBC=_3;if(this.adHocUI){this.addItem(this.adHocUI,0)}},getAdHocUI:function(){return this.adHocUI},saveAdHocUI:function(){isc.AI.showSaveUIWindow(this.response)},getAdHocUISummary:function(){return this.adHocUI&&this.adHocUI.getUISummary(["data"])},exportUI:function(){var _1=this.adHocUI.getFirstDBC();if(!_1){isc.logWarn("No exportable UI.");return}
var _2=isc.isA.ListGrid(_1),_3=isc.isA.FacetChart(_1),_4=[];if(_2){_4=[{title:"CSV",val:"csv"},{title:"JSON",val:"json"},{title:"XML",val:"xml"},{title:"XLS (Excel97)",val:"xls"},{title:"OOXML (Excel2007)",val:"ooxml"}]}else if(_3){_4=[{title:"PNG",val:"png"},{title:"JPEG",val:"jpeg"}]}
var _5=isc.Menu.create({autoDraw:false,items:_4,keepInParentRect:true,itemClick:function(_7){if(_2){if(_7.val=="json"){_1.exportClientData({operationId:"customJSONExport"})}else{_1.exportClientData({exportAs:_7.val})}}else if(_3){isc.RPCManager.exportImage(_1.getSvgString(),{exportDisplay:"download",exportFilename:"export",exportImageFormat:_7.val,exportImageQuality:1})}}})
_5.$91y();_5.draw();var _6=_5.getVisibleHeight();_5.placeNear(this.exportButton.getPageLeft(),this.exportButton.getPageTop()-_6);_5.show()},getHelpWithThisUI:function(){isc.AI.showAssistant({rootCanvas:this.adHocUI})}};isc.A.saveUIWindowDefaults={_constructor:"Window",width:300,autoCenter:true,autoSize:true,overflow:"visible",canDragResize:true,isModal:true,canDragReposition:true,title:"Save AI generated UI",bodyProperties:{padding:10,layoutMargin:10,membersMargin:9},labelDefaults:{_constructor:"Label",width:"100%",height:1,overflow:"visible",dynamicContents:true,contents:"You can save AI-generated screens for later use.  Saved screens are available whenever you open the AI assistant.<br><br>What would you like to name this UI?<br>"},formDefaults:{_constructor:"DynamicForm",height:"*",autoFocus:true,cellPadding:0,fields:[{name:"userText",type:"textArea",minHeight:50,width:"*",height:"*",colSpan:"*",showTitle:false,hint:"Type a name for your saved UI",showHintInField:true,keyPress:function(_1,_2,_3,_4){if(_3=="Enter"){this.form.creator.saveAdHocUI();return false}}}]},controlsLayoutDefaults:{_constructor:"HLayout",width:"100%",height:1,overflow:"visible",align:"right",membersMargin:8},saveButtonDefaults:{_constructor:"Button",title:"Save",autoFit:true,autoDraw:false,click:function(){this.creator.saveAdHocUI()},layoutAlign:"right"},cancelButtonDefaults:{_constructor:"Button",title:"Cancel",autoFit:true,autoDraw:false,click:function(){this.creator.hide();},layoutAlign:"right"},initWidget:function(){this.Super("initWidget",arguments);this.addItem(this.addAutoChild("label"));this.addItem(this.addAutoChild("form"));this.addAutoChild("saveButton");this.addAutoChild("cancelButton");this.addItem(this.addAutoChild("controlsLayout",{members:[this.saveButton,this.cancelButton]}))},saveAdHocUI:function(){isc.AI.saveAdHocUI(this.form.getValue("userText"),this.response);this.hide()},closeClick:function(){this.hide()},setResponse:function(_1){this.response=_1},show:function(){this.form.setValue("userText",(isc.AI.lastUserPrompt||"").substring(0,100));return this.Super("show",arguments)}};isc.A.savedUIStorageKey="savedUI";isc.A.screensDataSource=null;isc.A.logLocalDSRequests=false;isc.A.assistantBlurb="<b>Ask for AI assistance in using this ${isc.AI.isShowcase ? \"Showcase Sample\" : \"application\"}.</b><br><br>You can:<br><br>1. request that the AI configures the existing screen to do something you want (such as configuring complex search criteria for a grid)<br><br>2. request that the AI builds you a custom interface, to enable you to complete tasks more quickly than what the current UI allows. Note that AI-created screens may be saved for future use.<br>";isc.A.assistantHint="Type your question or request here";isc.A.assistantWindowDefaults={_constructor:"Window",width:500,autoCenter:true,autoSize:true,overflow:"visible",canDragResize:true,canDragReposition:true,title:"SmartClient AI Assistant",showHeaderIcon:true,bodyProperties:{padding:10,layoutMargin:10,membersMargin:10},labelDefaults:{_constructor:"Label",width:"100%",dynamicContents:true},formDefaults:{_constructor:"DynamicForm",height:"*",autoFocus:true,cellPadding:0,fields:[{name:"userText",type:"textArea",minHeight:50,width:"*",height:"*",colSpan:"*",showTitle:false,hint:isc.AI.assistantHint,showHintInField:true,keyPress:function(_1,_2,_3,_4){if(_3=="Enter"){this.form.creator.askTheAI();return false}}}]},controlsLayoutDefaults:{_constructor:"HLayout",width:"100%",height:1,membersMargin:10,overflow:"visible"},savedUIFormDefaults:{_constructor:"DynamicForm",width:360,minWidth:200,height:1,overflow:"visible",autoFocus:false,autoDraw:false,cellPadding:0,layoutAlign:"left"},askButtonDefaults:{_constructor:"Button",title:"Ask the AI",autoFit:true,click:function(){this.creator.askTheAI()},layoutAlign:"right"},initWidget:function(){this.headerIconDefaults.src=isc.AI.getIconURL(true);this.Super("initWidget",arguments);this.addItem(this.addAutoChild("label",{contents:isc.AI.assistantBlurb}));this.addItem(this.addAutoChild("form"));this.addItem(this.addAutoChild("controlsLayout"));this.addAutoChild("savedUIForm",{fields:[{name:"savedUI",type:"select",width:"*",colSpan:"*",optionDataSource:isc.AI.getScreensDataSource(),valueField:"name",displayField:"name",title:"Saved Screens",wrapTitle:false,pickListProperties:{canRemoveRecords:true},changed:function(){this.form.creator.loadSavedUI(this.getValue());return false}}]});this.addAutoChild("askButton");this.controlsLayout.addMembers([this.savedUIForm,isc.LayoutSpacer.create({width:"*"}),this.askButton])},askTheAI:function(){var _1=this.form.getValue("userText")
isc.AI.command(_1,"userQuery");isc.Notify.addMessage("Asked the AI: \""+_1+"\"")},loadSavedUI:function(){var _1=this.savedUIForm.getValue("savedUI");isc.AI.getSavedUI(_1,function(_2){isc.AI.handleAIResponse(_2.response.aiResponse)})},close:function(){this.Super("close",arguments);isc.AI.assistantClosed()}};isc.A.clearHistoryOnClose=true;isc.A.clarifyWindowDefaults={_constructor:"Window",width:300,autoCenter:true,autoSize:true,canDragResize:true,canDragReposition:true,height:200,title:"The AI needs your input",bodyProperties:{padding:10,layoutMargin:10,membersMargin:9},labelContents:"",labelDefaults:{_constructor:"Label",width:"100%",height:1,contents:""},formDefaults:{_constructor:"DynamicForm",height:"*",autoFocus:true,cellPadding:0,fields:[{name:"userText",type:"textArea",minHeight:50,width:"*",height:80,colSpan:"*",showTitle:false,hint:"Type your clarifying information here",showHintInField:true,keyPress:function(_1,_2,_3,_4){if(_3=="Enter"){this.form.creator.tellTheAI();return false}}}]},aiButtonDefaults:{_constructor:"Button",title:"Tell the AI",autoFit:true,click:function(){this.creator.tellTheAI()},layoutAlign:"right"},initWidget:function(){this.Super("initWidget",arguments);this.addItem(this.addAutoChild("label"));this.addItem(this.addAutoChild("form"));this.addItem(this.addAutoChild("aiButton"))},tellTheAI:function(){var _1=this.form.getValue("userText")
isc.AI.command(_1,"userClarification");isc.AI.hideClarifyWindow()}};isc.A.$2593={result:"invalid"};isc.A.$270h="aiResponseForBatch,context";isc.A.useAIFieldPaging=true;isc.A.salientFieldAttributes=["name","type","required","multiple","title","description","valueMap","validOperators","displayField","foreignKey","joinType","includeFrom","includeVia","hidden"];isc.A.setFieldsFixedPrompt="This is a request by a user to show and/or hide some ListGrid fields in a web application built with the Isomorphic SmartClient Javascript framework. The user request is as follows:\n'${userPrompt}'\nYour response should be a JSON string containing an object with two attributes.\n\"show\": the fields the user wants to show as an array of strings, or an empty array if the user did not ask to show any fields.\n\"hide\": the fields the user wants to hide as an array of strings, or an empty array if the user did not ask to hide any fields.\n\nDo not include any other text in your response.\n\n";isc.A.setFieldsHiddenFieldsPromptPrefix="The following fields are not currently visible in the grid but are available to be shown.\n";isc.A.setFieldsVisibleFieldsPromptPrefix="The grid currently contains the following visible fields which may be hidden.\n";isc.A.$265j="buildResponse,buildRequest";isc.A.$274q="asyncBuildCriterion";isc.A.buildCriteriaAIAssistPrompts=["This is a request for an AdvancedCriteria object to apply to a data-bound component (such as a ListGrid) in a web application built with the Isomorphic SmartClient JavaScript Framework. Should you need to know, today's date is "+isc.DateUtil.format(new Date(),"MMMM dd, yyyy")+". The AdvancedCriteria should fulfill the following filter-query:\n","${userMessages}","\n\n","The data-bound component's DataSource has the following summary:\n${dsSummary}\n\nIf the provided field-information is insufficient to generate a functional AdvancedCriteria object for the filter-query, your response should be exactly '{ \"result\": \"invalid\" }'.\n\n","If an AdvancedCriteria expression could be written as either { operator: 'not', criteria: [{ fieldName: 'someField', operator: 'equals', value: 'value' }] } or as { fieldName: 'someField', operator: 'notEqual', value: 'value' }, prefer the second form.","But if the filter-query *can* be fulfilled, your response should include only the AdvancedCriteria object, which has the following format:\n${advancedCriteriaFormatDescription}"];isc.A.advancedCriteriaFormatDescription="{\"_constructor\":\"AdvancedCriteria\",\n\"operator\":Any valid OperatorID, including \"and\" or \"or\" if there are multiple subcriteria, or for single field criterion, one of \"iContains\", \"iEquals\", \"iNotContains\", \"iNotEqual\", \"greaterThan\", \"lessThan\", \"greaterOrEqual\", \"lessOrEqual\", \"isBlank\", \"notBlank\"\n\"criteria\":If \"operator\" is \"and\" or \"or\", an array of subcriteria to apply. For any other operator, this attribute should be omitted,\n\"fieldName\":name of the field to which this criterion should apply if this is a single field criterion. Valid values for this property are the list of fields provided below.  This property should be omitted if the operator is \"and\" or \"or\",\n\"value\":If the \"operator\" is neither \"isBlank\" nor \"notBlank\", the value for the criterion, otherwise this attribute should be omitted. If the field is of type 'date', any 'value' attribute should be formatted as a string in the format YYYY-MM-DD.\n}\n\nAdvancedCriteria does not support top-N (e.g. top 3) or percentile filtering. If the user has requested a certain number of top records, or a certain percentile of records, you should ignore that part of the request.\n\nNote: the operators \"lessThan\" and \"lessOrEqual\" always consider a blank value to be less than the criterion \"value\". When using \"lessThan\" or \"lessOrEqual\" on a field that is not \"required\":true, you will need to use an \"and\" operator where one of the \"criteria\" is \"operator\":\"notBlank\", if blank values should be excluded.\n\nFor example, an AdvancedCriteria object directly corresponding to a user request of 'Show items where fieldA is greater than zero' is:\n{\"_constructor\":\"AdvancedCriteria\",\n\"operator\":\"greaterThan\",\n\"fieldName\":\"fieldA\",\n\"value\":0\n}\n\nAnd an AdvancedCriteria object directly corresponding to a user request of 'orderID must be non empty and orderTotal must be more than 0 and less than 20' is:\n{\"_constructor\":\"AdvancedCriteria\",\n\"operator\":\"and\",\n\"criteria:[{\"fieldName\":\"orderID\",\"operator\":\"notBlank\"},\n{\"fieldName\":\"orderTotal\",\"operator\":\"greaterThan\",\"value\":0},\n{\"fieldName\":\"orderTotal\",\"operator\":\"lessThan\",\"value\":20}]\n}\n\n";isc.A.buildCriteriaHybridPrompts=["The user of a web application built with the Isomorphic SmartClient JavaScript Framework has requested to filter the data-records of a data-bound component according to the following filter-query:","${userMessages}","The data-bound component's DataSource has the following summary:\n${dsSummary}\n\nThere are two methods of filtering the data-records of the data-bound component:\n1. Generate an AdvancedCriteria object that directly corresponds to the user's filter-query.\n2. Evaluate each record on a case-by-case basis, using the properties of each data-record, all reasonable inferences, and your own knowledge to decide whether a data-record matches the filter-query.\n\n","An AdvancedCriteria object has the following format:\n${advancedCriteriaFormatDescription}","Method 1 is preferred if you can create an AdvancedCriteria object for the filter-query.","Your response must be a JSON object.","If you decide that method 1 is sufficient, your response should be the AdvancedCriteria object for the filter-query.","If you decide that only method 2 would satisfy the filter-query, your response should be exactly '{ \"result\": \"method2\" }'.","In all other cases, your response should be exactly '{ \"result\": \"invalid\" }'."];isc.A.fixCriterionPrompts=["The user of a web application built with the Isomorphic SmartClient JavaScript Framework has requested to filter the data-records of a data-bound component according to the following filter-query:","${userMessages}","The data-bound component's DataSource has the following summary:\n${dsSummary}\n\nYou generated the following AdvancedCriteria object:\n${encodedCriterion}\nThe reason(s) why this is invalid are:\n${validationErrors}\n\n${encodedValidatedCriterion ? 'We have attempted to fix your AdvancedCriteria as follows:\\n' + encodedValidatedCriterion + '\\n\\n' : ''}An AdvancedCriteria object has the following format:\n${this.advancedCriteriaFormatDescription}\n\nYou are to generate a different AdvancedCriteria object that satisfies the user's filter-query *and* avoids the validation errors listed above.\nIf you are unable to do this, then your response should be exactly '{ \"result\": \"invalid\" }'"];isc.A.allowedCriterionPropertyNames=["fieldName","fieldQuery","operator","value","valuePath","valueQuery","start","end"];isc.A.$268u=["and","or","not","isBlank","notBlank","isNull","notNull","equals","notEqual","iEquals","iNotEqual","contains","notContains","iContains","iNotContains","startsWith","notStartsWith","iStartsWith","iNotStartsWith","endsWith","notEndsWith","iEndsWith","iNotEndsWith","greaterThan","lessThan","greaterOrEqual","lessOrEqual"];isc.A.$266z="applyResponse,applyRequest";isc.A.$274r="asyncApplyAIFilter";isc.A.applyAIFilterPrompts=["The objects in the source-array below represent data-records from a DataSource. Using the properties on each data-record, the summary of the DataSource, and your own knowledge, determine which data-records match the user-supplied filter-query:","${userMessages}","The DataSource has the following summary:\n${dsSummary}\n\nFor example, if the query was 'amount is larger than 100', you should look for a field with a name most related to 'amount' and compare its value to 100.\n\nYour response should be a JSON object with a single property called 'result'.  This property should be set to an array of integers, where each integer is the index of a matching record in the source-array below.  For example, if the first data-record in the array below matches the user's filter-query, your response array must include its source-array index (0) as the first entry.  Similarly, the source-array indices of any other matching data-records must also be in your response array.\n\nIf a data-record does not match the filter-query, do not include its index in your response array.\n\nIf no data-records match, the 'result' property in your response object should be set to an empty array.\n\nApart from the JSON object, your response must not include any other preamble or content of any kind."];isc.A.$274s="asyncBuildHilites";isc.A.buildHilitesPrompts=["This is a request for one or more Hilite objects to apply to a data-bound component (such as a ListGrid) in a web application built with the Isomorphic SmartClient JavaScript Framework. Should you need to know, today's date is "+isc.DateUtil.format(new Date(),"MMMM dd, yyyy")+".  A hilite applies specific styling (such as a text color, background color, and/or font-weight) to one or more fields of records that match a filter-query.  The user's description of the styling to apply, the fields that should have this styling, and/or the filter-query is:","${userMessages}","The data-bound component's DataSource has the following summary:\n${dsSummary}\n\nYour response should be a JSON object with a single key \"hilites\": an array of the Hilite objects. Each Hilite object has the following format:\n{\"hiliteDescription\":The user's description for this particular Hilite, as a string,\n\"filterDescription\":Just the description of the filter-query, as a string,\n\"backgroundColor\":If the user requested a background color, a CSS color or color-name of the requested background color,\n\"textColor\":If the user requested a text color, a CSS color or color-name of the requested text color,\n\"cssText\":The CSS source code for any other styling requested by the user, if any,\n\"fieldName\":If the user requested that the styling is applied to certain fields, an array of the field names.  This property should be omitted if the user did not specify any specific fields to have hilite styling,\n\"replacementValue\":If the user requested that certain fields' values be replaced, the replacement value\n}\n\nHere are examples of CSS properties to use within \"cssText\":\nfont-weight: bold\nfont-style: italic\ntext-decoration-line: one of the following keywords: none, underline, overline, strike-through\ntext-decoration-color: a CSS color or color-name for the text decoration line\n\nValid color-names are: white, lightgray, gray, darkgray, black, lightred, red, darkred, lightpink, pink, darkpink, lightpurple, purple, darkpurple, lightorange, orange, darkorange, lightbrown, brown, darkbrown, lightyellow, yellow, darkyellow, lightgreen, green, darkgreen, lightblue, blue, darkblue, turquoise, teal, gold, bronze, beige\n\nNote: If the user-request did not explicitly specify the hilite styling, assume \"make the text color red\".\n\nFor example, if the user request was \"Show a light red background on the userName for records where the payment is overdue\", a valid response might be:\n{\"hilites\": [{\"fieldName\":\"userName\",\n\"backgroundColor\":\"lightred\",\n\"filterDescription\":\"payment is overdue\",\n\"hiliteDescription\":\"Show a light red background on the userName for records where the payment is overdue\"}]\n}\n\nOr, if the user request was \"Hilite every row where assetImprovement is less than 5\", a valid response might be:\n{\"hilites\": [{\"textColor\":\"red\",\n\"filterDescription\":\"assetImprovement is less than 5\",\n\"hiliteDescription\":\"Hilite every row where assetImprovement is less than 5\"}]\n}\n\nOr, if the user request was \"highlight population with light green background and red text where population is greater than 3000000 and highlight country with red text where continent is Africa\", a valid response might be:\n{\"hilites\": [{\"fieldName\":\"population\",\n\"backgroundColor\":\"lightgreen\",\n\"textColor\":\"red\",\n\"filterDescription\":\"population is greater than 3000000\",\n\"hiliteDescription\":\"highlight population with light green background and red text where population is greater than 3000000\"\n}, {\"fieldName\":\"country\",\n\"textColor\":\"red\",\n\"filterDescription\":\"continent is Africa\",\n\"hiliteDescription\":\"highlight country with red text where continent is Africa\"\n}]\n}\n\n"];isc.A.$270x={"white":"#fff","lightgray":"#ddd","gray":"#aaa","darkgray":"#555","black":"#000","lightred":"#f88","red":"#e00","darkred":"#800","lightpink":"#f9c","pink":"#f69","darkpink":"#f06","lightpurple":"#ccf","purple":"#96f","darkpurple":"#60c","lightorange":"#fc9","orange":"#f71","darkorange":"#f42","lightbrown":"#eb8","brown":"#840","darkbrown":"#320","lightyellow":"#ffa","yellow":"#ff5","darkyellow":"#970","lightgreen":"#cfc","green":"#0f0","darkgreen":"#060","lightblue":"#cff","blue":"#06f","darkblue":"#00c","turquoise":"#3cc","teal":"#088","gold":"#fd0","bronze":"#775","beige":"#db8"};isc.A.$270y=isc.getKeys(isc.ColorUtils.colorNames);isc.A.$265p="workingResponse,validationContext";isc.A.$265o="buildContext,validationContext,callback";isc.A.uiCodeSuffixPrompts="Your response does not need to contain any explanatory text in addition to the JavaScript to execute. Please use a single fenced code block to delineate the JavaScript code. This should be a line of three backtick (`) characters followed by the language specifier (javascript) before the code block, and three backtick (`) characters after the code block. For example:\n```javascript\n// JavaScript code to execute here\n```";isc.A.uiCodeValidationPrompts=["This is a request for a fix to a block of JavaScript code to be executed in an Isomorphic SmartClient web application.\nThe following JavaScript code is intended to generate one or more more UI components to achieve the following goal:\n","${userMessages}","The code is failing validation because some specified property or properties are not valid. The code block is as follows\n```javascript\n${jsCode}\n```\nThe validation errors are reported as follows.\n```JSON\n${errors}\n```\nFor each error the \"nodePath\" attribute uses an xpath-like syntax to describe which component and which field has a problem. For example a nodePath like\n\"root[0||className=ListGrid||ID=grid0]/initialCriteria\"\nwould indicate a problem with the \"initialCriteria\" attribute specified on the first top-level ListGrid component defined in the code, with ID specified as \"grid0\".\nPlease return a fixed version of the code where any invalid attributes have been replaced with an appropriate property based on the Isomorphic SmartClient web framework's documentation."];isc.A.defaultBuildUIViaAIValidationTypes=["default"];isc.A.dataBoundUITypeInfos={"list":{description:"A ListGrid displaying some data from a dataSource. This is appropriate for any list of multiple records, including lists that are aggregated or grouped by values, sorted, filtered, etc.",componentType:"ListGrid",codePrompt:"Note that for ListGrids, a user may request a simple \"grouped\" view. This is different from a true aggregated view and may be achieved via the \"groupByField\" property of the grid.\nExample listGrids:\nGiven a dataSource with ID:\"myDS\", and fields  \"code\" (primary key), \"location\", \"title\", \"description\" and \"price\",the following code would satisfy a user request to view a list of records where price is less than 100, sorted by price in ascending order:\n```javascript\nisc.ListGrid.create({\n        autoFetchData:true,\n        dataSource: \"myDS\",\n        fields:[\n            {name:\"location\"},\n            {name:\"title\"},\n            {name:\"description\"},\n            {name:\"price\"}\n        ],\n        initialCriteria:{\n            fieldName:\"price\",\n            operator:\"lessThan\",\n            value:100\n        },\n        initialSort:[\n            {\n                property:\"price\",\n                direction:\"ascending\"\n            }\n        ]\n    });\n```\nOr, for the same dataSource, the following code would satisfy a user request to show the average price for each location. Note that because we're inferring the 'price' field to be a currency field, we're applying decimalPrecision:2. If the user had requested a specific precision we would respect that instead. :\n```javascript\nisc.ListGrid.create({\n        autoFetchData:true,\n        dataSource: \"myDS\",\n        fields:[\n            {name:\"location\"},\n            {name:\"price\", decimalPrecision:2}\n        ],\n        fetchRequestProperties:{\n            groupBy:[\"location\"],\n            summaryFunctions:{\n                price:\"avg\"\n            }\n        }\n    });\n```\n\nSetting the \"showFilterEditor\" property to true will show an editor that the user can use to customize the filter on the data of the ListGrid. If the user requested a filterable list, or indicated wanting to change or customize which records are displayed, set \"showFilterEditor\" to true."},"chart":{description:"A FacetChart displaying some data from a dataSource. Note that as with lists, a chart may display an aggregated or filtered set of values",componentType:"FacetChart",codePrompt:"Note that the FacetChart you generate should have its \"valueProperty\" set to the numeric-typed field containing data values for records, and facetFields should be used to define facets for the chart.\nThe \"showDataValuesMode\" property should typically be set to \"auto\", unless this conflicts with the user prompt in some way.\nIf a clear, simple title for the chart can be derived from the prompt, include the \"title\" attribute.\nExamples:\nGiven a dataSource with ID:\"myDS\", and fields  \"code\" (primary key), \"location\", \"title\", \"description\" and \"price\",the following code would satisfy a user request to build a chart showing items that cost more than $500 in each location:\n```javascript\nisc.FacetChart.create({\n    ID: \"myChart\",\n    dataSource: \"myDS\",\n    facets: [\n        {\n            id: \"location\",\n            title: \"Location\"\n        },\n        {\n            id: \"title\",\n            title: \"Title\"\n        }\n    ],\n    stacked:false,\n    // valueProperty set to numeric field price\n    valueProperty: \"price\",\n    showDataValuesMode:\"auto\",\n    chartType: \"Column\",\n    autoFetchData: true,\n    initialCriteria:{\n        fieldName:\"unitCost\",\n        operator:\"greaterThan\",\n        value:500\n    }\n});\n```\nOr, for the same dataSource, the following code would satisfy a user request to chart the total number of items for each location:\n```javascript\nisc.FacetChart.create({\n    title: \"Total Items by Location\",\n    dataSource: \"myDS\",\n    facets: [\n        {\n            id: \"location\",\n            title: \"Location\"\n        }\n    ],\n    // The fetchRequestProperties block below uses groupBy and summaryFunction\n    // to generate a count of \"code\" values per location.\n    // Since \"code\" is the primary key for this dataSource it is unique per item,\n    // giving us back item count per location.\n    valueProperty: \"code\",\n    showDataValuesMode:\"auto\",\n    autoFetchData: true,\n    fetchRequestProperties:{ \n        groupBy:[\"location\"],\n        summaryFunctions:{\n            countryCode:\"count\"\n        }\n    }\n});\n```\n\nValid values for the \"chartType\" property are:\n\"Column\" - (the default if not specified) a bar chart with vertical bars\n\"Bar\" - a bar chart with horizontal bars\n\"Line\" - a chart where values are displayed side-by-side, connected by lines\n\"Radar\" - a chart where values are displayed around a circle, connected by lines\n\"Pie\" - a pie chart\n\"Doughnut\" - a pie chart with a center hole\n"},"value":{description:"A Label displaying a single value (scalar) derived from the data in a dataSource",componentType:"ScalarViewer",codePrompt:"ScalarViewer is a component based on a SmartClient DynamicForm which uses the attribute \"fieldName\" to extract a single field value from a record and the attribute \"title\" as a title for the single field value.\nOther standard DynamicForm properties such as \"dataSource\", \"autoFetchData\" and \"initialCriteria\" may be used to populate the item with a single record.\nExamples:\nGiven a dataSource with ID:\"myDS\", and fields  \"code\" (primary key), \"location\", \"title\", \"description\" and \"price\",the following code would display the \"description\" for the some record where \"code\" has the value \"abc123\":\n```javascript\nisc.ScalarViewer.create({\n    autoFetchData:true,\n    dataSource: \"myDS\",\n    title:\"Description for item abc123\",\n    fieldName:\"description\",\n    initialCriteria:{\n        fieldName:\"code\",\n        operator:\"equals\",\n        value:\"abc123\"\n    }\n});\n```\nOr, for the same dataSource, the following code would satisfy a user request to show the average price for items in San Francisco:\n```javascript\nisc.ScalarViewer.create({\n    autoFetchData:true,\n    dataSource: \"myDS\",\n    title:\"Average price of items in San Francisco\",\n    fieldName:\"price\",\n    initialCriteria:{\n        fieldName:\"location\",\n        operator:\"equals\",\n        value:\"San Francisco\"\n    },\n    fetchRequestProperties:{ \n        groupBy:[\"location\"], \n        summaryFunctions:{\n            price:\"avg\"\n        }\n    }\n});\n```\n\nTo control which record is retrieved, it may be necessary to sort by a field, by adding a \"sortBy\" property to the ScalarViewer's \"fetchRequestProperties\" object. The \"sortBy\" property is the name of the field that the data are sorted by, prefixed with a minus sign ('-') if the data should be sorted by the field in descending order.\nFor example, using the same \"myDS\" dataSource, the following code would satisfy the request for the \"location with the highest price\":```javascript\nisc.ScalarViewer.create({\n    autoFetchData:true,\n    dataSource: \"myDS\",\n    title:\"Location with the highest price\",\n    fieldName:\"location\",\n    fetchRequestProperties:{ \n        sortBy: \"-price\"\n    }\n});\n```\nIn this example, the first row, when sorted by the price in descending order, is for the location with the highest price in the dataSource."}};isc.A.dataBoundUIInitiatorPrefixPrompts=["A user is interacting with an Isomorphic SmartClient web application. They have requested a new user-interface component to display data from a dataSource in some way. The user request is as follows:","${userMessages}"];isc.A.dataBoundUIInitiatorPrompt_UIOptions="The user may request one of the following types of user interface components:\n${uiTypeDescriptions}\n";isc.A.dataBoundUIInitiatorPrompt_DSOptions="The following dataSources are available for this component:\n${dsDescriptions}\n";isc.A.dataBoundUIInitiator_UIResponseFormat="Please respond with a JSON object containing the following attribute(s):\n\"component\": The component type name that best matches the user's request, or \"invalid\" if you are unable to determine what kind of data view the user is asking for. This should be one of the following values:\n${uiTypes}\n";isc.A.dataBoundUIInitiator_DSResponseFormat="\"dataSource\": The ID of the dataSource that best matches the user's request, or \"invalid\" if you are unable to determine which dataSource the user is attempting to view data from. This should be one of the following values:\n${dsIDs}\n";isc.A.dataBoundUIInitiatorSuffix="Your response should contain the JSON block and no other text.\nAn example of a valid response might be:\n${responseExample}";isc.A.generalDataBoundUICodeNotes="Notes:\n- The \"dataSource\" attribute of the component should be set to the ID of the dataSource.\n- In order to fetch data to display, \"autoFetchData\" should be set to true.\n- If criteria should be applied to the fetch, the \"initialCriteria\" attribute should be specified as a SmartClient AdvancedCriteria object.\n- If some form of data aggregation or summarization is required---for example a list of each unique value for some field along with a count of records, or sum of some other numeric field value within that group---this can be achieved by customizing the DSRequest that is used to fetch data for the component. The \"fetchRequestProperties\" attribute for the component can be used to set appropriate \"groupBy\" and \"summaryFunctions\" attributes for the data fetch.\n";isc.A.dataBoundUICodePrefixPrompts=["A user is interacting with an Isomorphic SmartClient web application. They have requested a new ${componentType} component to display data from a dataSource in some way. The user request is as follows:","${userMessages}","The DataSource has the following summary:\n${dsSummary}\nPlease generate JavaScript code to create a SmartClient ${componentType} bound to this dataSource that meets the user's request.\n${this.generalDataBoundUICodeNotes}${componentCodePrompt}.\n\n"];isc.A.$274t="asyncBuildDataBoundUI";isc.A.fencedCodeRegex=new RegExp("^```(?:javascript)?\\s*\\n((.|\n)*)\\n```","im");isc.A.autoLoadDataSource=true;isc.A.dataSourceName="serverAIDataSource";isc.A.dataSources={};isc.A.$257l={};isc.A.$257k={};isc.A.spoofedResponseDelay=2000;isc.A.responseSpoofingMode="hybrid";isc.A.$259j=[];isc.A.initiatorPromptTemplate="This is an Isomorphic SmartClient AI Assistant Request (version 1.0).\n*** Overview ***\nFor an Isomorphic SmartClient AI Assistant Request, you are to act as an intelligent agent assisting a user in an Isomorphic SmartClient application.\nDetails of the application and the user request text will be provided at the end after this overview.\nYou should respond to this request with a response in the following structured format. Note that text in square brackets is descriptive. Any other text should be included verbatim:\n\nResponseType: [a response type, as explained below]\nMessage: [a message to be shown to the user, either explaining what you have done or asking for clarifications]\nMessageType: [a message type, as explained below]\n======\n[JavaScript code to perform a requested action when executed in the context of the SmartClient application. Note that the JavaScript should contained between a delineator of 6 equal signs, as shown here. Certain response types (described below) do not require any JavaScript code - in these cases the response may omit this entire block including both sets of equal signs.]\n======\n\n** Response Types **\nThere are six possible response types, described in the following section. \nNote that these are not listed in order of preference - you should choose the appropriate response type based on the prompt you received.\nImmediately after the numeral is the text value you should use for the \"ResponseType\" when responding. Do not include the numeral.\n\n1. Execute JavaScript\nProduce JavaScript code to do what the user wants, along with an explanation of what you have done, to be shown to the user.\nThis ResponseType is appropriate only to perform the same set of actions that a normal user can perform via the running SmartClient application's user interface, and any changes applied to the UI should be reversable by the user, using the UI.\nThis is typically limited to interacting with existing components on the page.\nThe JavaScript you generate should be valid JavaScript and may make use of the Isomorphic SmartClient JavaScript framework APIs.\n* Important Note *\nDetails of the currently visible UI of the application are below in the section titled \"SmartClient application and environment information\"Components listed in this summary may be accessed may be accessed directly by their \"ID\" property, or by passing this property into \"isc.Canvas.getById();\".\nOther documented SmartClient APIs may also be used.\nIf your code either causes a JavaScript error or times out, this will be reported to you.\nThe Message should be some text to display to the user, explaining what was done.\nThe MessageType may be set to either \"Notify\" or \"Modal Message\". MessageType \"Notify\" will show the message as a notification that auto-hides. MessageType \"Modal Message\" will show the message in a modal dialog that the user must explicitly dismiss before proceeding.\nSome examples of requested actions that would require an \"Execute JavaScript\" type response include:\n- Applying sorting to an existing listGrid via \"listGrid.sort();\" or \"listGrid.setSort();\"\n- Changing the filter criteria applied to an existing listGrid via \"listGrid.setFilterEditorCriteria();\" or \"listGridID.filterData();\"\n- Switching to a different tab in a TabSet via \"tabSet.selectTab();\"\nIf the user prompt requires a new UI be created, do not use the \"Execute JavaScript\" response type - use \"Ad Hoc UI\" instead.\n\n2. Ad Hoc UI\nYour generated JavaScript code creates an \"ad hoc\" UI to do whatever the user needs to do.  \nIn this case, the JavaScript code you specify should create SmartClient user interface components. The code will be captured in the same way that SmartClient captures \"screens\" (as in the RPCManager.loadScreen() API) and SmartClient will automatically display the result in a Window component. \nYour code does not need to include this Window component - just create the appropriate UI and it will be displayed to the user as appropriate.\nWhen the Window is closed, the ad-hoc UI created by your code will be destroyed (as in Canvas.destroy()).\nAs with \"Execute JavaScript\":\nThe code you generate should be valid JavaScript and may make use of the Isomorphic SmartClient JavaScript framework APIs.\nThe Message should be some text to display to the user, explaining what was done.\nThe MessageType may be set to either \"Notify\" or \"Modal Message\".\nThe \"Ad Hoc UI\" response type is appropriate for situations where the underlying DataSources provide the ability to achieve the end user's goals, but the UI does not provide an easy way to do what the user wants.  \nSome examples of requested actions that would require an \"Ad Hoc UI\" type response include:\n- Creating an aggregated view of dataSource data when none is available in the default UI. This could be achieved by creating a new ListGrid bound to the appropriate dataSource, and setting \"groupBy\" and  \"summaryFunctions\" on the \"dsRequest\" object passed to listGrid.filterData().\n- Displaying data from a dataSource in a chart by creating a new FacetChart bound to the dataSource, using the \"valuePrompt\" and \"facetFields\" to specify which attributes to chart, and calling fetchData() or filterData() to populate it.\nIn your other kinds of responses, if it's possible to create an ad-hoc UI to do what the user needs, be sure to mention that to the user.  And, if the user specifically requests an ad-hoc UI, take that as a suggestion to use this approach (unless another approach, such as \"Inspect\", is appropriate first).\n\n3. Clarify\nAsk the user for clarifying information.\nFor this type of response, the \"Message\" you specify can be used to ask the user a question. You should not show this message to the user - the application will show it in a modal dialog where the user may type in a response. The user's response will be sent back to you, allowing you to take further action.\nAny \"MessageType\" you specify will be ignored for \"Clarify\" type responses.\n\"Clarify\" type responses do not need to include any JavaScript, but if you do include JavaScript it will be executed in the scope of the application. This allows you to programatically gather information about the current application by using the \"isc.AI.commandComplete()\" method.\nIf you want to make use of this capability, consider the following points when generating your JavaScript code.\n- Your code should always include a call to the method \"isc.AI.commandComplete();\". This method takes a single argument, which can be any JavaScript object or primitive, and we will send this back to you (in addition to the user's response to your question). For example you could determine the current set of (visible) field names in a listGrid by calling \"isc.AI.commandComplete(listGrid.getFieldNames())\".\n- Your code can make use of asynchronous APIs; when your inspection code is complete, it should call the API isc.AI.commandComplete() method, passing any object that can be serialized to JSON. For an asynchronous action, this would typically be done in a callback function.\nFor example - if you wanted to find the total number of records in a DataSource, you could invoke\n  dataSource.fetchData(\n    // criteria - unrestricted fetch\n    null,\n    // callback function\n    function (dsResponse, data, dsRequest) {\n        isc.AI.commandComplete(dsResponse.totalRows);\n    },\n    // dsRequest configuration - use startRow and endRow to avoid returning actual records\n    { startRow:0, endRow:0 }\n  );\nIf you want to return information gathered from multiple APIs, you can combine all necessary information into a single JSON object which your code passes to isc.AI.commandComplete().\n\n4. Inspect\nGenerate JavaScript to gather information\nSimilar to the \"Clarify\" ResponseType explained above, you can generate JavaScript to gather information about the application environment, and have it sent back to you by calling \"isc.AI.commandComplete()\".\nUnlike \"Clarify\" responses, \"Inspect\" responses do not prompt the user for information.\nIf you do include a \"Message\", it will be displayed to the user as either a \"Notification\" or \"Modal Message\" depending on the \"MessageType\" you specified.\nIf necessary you may generate repeated \"Inspect\" type responses to gather multiple pieces of information about the application before finally deciding upon an interactive response to the user, via one of the other ResponseTypes.\n\n5. Send A Message\nThe \"Send A Message\" response type will cause the specified \"Message\" to be displayed to the user and take no other action.\nThis response type should not include any JavaScript to execute.\nThis is useful for cases where you simply want to display a message to the user.\n\n6. Explain Why Not\nExplain to the user that what they want cannot be done, and why.  \nIf possible, provide suggestions for how they might achieve their goals instead, including by contacting other people with administrative access to data.\nThe explanation you provide as the \"Message\" for this response type will appear in a modal SmartClient Window, with a text field below offering the user the ability to provide a revised or clarified command, or the ability to cancel the overall AI interaction.\nThis response type should not include any JavaScript to execute.\nYou should not show this message to the user - the application will show it, according to the MessageType you provide.\n\n** Example **\nAn example of a validly formatted response is below.\nThis response might be appropriate for the following user prompt:\n  \"Show the filterEditor on my listGrid and filter it to only show items that are less than $100 and customer's name contains 'Schwabb'\"\nIn this case we're assuming the application has a listGrid with the ID \"myListGrid\" with fields \"unitCost\" and \"customer\".\nExample response:\n\nResponseType: Execute JavaScript\nMessage: The filter editor for your listGrid has been displayed and the listGrid has been filtered to show only items with unitCost less than $100, where the customer name contains the string \"Schwabb\".\nMessageType: Notify\n======\nmyListGrid.setProperties({showFilterEditor:true});\nmyListGrid.filterData({\n    _constructor:\"AdvancedCriteria\",\n    operator:\"and\",\n    criteria:[\n        {fieldName:\"unitCost\", operator:\"lessThan\", value:100},\n        {fieldName:\"customer\", operator:\"iContains\", value:\"Schwabb\"},\n    ]\n});\n======\n\nDetails about the running application, and the user request are below.\n*** End of overview ***\n";isc.A.suggestRecordSummaryTitlePrompts=["This is a request for a suggested title for a new field of a DataSource. This new field will contain the following information for each record:","${ssMessages}","The DataSource has the following summary: ${dsSummary}"];isc.A.suggestRecordSummaryTitlePrompts_visibleFields="The suggested title should be short (at most 40 characters), succinctly describe the information that will be contained in the new field, and be similar in style to the titles in the following map from existing field names to their titles:\n";isc.A.suggestRecordSummaryTitlePrompts_noVisibleFields="The suggested title should be short (at most 40 characters) and succinctly describe the information that will be contained in the new field. Each word of the suggested title should be capitalized.";isc.A.suggestRecordSummaryTitlePrompts_final="Your response should be a single JSON object with one key \"suggestedTitle\" and value being a string containing the suggested title for the new field.";isc.A.$274u="asyncBuildAIFieldRequest";isc.A.buildAIFieldRequestPrompts=["This is a request to gather information about a request to supplement the data in records from a DataSource. The supplemental information requested for each record is:","${ssMessages}","Note: In this request, ignore directions to \"sort by\", \"order by\", or similar directions that do not describe the supplemental information to generate.\n\nRecords are from the DataSource with the following description: ${dsSummary}\n\nYou must decide what class of supplemental data (\"valueClass\") is requested for each record. The options are:\n- \"general\" Any kind of data. Usually this is textual, but not necessarily always so. An example would be a \"2-4 sentence summary\".- \"categorical\" A fixed list of categories or nominal values. An example would be the type of customer issue (e.g. \"Technical Issue\", \"Billing Issue\", \"General Inquiry\")\n- \"ordinal\" An extension of \"categorical\" where the categories are also strictly ordered from lowest/least to highest/most. An example would be customer satisfaction (e.g. \"Dissatisfied\", \"Neutral\", \"Satisfied\", \"Very Satisfied\")\n- \"interval\" Strictly numerical data. An example would be temperature in degrees Celsius.\n- \"ratio\" An extension of \"interval\" where 0 means the absence of something, and ratios between values are meaningful. An example would be weight in pounds, because 0 means no weight and 200 pounds is twice as heavy as 100 pounds.\n\nYour response must be a JSON object with the following properties:\n{\"valueClass\": The \"valueClass\" for the requested supplemental data, either \"general\", \"categorical\", \"ordinal\", \"interval\", or \"ratio\",\n\"dataDependentReason\": Only if the \"valueClass\" is \"categorical\" or \"ordinal\", it is absolutely not possible to make any reasonable choices for the categories without examining all of the records in the DataSource, and the data of the records reasonably appears to contain the categories, a string containing an explanation of why the list of categories absolutely depends on the records in the DataSource.\n\"categories\": Only if the \"valueClass\" is \"categorical\" or \"ordinal\" and reasonable choices can be made about the categories (i.e. not data-dependent), a JSON array of the category label strings. If the \"valueClass\" is \"ordinal\", this array must be sorted in the order of the categories from lowest/least to highest/most.\n\"categoryHints\": Only if the \"valueClass\" is \"categorical\" or \"ordinal\", a JSON object that maps each category label string to a hint for when to use the category rather than the other categories.\n\"minValue\": Only if the \"valueClass\" is \"interval\" or \"ratio\" and the request specifies or reasonably implies a minimum value, the minimum value as a number.\n\"maxValue\": Only if the \"valueClass\" is \"interval\" or \"ratio\" and the request specifies or reasonably implies a maximum value, the maximum value as a number.\n\"relevantFieldNames\": An array of the names of only the fields from DataSource '${dsName}' that appear to be relevant to generating the supplemental information. You must be able to generate the requested supplemental information for each record using only the values in these fields.\n}"];isc.A.invalidSummaryValue="-";isc.A.$2693="partialResult,context";isc.A.summarizeRecordsPrompts_general=["This is a request to supplement the data in records from a DataSource, using relevant general knowledge and your own reasonable inferences from the data. The supplemental information requested for each record is:","${ssMessages}","The records specified below are from the DataSource with the following description: ${dsSummary}\n\nYour response should be a single JSON object with one key \"result\" and value being an array of just the strings of supplemental information for each corresponding record. Here are the records:"];isc.A.summarizeRecordsPrompts_categorical=["This is a request to select one of the categories for records from a DataSource, using relevant general knowledge and your own reasonable inferences from the data. The category to select for each record is:","${ssMessages}","The available categories are: ${categories}\nHints for when to use each category are: ${categoryHints}\nThe records specified below are from the DataSource with the following description: ${dsSummary}\n\nYour response should be a single JSON object with one key \"result\" and value being an array of just the strings of selected categories for each corresponding record. Here are the records:"];isc.A.summarizeRecordsPrompts_interval=["This is a request to calculate a number for records from a DataSource, using relevant general knowledge and your own reasonable inferences from the data. The number to be calculated for each record is:","${ssMessages}"];isc.A.summarizeRecordsPrompts_interval_minValue="The minimum value is ${minValue}. ";isc.A.summarizeRecordsPrompts_interval_maxValue="The maximum value is ${maxValue}. ";isc.A.summarizeRecordsPrompts_interval_final="The records specified below are from the DataSource with the following description: ${dsSummary}\n\nYour response should be a single JSON object with one key \"result\" and value being an array of just the calculated numbers for each corresponding record. Here are the records:";isc.A.canTranslateViaAI=true;isc.A.componentActions={filter:{methodName:"buildFilter",description:"Apply filter criteria to the component"},hilite:{methodName:"buildHilite",description:"Apply hiliting to the component"},sort:{methodName:"buildSort",description:"Apply a sort to the component"},groupBy:{methodName:"buildGroupBy",description:"Group the components data by some field(s) or ungroup the component"},setFields:{methodName:"buildSetFields",description:"Change the visible set of fields for the component"}};isc.A.multiActionAIWindowDefaults={_constructor:"Window",width:500,height:300,autoCenter:true,showHeaderIcon:true,headerIconProperties:{src:"AIAnswerEngine:size:22,22;"},showMinimizeButton:false,title:"Waiting for AI...",gridDefaults:{_constructor:"ListGrid",width:"100%",height:"100%",fixedRecordHeights:false,emptyMessage:"Determining tasks...   ",wrapCells:true,border:"none",canEdit:false,canShowFilterEditor:false,fields:[{name:"type",title:"Task",width:100},{name:"description",title:"Description",width:"*"},{name:"status",width:30,title:"",type:"image",align:"center"}],initWidget:function(){var _1=isc.Canvas.imgHTML(this.creator.workingIconSrc);this.emptyMessage+=_1;this.fields[2].valueMap=[this.creator.workingIconSrc,this.creator.successIconSrc,this.creator.failureIconSrc];var _2=this.Super("initWidget",arguments);return _2}},successIconSrc:"Accept",failureIconSrc:"Cancel",workingIconSrc:"Configure:cssClass:spinElement;",initWidget:function(){var _1=this.Super("initWidget",arguments);this.grid=this.createAutoChild("grid");this.addItems([this.grid])},setFirstAction:function(_1,_2){if(!_1)this.grid.setData([]);else this.grid.setData([{type:_1,description:_2,status:this.workingIconSrc}]);this.grid.redraw()},addActions:function(_1){for(var _2 in _1){this.grid.addData({type:_2,description:_1[_2],status:this.workingIconSrc})}
this.grid.redraw()},updateAction:function(_1,_2){for(var i=0;i<this.grid.data.length;i++){var _4=this.grid.data[i];if(_4.type==_1){_4.status=_2?this.successIconSrc:this.failureIconSrc;this.grid.redraw();return}}}};isc.B.push(isc.A.init=function isc_c_AI_init(){this.Super("init",arguments);this.startAssistant(this.assistantKey);this.$270z();this.$2700()});isc.evalBoundary;isc.B.push(isc.A.$260x=function isc_c_AI__encodeJSON(_1){return isc.JSON.encode(_1,{prettyPrint:false})},isc.A.doPageRecordsPicking=function isc_c_AI_doPageRecordsPicking(_1,_2,_3,_4){var _5=[{source:"user",content:_1}],_6=this.$2678(_5);return _6.aiEngine.doPageRecordsPicking(_5,_2,_3,_4)},isc.A.$2679=function isc_c_AI__getContextForRequest(_1){if(this.disabled)return{errorMessage:this.aiWasDisabledMessage};var _2=this.getEngine();if(!_2)return{errorMessage:this.defaultAIEngineNotRegisteredErrorMessage.evalDynamicString(this,this)};this.$102q(this.isEnabled());var _3,_4=_2.couldSupportRequest(_1),_5=isc.AIEngine.containsImageMessage(_1.messages);if(_4){_3=_2}else{var _6=isc.getValues(this.engines),i=_6.findIndex(_2);this.$102q(i>=0);if(i>0){_6.removeAt(i);_6.addAt(_2,0)}
for(i=0;i<_6.length;++i){if(i>0&&_6[i].couldSupportRequest(_1)){_3=_6[i];_4=true;break}
if(!_3&&_5&&_6[i].canSupportVisionRequests()){_3=_6[i]}}}
if(!_3){return{errorMessage:_5?this.noAIEngineSupportingVisionRequestsIsRegisteredErrorMessage:"No suitable AIEngine was found."}}
if(!_4){this.logWarn("Will use AIEngine "+_3.engineId+", but it claims not to support the request","AI")}
return{cancellationController:_1.cancellationController,aiEngine:_3,couldSupportRequest:_4,isVisionRequest:_5}},isc.A.$2678=function isc_c_AI__getContextForAIMessages(_1){var _2={messages:_1};return this.$2679(_2)},isc.A.shouldUseAIFieldPaging=function isc_c_AI_shouldUseAIFieldPaging(_1,_2,_3){var _4={messages:[{source:"user",content:_1}]};var _5=this.$2679(_4);return _5.aiEngine.shouldUseAIFieldPaging(_4,_2,_3)},isc.A.retrieveFieldsForPrompt=function isc_c_AI_retrieveFieldsForPrompt(_1,_2,_3,_4,_5,_6){var _7=[{content:_1}];_5=this.$2678(_7);return _5.aiEngine.retrieveFieldsForPrompt(_7,_2,_3,_4,_5,_6)},isc.A.getSerializedFields=function isc_c_AI_getSerializedFields(_1,_2){if(_2==null)_2={};var _3={engineId:_2.engineId,fieldNames:_2.salientFieldAttributes||isc.AI.salientFieldAttributes,recordIndexFieldName:"",serializationFormat:_2.serializationFormat};return this.serializeRecords(_1,_3)},isc.A.getShortDSDescription=function isc_c_AI_getShortDSDescription(_1){var _2={ID:_1.ID};if(_1.title!=null){_2.title=_1.title}
if(_1.pluralTitle!=null){_2.pluralTitle=_1.pluralTitle}
if(_1.description!=null){_2.description=_1.description}
if(_1.titleField!=null){_2.titleField=_1.titleField}
var _3=_1.getPrimaryKeyFieldNames();if(_3!=null&&_3.length>0){if(_3.length==1)_3=_3[0];_2.primaryKey=_3}
return this.echoFull(_2)},isc.A.summarizeDataSource=function isc_c_AI_summarizeDataSource(_1,_2,_3,_4){var _5=this.getShortDSDescription(_1),_6=isc.isAn.Array(_2)&&!_2.isEmpty(),_7=_6&&_4!=false?_1.getSalientFields():[];if(_6){for(var i=0;i<_2.length;++i){var _9=_2[i];if(isc.isA.String(_9))_9=_1.getField(_9);if(_9==null)continue;if(_7.find("name",_9.name)==null){_7.add(_9)}}}
_5+=("\nThis dataSource has the following fields that are relevant to the query:\n"+this.getSerializedFields(_7,_3));return _5},isc.A.serializeRecords=function isc_c_AI_serializeRecords(_1,_2){if(_2==null)_2={};if(_1==null)_1=[];var _3=_2.serializationFormat||this.serializationFormat;if(_3=="csv"&&_2.fieldNames==null&&_1.length>0){_2.fieldNames=isc.getKeys(_1[0])}
var _4=[];for(var i=0;i<_1.length;i++){_4.add(this.serializeIndexedRecord(_1[i],i,_2))}
return this.getFormatDescription(_2)+this.$2590(_4,_2)},isc.A.$2590=function isc_c_AI__joinSerializedRecords(_1,_2){var _3=_2.serializationFormat||this.serializationFormat;var _4=_3!="csv";var _5=_3=="compactJSON";var _6=(_5?",":(_4?",\n":"\n"));var _7=(_5?"[":(_4?"[\n":""))+_1.join(_6)+(_5?"]":(_4?"\n]":""));return _7},isc.A.getFormatDescription=function isc_c_AI_getFormatDescription(_1){if(_1==null)_1={};var _2=_1.serializationFormat||this.serializationFormat;var _3=_2!="csv";var _4=_2=="compactJSON";var _5=(_1.fieldNames&&_1.fieldNames.duplicate())||[];_5.unshift(_1.recordIndexFieldName||this.defaultRecordIndexFieldName);var _6=_5.join(",");var _7=!_3?this.csvFormatDescription:this.jsonFormatDescription;_7=_7.evalDynamicString(this,{fieldNames:_6,separator:this.separatorCharacter});return _7},isc.A.serializeIndexedRecord=function isc_c_AI_serializeIndexedRecord(_1,_2,_3){if(_1==null)return"";if(_3==null)_3={};var _4=_3.serializationFormat||this.serializationFormat;var _5=_4!="csv";var _6=_4=="compactJSON";var _7=_3.fieldNames;if(!_5&&_7==null){_7=isc.getKeys(_1);this.logWarn("serializeIndexedRecord is serializing in a format where attribute names are not included in the output.Attributes will be output in the following order:"+_7.join(","))}
var _8=(_3.recordIndexFieldName!=null?_3.recordIndexFieldName:this.defaultRecordIndexFieldName);var _9=(_8!="");var _10="";if(_4=="csv"){if(_9)_10+=this.$2591(String(_2),_3);for(var _11=0;_11<_7.length;_11++){_10+=((_9||_11>0?this.separatorCharacter:"")+this.$2591(_1[_7[_11]],_3))}}else{if(_7!=null){_1=isc.applyMask(_1,_7)}
if(_9){var _12={};_12[_8]=_2;_1=isc.addProperties(_12,_1)}
_10=isc.JSON.encode(_1,{prettyPrint:!_6})}
return _10});isc.evalBoundary;isc.B.push(isc.A.$2591=function isc_c_AI__csvSerializeAttribute(_1,_2){if(_1==null)return"";return isc.isA.String(_1)?_1.asSource():_1+""},isc.A.isEnabled=function isc_c_AI_isEnabled(){return this.disabled!=true&&(this.defaultEngineId in this.engines||this.engineConfigs.find("engineId",this.defaultEngineId)!=null)},isc.A.registerEngine=function isc_c_AI_registerEngine(_1){if(_1.engineId in this.engines)return false;this.engines[_1.engineId]=_1;return true},isc.A.unregisterEngine=function isc_c_AI_unregisterEngine(_1){if(!(_1 in this.engines))return false;return delete this.engines[_1]},isc.A.getEngine=function isc_c_AI_getEngine(_1,_2){_1=_1||isc.AI.defaultEngineId;var _3=this.engines[_1];if(_3==null){var _4=this.engineConfigs.find("engineId",_1);if(_4==null)return null;var _5=isc.addProperties({engineId:_1,name:_1},_4,_2);var _6=_4._constructor||"AIEngine";_3=isc[_6].create(_5);this.engines[_1]=_3}
return _3},isc.A.allowAssistant=function isc_c_AI_allowAssistant(){return true},isc.A.startAssistant=function isc_c_AI_startAssistant(_1){if(isc.AI.aiReady)return;if(!isc.AI.allowAssistant()){isc.logWarn("No AI engine API key found found.  Can't install AI.","AI");return}
if(_1)isc.AI.assistantKey=_1;_1=isc.AI.assistantKey;var _2=isc.Page.getRegisteredKeyActions(_1);if(_2&&_2.length>0){isc.logWarn("Specified AI shortcut-key ("+JSON.stringify(_1)+") is already in use by another handler. To enable the AI assistant shortcut, call isc.AI.startAssistant() with an unused key-name.","AI");return}
isc.Page.registerKey(_1,function(_1,_3){_3.showAssistant();return false},isc.AI);isc.AI.aiReady=true},isc.A.stopAssistant=function isc_c_AI_stopAssistant(){if(!isc.AI.aiReady){isc.AI.logWarn("Cannot stop the AI Assistant - it isn't running.");return}
isc.Page.unregisterKey(isc.AI.assistantKey,isc.AI);isc.AI.aiReady=false},isc.A.$274v=function isc_c_AI__asyncAIOperation(_1,_2){if(!this.isEnabled()){return isc.rejectAsDisabled(this.aiWasDisabledMessage)}
var _3=Array.prototype.slice.call(arguments,1);return isc.AsyncUtil.asyncOperation(_2,function(_4){_3.push(_4);return isc.AI[_1].apply(isc.AI,_3)})},isc.A.$273t=function isc_c_AI__asyncDataBoundAIOperation(_1,_2){if(!this.isEnabled()){return isc.rejectAsDisabled(this.aiWasDisabledMessage)}
var _3=Array.prototype.slice.call(arguments,1);return isc.AsyncUtil.asyncDataBoundOperation(_2,function(_12){var _4;if(_12.component){_4=_12.component.getAllFields()||[]}else if(_12.dataSource){_4=isc.getValues(_12.dataSource.getFields())}
var _5=_2.relevantFieldNames;if(_4){var _6=_4.makeIndex("name"),_7=isc.getKeys(_6),_8=_2.excludeFieldNames;if(_5){for(var i=0;i<_5.length;++i){var _10=_5[i];if(!_10||_10.contains('.'))continue;if(!_7.contains(_10)&&!_5.contains(_10,i+1))
{isc.AI.logWarn("'"+_10+"' is listed in `relevantFieldNames`, but there is no such field.","AI")}}
_6=isc.applyMask(_6,_5)}
if(_8){for(var i=0;i<_8.length;++i){var _11=_8[i];if(!_11||_11.contains('.'))continue;if(!_7.contains(_11)&&!_8.contains(_11,i+1))
{isc.AI.logWarn("'"+_11+"' is listed in `excludeFieldNames`, but there is no such field.","AI")}
delete _6[_11]}}
_12.availableFields=isc.getValues(_6);_12.availableFieldNames=_12.availableFields.getProperty("name");_12.availableFieldsIndex=_6}else if(_5){isc.AI.logWarn("Relevant field names were specified, but there are no fields. Ignoring...","AI")}
_3.push(_12);return isc.AI[_1].apply(isc.AI,_3)})},isc.A.$273v=function isc_c_AI__wrapAsyncDataBoundAIOperation(_1,_2){var _3=Array.prototype.slice.call(arguments,1,-1),_4=arguments[arguments.length-1];var _5=function(_7){var _6=isc.AI.$273s;isc.AI.fireCallback(_4,_6,[_7,_2])};this[_1].apply(this,_3).$271y(_5)},isc.A.summarizeValue=function isc_c_AI_summarizeValue(_1,_2){this.$273v("asyncSummarizeValue",_1,_2)},isc.A.asyncSummarizeValue=function isc_c_AI_asyncSummarizeValue(_1){return this.$273t("$271m",_1)},isc.A.$271m=function isc_c_AI__asyncSummarizeValue(_1,_2){var _3=_1.aiRequest;if(!_3){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"aiRequest"}))}
var _4=_1.value;if(!_4){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"value"}))}
var _5=["This is a request to supplement a value from a DataSource, using relevant general knowledge and your own reasonable inferences. The supplemental information requested is:","${ssMessages}"];var _6=[{content:_3.prompt,type:_3.promptType}],_7=_3.additionalMessages;if(_7){_6.addList(_7);_6.removeEmpty()}
var _8=_2.availableFields,_9=_1.record,_10=_1.fieldName,_11;if(_8){var _12=_8,_13=_2.availableFieldNames;var _14;if(_10){var _15=_13.indexOf(_10);if(_15<0){this.logWarn("A field with name '"+_10+"' is not available. Ignoring...","AI");_10=null}else{_13.removeAt(_15);_14=_12[_15]}}
if(_2.dataSource){var _16=this.summarizeDataSource(_2.dataSource,_12,{format:"compactJSON"},false);_5.push("The value to be summarized is from "+(_10?"the '"+_10+"' field of ":"")+"the DataSource with the following description: "+_16+"\n\n")}else{this.$102q(_2.component);if(_14){_5.push("The value to be summarized comes from the DataBoundComponent field with the following description (in JSON format): "+this.serializeIndexedRecord(_14,null,{recordIndexFieldName:"",fieldNames:this.salientFieldAttributes,format:"compactJSON"})+"\n\n")}}
if(_9){if(_13.isEmpty()){this.logWarn("The context record was specified, but no additional fields are relevant to the request.","AI")}else{_11={recordIndexFieldName:"",fieldNames:_13,format:"compactJSON"};_5.push("The record that the value is part of is (in JSON format): "+this.serializeIndexedRecord(_9,null,_11)+"\n\n")}}}else{if(_9){this.logWarn("The record was specified, but no fields are available. Ignoring...","AI")}
if(_10){this.logWarn("fieldName was specified, but no fields are available. Ignoring...","AI")}}
var _17=isc.InternalAIMessagesBuilder2.create({ssMessages:_6,messagesSource:_1.aiRequestSource||"system",target:this,evalVars:{value:_4}});_17.appendPrompts(_5);delete _5;var _18=_17.aiMessages;var _19=_1.examples;if(_19&&!_19.isEmpty()){if(_1.valueType!=null&&_1.valueType!="text"){this.logWarn("The valueType of examples must be 'text'. Omitting the examples...","AI")}else{var _20="For example: ";for(var _21=0;_21<_19.length;++_21){var _22=_19[_21];_20+="For the value '"+(_22.value||"")+"'";if(_11&&_22.record){_20+=" and record "+this.serializeIndexedRecord(_22.record,null,_11)}
_20+=", you might generate '"+(_22.summary||"")+"'.\n"}
_18.push({source:"system",content:_20})}}
_18.push({source:"system",content:"Your response should be a single JSON object with one key \"result\" and value being the string of supplemental information for the value. The value is:"});_18.push({content:_4,type:_1.valueType});var _23={messages:_18,responseType:"object",cancellationController:_2.cancellationController};var _24=this.$2679(_23);if(_24.errorMessage)return isc.rejectWithError(_24.errorMessage);var _25={maxRetries:_1.maxRetries};return _24.aiEngine.asyncSendRequest(_23,_25).then(function(_28){var _26=_28.message.content,_27;if(!isc.isAn.Object(_26)||!isc.isA.String(_26.result)||!(_27=_26.result.trim()))
{return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}
return{type:"success",summary:_27}})},isc.A.command=function isc_c_AI_command(_1,_2){if(_1==null)return;if(_2=="complete"){if(_1!=null){}
return}
if(_2!="userQuery"&&_2!="resolveError"&&_2!="userClarification"){return}
if(_2=="userQuery"){isc.AI.lastUserPrompt=_1}
var _3=isc.AI.getSession(),_4=_3[0],_5=_3[1],_6=_3[2];if(_6==null&&this.useClientSessionHistory){_5={};_6=this.sessionMessages=[this.getInitiatorMessage(_5)];_1="** Initial request **\n"+_1}
var _7=function(_9,_10){isc.AI.handleAIResponse(_9,_10.clientContext)};var _8=(_6||[]).concat([{source:(_2=="resolveError"?"system":"user"),content:_1}]);this.sendRequest({messages:_8,historyIntroduction:"You have previously interacted with this user during this session as follows. Input from the user, including contextual information automatically provided by SmartClient, is delineated by "+isc.AI.scPostDelineator+" at the beginning and end of that information. Your responses are delineated by "+isc.AI.aiResponseDelineator+" at the beginning and end.",historyConclusion:"** New request **",historyDelimiters:{user:isc.AI.scPostDelineator,model:isc.AI.aiResponseDelineator}},_7,{clientContext:_5});this.addUserRequestToSessionHistory(_1,_5)},isc.A.sendPrompt=function isc_c_AI_sendPrompt(_1,_2,_3){this.sendRequest({messages:[{source:"user",content:_1}]},_2,_3)},isc.A.sendRequest=function isc_c_AI_sendRequest(_1,_2,_3){_3=isc.addProperties({},_3);var _4=isc.AI.getEngine(_3.engineId);_4.sendRequest(_1,function(_6,_1){var _5=_6.message&&_6.message.content;if(_5==null){_4.logWarn("Unable to extract message from AI response","AI");return}
_4.logDebug("Response text from AI: "+_5,"AI");isc.AI.fireCallback(_2,"messageContent,config",[_5,_3])},_3)},isc.A.estimateTokenCount=function isc_c_AI_estimateTokenCount(_1,_2){var _3=isc.AI.getEngine(_2&&_2.engineId);return _3.estimateTokenCount(_1)},isc.A.getVB=function isc_c_AI_getVB(){if(this.isReify)return window.VB;return null},isc.A.commandComplete=function isc_c_AI_commandComplete(_1){isc.Class.endAEM();if(this.isReify&&this.$2541){isc.AI.getVB().destroyProjectState(this.$2541)}
var _2=isc.AI.lastResponse||{};var _3=_1?isc.JSON.encode(_1):null;isc.logWarn("commandComplete() called - "+(_3?"JSON serialized to: "+_3:"no JSON to serialize"));if(_2.message&&!isc.isAn.emptyString(_2.message)){if(_2.messageType=="Notify")isc.Notify.addMessage(_2.message);else isc.say(_2.message)}
if(_3)isc.AI.command(_3,"complete")},isc.A.getSessionHistory=function isc_c_AI_getSessionHistory(){return this.getSession()[0]},isc.A.getSessionContext=function isc_c_AI_getSessionContext(){return this.getSession()[1]},isc.A.getSessionMessages=function isc_c_AI_getSessionMessages(){return this.getSession()[2]},isc.A.getSession=function isc_c_AI_getSession(){var _1=this.sessionHistory;var _2=this.sessionContext;var _3=this.sessionMessages;return[_1,_2,_3]},isc.A.clearSession=function isc_c_AI_clearSession(){delete this.sessionHistory;delete this.sessionContext;delete this.sessionMessages},isc.A.addUserRequestToSessionHistory=function isc_c_AI_addUserRequestToSessionHistory(_1,_2){if(this.useClientSessionHistory){if(!this.sessionHistory)this.sessionHistory="";this.sessionHistory+="\n"+this.scPostDelineator+_1+this.scPostDelineator;if(!this.sessionMessages)this.sessionMessages=[];this.sessionMessages.push({source:"user",content:_1});if(_2!=null){if(this.sessionContext==null)this.sessionContext={};isc.addProperties(this.sessionContext,_2)}}},isc.A.addAIResponseToSessionHistory=function isc_c_AI_addAIResponseToSessionHistory(_1){if(this.useClientSessionHistory){var _2=isc.AI.cleanAIResponse(_1);if(!this.sessionHistory)this.sessionHistory="";this.sessionHistory+="\n"+this.aiResponseDelineator+_2+this.aiResponseDelineator;if(!this.sessionMessages)this.sessionMessages=[];this.sessionMessages.push({source:"AI",content:_2})}},isc.A.handleAIResponse=function isc_c_AI_handleAIResponse(_1,_2){this.addAIResponseToSessionHistory(_1);var _3=isc.AI.validateAIResponse(_1);this.handleValidatedAIResponse(_3,_2)},isc.A.handleValidatedAIResponse=function isc_c_AI_handleValidatedAIResponse(_1,_2){isc.AI.lastResponse=isc.addProperties({},_1);if(_1.errors&&_1.errors.length>0){this.logWarn("The following errors were found during response validation:"+this.echoAll(_1.errors));if(_1.unableToProcess){this.adjacentValidationFailureCount++;if(this.adjacentValidationFailureCount>4){isc.say("The AI is unable to process this request as written. Please try rephrasing your request.")}else{var _3="The response you shared was not formatted correctly. Please rewrite the response in the specified format. The specific error(s) encountered are as follows:\n- "+_1.errors.join("\n- ");this.command(_3,"resolveError")}
return}}
this.adjacentValidationFailureCount=0;switch(_1.responseType){case"Execute JavaScript":var _4=isc.AI.handleAIJavaScript(_1,_2);break;case"Clarify":this.showClarifyWindow(_1.message);break;case"Inspect":var _4=isc.AI.handleAIJavaScript(_1,_2);break;case"Explain Why Not":case"Send A Message":var _4=isc.AI.commandComplete();break;case"Ad Hoc UI":var _4=isc.AI.handleAIJavaScript(_1,_2);break;default:}},isc.A.getErrorText=function isc_c_AI_getErrorText(_1,_2){return isc.AI.errorTypes[_1].evalDynamicString(this,_2)},isc.A.validateAIResponse=function isc_c_AI_validateAIResponse(_1){var _2=[];var _3={};if(!_1||isc.isAn.emptyString(_1)){_2.add("No Response Content");_3.errors=_2;_3.unableToProcess=true;return _3}else{var _4=isc.AI.parseAIResponse(_1);_3=_4.response;var _5=_3.responseType;if(_4.aiResponse!=_1){_2.add(this.getErrorText("ContainsAIDelineator",_3))}
if(!_5||_5==""){_2.add(this.getErrorText("NoResponseType",_3));_3.unableToProcess=true}else if(!isc.AI.responseTypes.contains(_5)){_2.add(this.getErrorText("BadResponseType",_3));_3.unableToProcess=true}
if(_3.message){if(_5!="Clarify"){if(!_3.messageType){_2.add(this.getErrorText("NoMessageType",_3));_3.unableToProcess=true}else if(!isc.AI.messageTypes.contains(_3.messageType)){_2.add(this.getErrorText("BadMessageType",_3));_3.unableToProcess=true}}}
if(["Send A Message","Explain Why Not","Clarify"].contains(_3.messageType)){if(!_3.message||isc.isAn.emptyString(_3.message)){_2.add(this.getErrorText("NoMessage",_3));_3.unableToProcess=true}else if(_5!="Clarify"){if(!isc.AI.messageTypes.contains(_3.messageType)){_2.add(this.getErrorText("BadMessageType",_3));_3.unableToProcess=true}}}
if((_5=="Inspect"||_5=="Execute JavaScript")&&(!_3.javaScript||_3.javaScript.length==0)){_2.add(this.getErrorText("NoJavaScript",_3));_3.unableToProcess=true}
if(_3.noCommandComplete){if(_5=="Inspect"){_2.add(this.getErrorText("NoCommandComplete",_3));_3.unableToProcess=true}else if(_5=="Execute JavaScript"||_5=="Ad Hoc UI"){_3.fireCommandComplete=true}}}
if(_2.length>0)_3.errors=_2;_3.aiResponse=_1;isc.logInfo(isc.echoFull(_3));return _3},isc.A.cleanAIResponse=function isc_c_AI_cleanAIResponse(_1){var _2=_1.replaceAll(isc.AI.exampleResponseDelineator,"").replaceAll(isc.AI.aiResponseDelineator,"").replaceAll(isc.AI.scPostDelineator,"");return _2},isc.A.parseAIResponse=function isc_c_AI_parseAIResponse(_1){var _2=this.cleanAIResponse(_1);var _3={};_3.responseType=this.retrieveAttributeValue("ResponseType:",_2);_3.messageType=this.retrieveAttributeValue("MessageType:",_2);_3.message=this.retrieveAttributeValue("Message:",_2,["MessageType:","======","ResponseType:"]);_3.javaScript=this.retrieveAttributeValue("======",_2,["======"]);if(_3.javaScript){var _4=new RegExp(/(isc\.AI\.commandComplete\()([\s\S]*?)(\))+/)
if(_3.javaScript.match(_4)==null){_3.noCommandComplete=true}}
return{response:_3,aiResponse:_2}},isc.A.retrieveAttributeValue=function isc_c_AI_retrieveAttributeValue(_1,_2,_3){var _4="(?:$|\\n)";if(_3!=null&&_3.length>0){_4="(?:$|\\n\\s*"+_3.join("|\\n\\s*")+")"}
var _5="(?:\\n|^)\\s*"+_1+"([\\s\\S]*?)"+_4;var _6=_2.match(new RegExp(_5));if(_6!=null)_6=_6.last().trim();return _6},isc.A.handleAIJavaScript=function isc_c_AI_handleAIJavaScript(_1,_2){if(this.isReify){this.$2541=isc.AI.getVB().getProjectState()}
var _3=_1.javaScript,_4=_1.responseType=="Ad Hoc UI",_5;if(_4)_5=isc.noAutoDraw=true;var _6=this;delete this.aemError;var _7=_2&&_2.idMapping;var _8;if(_7){_8={};for(var _9 in _7){var _10=isc.AutoTest.getLocatorCanvas(_7[_9][0]);if(_10!=null){_8[_9]=_10}}}
var _11=isc.Class.evaluateAICode(_3,function(_14){this.aemError=_14;if(_14.errorType=="Timeout"){_6.handleAEMTimeout()}else{_6.handleAEMError(_14.error)}},true,_4,_8);if(this.aemError){delete this.aemError;return}
if(_1.fireCommandComplete){this.commandComplete()}
if(_4){isc.AI.uiWindow=this.createAdHocUIWindow();var _12=_11.globals;var _13=isc.Canvas.$112q(_12,true);isc.AI.uiWindow.setAdHocUI(_13,_1);isc.AI.uiWindow.show()}},isc.A.handleAEMError=function isc_c_AI_handleAEMError(_1){this.resetApplicationState();this.logWarn("Error executing AI-generated script:"+_1);var _2=this.errorTypes["JavaScriptError"];var _3=_1.message,_4=this.getJSErrorHint(_3)||"";var _5=_2.evalDynamicString(this,{error:_1,hint:_4});this.$2542++;if(this.$2542>2){this.$2542=0;isc.say("The AI-generated script has caused an execution error. Please rephrase your request and try again.")}else{this.command(_5,"resolveError")}},isc.A.resetApplicationState=function isc_c_AI_resetApplicationState(){if(this.isReify&&this.$2541!=null){isc.AI.getVB().restoreProjectState(this.$2541);delete this.$2541}else{}},isc.A.getJSErrorHint=function isc_c_AI_getJSErrorHint(_1){var _2="";if(new RegExp("^\S+ is undefined").test(_1)){_2="\nSmartClient components are available by the ID in global scope. SmartClient classes may be accessed via their class name with the prefix \"isc.\" in global scope.\n"}
return _2},isc.A.handleAEMTimeout=function isc_c_AI_handleAEMTimeout(){this.logWarn("Timeout after executing AI-generated script - either the code flow failed to complete, or did not invoke AI.commandComplete() when it completed.")},isc.A.getDataSourceNames=function isc_c_AI_getDataSourceNames(){if(this.applicationDataSources!=null){var _1=[];for(var i=0;i<this.applicationDataSources.length;i++){var _3=this.applicationDataSources[i];if(isc.DataSource.get(_3)!=null){_1.add(_3)}}
return _1}
return(isc.AI.isReify?isc.AI.getVB().getProjectDataSourceNames():isc.DS.getRegisteredDataSourceObjects(true,true,true,true).getProperty("ID"))},isc.A.getDataSourceDefinitions=function isc_c_AI_getDataSourceDefinitions(_1){if(_1==null)_1="pseudocode";if(isc.AI.isReify){return isc.AI.getVB().getProjectDataSourceDefinitions(_1)}else{var _2=this.getDataSourceNames();if(_2&&_2.length>0){_2=_2.map(function(_3){return isc.DataSource.get(_3)})}
return isc.DS.getRegisteredDataSourceDefinitions(_1,false,_2)}},isc.A.getUISummary=function isc_c_AI_getUISummary(_1){var _2=this.customRootCanvas;if(!_2)_2=this.applicationRootCanvas;if(_2==null){if(isc.AI.isReify){var _3=isc.AI.getVB();_2=_3&&_3.getScreenBaseComponent()}else if(isc.AI.isShowcase){var _4=window["featureExplorer_exampleViewer"];if(_4){if(_4.fullScreenExampleWindow&&_4.fullScreenExampleWindow.isDrawn()&&_4.fullScreenExampleWindow.isVisible())
{_2=_4.fullScreenExampleWindow.viewPane.viewContainer}else if(_4.viewPane&&_4.viewPane.isDrawn()&&_4.viewPane.isVisible()){_2=_4.viewPane.viewContainer}}}}
if(_2==null){var _5=isc.Canvas.$tw||[];for(var i=0;i<_5.length;i++){var _7=_5[i];if(_7==null)continue;if(isc.isA.ScreenSpan(_7))continue;if(!_7.isVisible()||!_7.isDrawn()){continue}
if(isc.isA.Menu(_7))continue;if(_7==isc.AI.assistantWindow)continue;if(_7.children!=null){_2=_7;break}}}
if(_2==null)return"";var _8=_2.getUISummary(["data"]);var _9={},_10=isc.JSON.encode(this.postProcessUISummary(_8,_9));return _1?[_10,_9]:_10},isc.A.postProcessUISummary=function isc_c_AI_postProcessUISummary(_1,_2){if(isc.isA.Array(_1)){for(var i=0;i<_1.length;i++){this.postProcessUISummary(_1[i],_2)}}else if(isc.isA.Object(_1)&&!isc.isA.Date(_1)){for(var _4 in _1){this.postProcessUISummary(_1[_4],_2)}}
var _5=_1&&_1.smartClientComponentType;if(_5!=null){_1.$eu=function(_10,_11,_12){var _5=this.smartClientComponentType;var _6={};var _7=this.id;var _8=window[_7];if(_8&&_8._autoAssignedID){var _9=_8.getLocalId();var i=0;_7=_9;while(_2[_7]!=null){_7=_9+"_"+(++i)}
_2[_7]=[isc.AutoTest.getObjectLocator(_8),_9,_8.getScreenId()]}
_6.ID=_7;isc.addProperties(_6,this);delete _6.$eu;delete _6.smartClientComponentType;delete _6.id;return"isc."+_5+".create("+isc.JSON.encode(_6,{prettyPrint:true,leadingIndent:_10})+")"}}
return _1},isc.A.createAdHocUIWindow=function isc_c_AI_createAdHocUIWindow(){return isc.Window.create(isc.AI.adHocUIWindowDefaults)},isc.A.showSaveUIWindow=function isc_c_AI_showSaveUIWindow(_1){if(!isc.AI.saveUIWindow){isc.AI.saveUIWindow=isc.Window.create(isc.AI.saveUIWindowDefaults)}
isc.AI.saveUIWindow.setResponse(_1);isc.AI.saveUIWindow.show();isc.AI.saveUIWindow.bringToFront()},isc.A.hideSaveUIWindow=function isc_c_AI_hideSaveUIWindow(){if(isc.AI.saveUIWindow)isc.AI.saveUIWindow.hide()},isc.A.getScreensDataSource=function isc_c_AI_getScreensDataSource(){if(!this.screensDataSource)this.screensDataSource=this.getLocalDataSource();return this.screensDataSource},isc.A.getLocalDataSource=function isc_c_AI_getLocalDataSource(){return this.$243t({transformRequest:function(_1){if(_1.doNotTrackRPC==null)_1.doNotTrackRPC=!isc.ss.logLocalDSRequests;return _1},_generated:true,storageMode:"allRecords",storageKey:this.savedUIStorageKey})},isc.A.$243t=function isc_c_AI__getLocalDataSource(_1){var _2=this;return isc.LocalDataSource.create(_1,{fields:[{name:"name",primaryKey:true},{name:"response",type:"text",length:1000000}],destroy:function(){return this.Super("destroy")}})},isc.A.saveAdHocUI=function isc_c_AI_saveAdHocUI(_1,_2){isc.AI.getScreensDataSource().addData({name:_1,response:_2});isc.say("Ad Hoc UI saved.")},isc.A.getSavedUI=function isc_c_AI_getSavedUI(_1,_2){isc.AI.getScreensDataSource().fetchData({name:_1},function(_3,_4,_5){if(isc.isAn.Array(_4))_4=_4[0];if(_2)_2(_4)})},isc.A.removeSavedUI=function isc_c_AI_removeSavedUI(_1){isc.AI.getScreensDataSource().removeData({name:_1})},isc.A.showAssistant=function isc_c_AI_showAssistant(_1){if(!isc.AI.assistantWindow){isc.AI.assistantWindow=isc.Window.create(isc.AI.assistantWindowDefaults)}
isc.AI.initAssistantContext(_1);isc.AI.assistantWindow.show()},isc.A.hideAssistant=function isc_c_AI_hideAssistant(){if(isc.AI.assistantWindow)isc.AI.assistantWindow.close()},isc.A.assistantClosed=function isc_c_AI_assistantClosed(){if(this.clearHistoryOnClose&&this.useClientSessionHistory)this.clearSession();delete isc.AI.assistantContext;delete isc.AI.customRootCanvas},isc.A.initAssistantContext=function isc_c_AI_initAssistantContext(_1){if(isc.AI.assistantWindow){if(isc.AI.assistantWindow.isVisible())isc.AI.hideAssistant()}else isc.AI.clearSession();isc.AI.assistantContext=_1;this.customRootCanvas=_1&&_1.rootCanvas},isc.A.useAssistant=function isc_c_AI_useAssistant(_1,_2){isc.AI.initAssistantContext(_2);isc.AI.command(_1,"userQuery")},isc.A.showClarifyWindow=function isc_c_AI_showClarifyWindow(_1){if(!isc.AI.clarifyWindow){isc.AI.clarifyWindow=isc.Window.create(isc.AI.clarifyWindowDefaults)}
var _2=isc.AI.clarifyWindow;_2.label.setContents(_1);_2.form.clearValues();_2.show()},isc.A.hideClarifyWindow=function isc_c_AI_hideClarifyWindow(){if(isc.AI.clarifyWindow)isc.AI.clarifyWindow.hide()},isc.A.getIconURL=function isc_c_AI_getIconURL(_1){return isc.Media.getStockIconSrc("AIAssist")},isc.A._extractJsonResult=function isc_c_AI__extractJsonResult(_1,_2,_3,_4){if(_2==null){_2='{'}
if(_3==null){_3='}'}
var _5=_1.lastIndexOf(_3);if(_5<0)return this.$2593;_1=_1.substring(0,_5+(_4?0:_3.length));var _6;while((_6=_1.indexOf(_2))>=0){_1=_1.substring(_6+(_4?_2.length:0));try{return isc.JSON.decode(_1)}catch($al){if(!_4)_1=_1.substring(_2.length)}}
return this.$2593},isc.A.asyncRepeatRequestOnBatches=function isc_c_AI_asyncRepeatRequestOnBatches(_1,_2,_3,_4,_5){var _6=[];if(!this.isEnabled()){return isc.rejectAsDisabled(this.aiWasDisabledMessage,{aiResponsesForBatches:_6})}
var _7=_4.cancellationController,_8;if(_7){if(_7.canceled){return Promise.reject(_7.asCanceledResult({aiResponsesForBatches:_6}))}
_8=_7.createSubController()}else{_8=isc.CancellationController.create()}
var _9=_4.maxPasses==null?2:_4.maxPasses;if(_9<1){return isc.rejectWithError("Exceeded the maximum number of passes.",{aiResponsesForBatches:_6})}
var _10=this.$2679(_1);if(_10.errorMessage)return isc.rejectWithError(_10.errorMessage,{aiResponsesForBatches:_6});_10.aiResponsesForBatches=_6;var _11=_10.secondPassBatches=[];var _12={maxRetries:_4.maxRetries==null?2:_4.maxRetries};var _13={serializationFormat:"compactJSON",fieldNames:_3,maxRetries:_12.maxRetries,cancellationController:_8,aiPageSize:_4.maxRecordsPerBatch};var _14=_4.$270i;if(!_14){_1=isc.addPropertiesWithAssign({},_1);_1.cancellationController=_8;_14=_10.aiEngine.getBatches(_1,_2,_13)}else{_14=_14.duplicate();for(var i=0;i<_14.length;++i){var _16=_14[i]=isc.addPropertiesWithAssign({},_14[i]);_16.aiRequest=isc.addProperties({},_16.aiRequest);_16.aiRequest.cancellationController=_8}}
var _17=_4.stopOnError!=false;var _18=function(_16,_23){if(_7&&_7.canceled)return;_23.startIndex=_16.startIndex;_23.length=_16.length;_6.push(_23);_23.callbackReturnValue=isc.AI.fireCallback(_5,isc.AI.$270h,[_23,_10]);return _23};var _19=isc.ResolvedValuesMapper.create({values:_14,keepSettledStatus:!_17?true:null,cancellationController:_7,maxConcurrent:_4.maxConcurrent,asyncMap:function(_16){return _10.aiEngine.asyncSendRequest(_16.aiRequest,_12).then(function(_23){return _18(_16,_23)},function(_23){var _20=_23.errorType;if(_9>=2&&_16.length>=2&&(_20=="requestSizeLimitExceeded"||_20=="responseSizeLimitExceeded"))
{_11.addList(_10.aiEngine.splitBatch(_16));return null}
if(_17&&!_8.canceled){_8.cancel("The request for the batch starting at "+_16.startIndex+", length "+_16.length+" failed: "+isc.getAsyncMessage(_23),"external")}
return Promise.reject(_18(_16,_23))})}});return _19.getPromise().then(function(){if(_7&&_7.canceled){return Promise.reject(_7.asCanceledResult({aiResponsesForBatches:_6}))}
if(_11.isEmpty()){isc.AI.$102q(!_17||!_7||!_7.canceled);return{type:"success",aiResponsesForBatches:_6}}
isc.AI.$102q(_9>=2);var _21=isc.addPropertiesWithAssign({},_4);_21.cancellationController=_8;_21.$270i=_11;_21.maxPasses=_9-1;var _22=function(_23,_24){_6.push(_23);return isc.AI.fireCallback(_5,isc.AI.$270h,[_23,_10])};return isc.AI.asyncRepeatRequestOnBatches(_1,_2,_3,_21,_22).then(function(){return{type:"success",aiResponsesForBatches:_6}})})});isc.evalBoundary;isc.B.push(isc.A.buildSort=function isc_c_AI_buildSort(_1,_2,_3,_4){_4=isc.addProperties({},_4,{showPrompt:false,context:_3});var _5=_3.grid||_3.rootCanvas;var _6=_3.dataSource;var _7=_6!=null?isc.getValues(_6.getFields()):_5.getFields();var _8="This is a request for an array of SortSpecifiers to apply to a ListGrid in a web application built with the Isomorphic SmartClient Javascript framework. The SortSpecifiers should fulfill the following user request:\n'"+_1+"'\n";_8+="Your response should include only the SortSpecifiers array and no other text.\n\nEach sort specifier consists of two attributes - 'property' (the property to sort by) and 'direction' (either 'ascending' or 'descending'). If the user is requesting the existing sort be cleared, return an empty array.\n";_8+="For example, an appropriate response to a user request of 'Sort by supplierName, then by unitCost in descending order' might be as follows:\n[{\"fieldName\":\"supplierName\",\"direction\":\"ascending\"},[{\"fieldName\":\"unitCost\",\"direction\":\"descending\"}]\n\n";_8+="For context, what follows is the list of fields available for use in SortSpecifiers - ";if(this.shouldUseAIFieldPaging(_8,_7,_4)){var _9=this;this.retrieveFieldsForPrompt(_1,"Apply sorting by field(s)",_7,function(_10){_9.$2597(_1,_8,_2,_3,_4,_10)},_3,_4)}else{this.$2597(_1,_8,_2,_3,_4,_7)}},isc.A.$2597=function isc_c_AI__buildSortWithFinalFields(_1,_2,_3,_4,_5,_6){_2+=this.getSerializedFields(_6,_5);var _7=this;isc.AI.sendPrompt(_2,function(_9){var _8=_7._extractJsonResult(_9);_7.fireCallback(_3,"result,context",[_8,_4])},_5)},isc.A.buildSetFields=function isc_c_AI_buildSetFields(_1,_2,_3,_4){_4=isc.addProperties({},_4,{showPrompt:false,context:_3});var _5=this.setFieldsFixedPrompt.evalDynamicString(this,{userPrompt:_1})
var _6=_3.grid||_3.rootCanvas;var _7=_6.getAllFields();var _8=[];var _9=[];for(var i=0;i<_7.length;i++){if(!_6.fieldIsVisible(_7[i])){_9.add(_7[i])}else{_8.add(_7[i])}}
_5+=this.setFieldsVisibleFieldsPromptPrefix;_5+=this.getSerializedFields(_8,_4)+"\n\n";if(this.shouldUseAIFieldPaging(_5,_9,_4)){var _11=this;this.retrieveFieldsForPrompt(_1,"Showing and hiding fields in a databound component",_9,function(_12){_11.$2598(_1,_5,_2,_3,_4,_12)},_3,_4)}else{this.$2598(_1,_5,_2,_3,_4,_9)}},isc.A.$2598=function isc_c_AI__buildSetFieldsWithFinalFields(_1,_2,_3,_4,_5,_6){_2+=this.setFieldsHiddenFieldsPromptPrefix;_2+=this.getSerializedFields(_6,_5);var _7=this;isc.AI.sendPrompt(_2,function(_9){var _8=_7._extractJsonResult(_9);_7.fireCallback(_3,"result,context",[_8,_4])},_5)},isc.A.buildGroupBy=function isc_c_AI_buildGroupBy(_1,_2,_3,_4){_4=isc.addProperties({},_4,{showPrompt:false,context:_3});var _5=_3.grid||_3.rootCanvas;var _6=_5.getFields();var _7="This is a request to determine which field or fields to pass to ListGrid.groupBy() in a web application built with the Isomorphic SmartClient Javascript framework. "
_7+="Your response should be strutured as a JSON string containing an array of objects.\nEach object should have the \"fieldName\" attribute set to the field the user wishes to group by.\nIf the user requested any existing grouping be cleared, the response JSON string should contain an array.\n\n";_7+="Examples of appropriate responses to user requests:\n\nrequest:\nGroup by supplierName\nresponse:\n[{\"fieldName\":\"supplierName\"}]\n\nrequest:\nGroup the grid by availability, then by region\nresponse:\n[{\"fieldName\":\"availability\"},{\"fieldName\":\"region\"}]\n\nrequest:\nClear the current grouping\nresponse:\n[]\n\n";_7+="For context, what follows is the list of fields in the Grid.\n";_7+=this.getSerializedFields(_6,_4);_7+="\n\nrequest:\n'"+_1+"'\nresponse:\n";var _8=this;isc.AI.sendPrompt(_7,function(_10){var _9=_8._extractJsonResult(_10);_8.fireCallback(_2,"result,context",[_9,_3])},_4)},isc.A.asyncSendRequest=function isc_c_AI_asyncSendRequest(_1,_2){var _3=this.$2679(_1);if(_3.errorMessage)return isc.rejectWithError(_3.errorMessage);return _3.aiEngine.asyncSendRequest(_1,_2)},isc.A.$262k=function isc_c_AI__supportsAIComponentViews(_1,_2){if(false){return false}
var _3=_1.getID();if(_3==null||isc.DS.get(_3)!==_1)return false;if(!_1.supportsAdvancedCriteria())return false;var _4=_1.getPrimaryKeyFieldNames();if(_4==null||_4.length!=1||!_4[0])return false;return true},isc.A.$267n=function isc_c_AI__createBuildViaAIContext(_1,_2,_3){var _4=_3.cancellationController;var _5={$267o:Promise.withResolvers(),cancellationController:_4,$274w:_4?_4.createSubController():isc.CancellationController.create(),$268c:_1,buildRequest:_2,$261v:0,$261w:0,$261x:null,$261g:{maxRetries:(_2.maxRetries==null?2:_2.maxRetries),serializationFormat:"compactJSON"}};if(_1=="asyncApplyAIFilter")_5.applyRequest=_2;var _6;if(_4){_6=isc.observe(_4,"cancel","isc.AI.$2786(returnVal,observed,observer.$266t,reason,initiator)");isc.addProperties(isc.Page.$2091[_6].observer,{$266t:_5})}
var _7=function(_9){_5.$274w.destroy();if(_6!=null)isc.ignore(_6);var _8=_5.$261x;if(_8&&!_8.destroyed){if(_9.type=="canceled"){_8.hide();_8.destroy()}else{if(_9.type=="error"){isc.AI.$262i(_5,[{category:"error",content:isc.getAsyncMessage(_9)}],true)}
_8.finish(_9.type=="success")}}};_5.$267o.promise.then(_7,_7);return _5},isc.A.$262i=function isc_c_AI__fireAIProgressCallback(_1,_2,_3){if(_1.$274w.canceled)return;var _4=_1.$261v,_5=_1.$261w;this.$102q(_4<=_5);var _6=_1.$261x;if(_6){_6.setProgress(_4,_5);_6.addMessages(_2);if(_3)_6.show()}
isc.AI.fireCallback(_1.buildRequest.progressCallback,isc.AI.$262j,[_1,_4,_5,_2])},isc.A.$265h=function isc_c_AI__cancelBuildViaAI(_1,_2,_3){_1.$267o.reject({type:"canceled",cancellationReason:_2,cancellationInitiator:_3})},isc.A.$2786=function isc_c_AI___handleCancelBuildViaAI(_1,_2,_3,_4,_5){if(!_1)return;this.$102q(_2===_3.cancellationController);this.$265h(_3,_4,_5)},isc.A.$2677=function isc_c_AI__wrapAsyncBuildViaAIOperation(_1,_2,_3){var _4=function(_6){var _5=_1=="asyncApplyAIFilter"?isc.AI.$266z:isc.AI.$265j;isc.AI.fireCallback(_3,_5,[_6,_2])};return this[_1](_2).$271y(_4)},isc.A.$267p=function isc_c_AI__asyncSummarizeUserMessages(_1){var _2=_1.buildRequest,_3=_2.userAIRequest;var _4=[{content:_3.prompt,type:_3.promptType}];if(_3.additionalMessages){_4.addList(_3.additionalMessages);_4.removeEmpty()}
_1.$2616=_4;var _5=[],_6=[];for(var _7=0;_7<_4.length;++_7){if(isc.AIEngine.isImageMessage(_4[_7])){_5.push(_7);_6.push(this.$267q(_4[_7],_1))}}
if(_5.isEmpty()){_1.$2615=_4;return Promise.resolve(_4)}
_1.$2615=_4.duplicate();_1.$261w+=_5.length;this.$262i(_1,[{category:"detail",content:"AI will be asked to summarize your request."}],true);return Promise.all(_6).then(function(_10){var _8=_1.$2615;for(var i=0;i<_5.length;++i){_8[_5[i]]=_10[i]}
isc.AI.$262i(_1,[{category:"success",content:"Finished summarizing your request"}]);return _8})},isc.A.$267q=function isc_c_AI__asyncSummarizeImage(_1,_2){var _3={cancellationController:_2.$274w,messages:[{content:"Summarize in detail the following image:",source:"system"},isc.addProperties({},_1,{source:"user"})]};return this.asyncSendRequest(_3,_2.$261g).then(function(_4){++_2.$261v;isc.AI.$262i(_2);return{content:"An image described as: "+_4.message.content}})},isc.A.$267a=function isc_c_AI__canUseAICriterion(_1,_2){if(_1.$264d!=null&&_1.$264d!=_2.getID()){this.logWarn("'aiFilter' criterion built for DataSource '"+_1.$264d+"' is being used with DataSource '"+_2.getID()+"'.","AI")}
if(_1.$264d!=_2.getID()||!_1.$2615||!isc.isAn.Array(_1.$263s)||!isc.isAn.Array(_1.$263t)||!_1.$263q)
{return false}
var _3=_2.getPrimaryKeyFieldNames();if(_1.$263s.length!=_3.length)return false;for(var i=0;i<_3.length;++i){if(!_1.$263s.contains(_3[i]))return false}
var _5=_2.getFields();for(var i=0;i<_1.$263t.length;++i){if(!(_1.$263t[i]in _5))return false}
if(_1.$263v!=null&&!isc.isA.Class(_1.$263v)){return false}
if(_1.$264f!=null&&!isc.isA.Class(_1.$264f)){return false}
return true},isc.A.$268n=function isc_c_AI__getPromptText(_1,_2){if(this.$267a(_1,_2)){var _3=_1.userAIRequest;if(_3!=null&&isc.AIEngine.$272z(_3.promptType)&&_3.prompt!=null)
{return String(_3.prompt)}}
return""},isc.A.$267j=function isc_c_AI__applyUsableAIFilterCaches(_1,_2,_3){var _4={matchingRecords:null,remainingRecords:null};if(_1.isTrivial){_4.matchingRecords=_2}else{var _5=_1.$263v,_6=_1.$264f;if(!isc.isA.Class(_5))_5=null;if(!isc.isA.Class(_6))_6=null;var _7=_4.matchingRecords=[];if(_5||_6){var _8=_4.remainingRecords=[];var _9=_1.$263s;if(_9.length==1){var _10=_9[0];for(var _11=0;_11<_2.length;++_11){var _12=_2[_11][_10];if(_5&&_5.has(_12)){}else if(_6&&_6.has(_12)){_7.add(_2[_11])}else{_8.add(_2[_11])}}}else{this.$102q(false)}}else _4.remainingRecords=_2}
return _4},isc.A.$2665=function isc_c_AI__clearAICriterionState(_1){delete _1.$2615;delete _1.$264d;delete _1.$263s;delete _1.$263t;delete _1.$263q;delete _1.$68o;if(isc.isA.Class(_1.$263v)){_1.$263v.clear()}
delete _1.$263v;delete _1.$2667;if(isc.isA.Class(_1.$264f)){_1.$264f.clear()}
delete _1.$264f},isc.A.$268o=function isc_c_AI__getCleanAICriterion(_1){var _2=isc.addPropertiesWithAssign({},_1);delete _2.$263v;delete _2.$2667;delete _2.$264f;delete _2.$2631;delete _2.clone;delete _2.criteria;return _2},isc.A.$268p=function isc_c_AI__createFromCleanAICriterion(_1){var _2,_3;if(isc.isAn.Array(_1.$263s)){if(_1.$263s.length==1){_2=isc.Set.create();_3=isc.Set.create()}else{_2=isc.TupleSet.create();_3=isc.TupleSet.create()}}
return isc.addProperties({},_1,{_constructor:"AdvancedCriteria",operator:"aiFilter",$263v:_2,$2667:null,$264f:_3,$2631:true,clone:isc.AI.$2668})},isc.A.$2668=function isc_c_AI__aiCriterionCloneImpl(){return this},isc.A.$267r=function isc_c_AI__createBuildCriterionContext(_1,_2,_3){var _4=this.$267n(_1,_2,_3);_4.dataSource=_3.dataSource;var _5=_2.mode;if(_5==null)_5="hybrid";else if(_5!="aiAssist"&&_5!="AIDE"&&_5!="hybrid"){this.logWarn("unsupported AI service mode '"+_5+"'. Switching to 'hybrid'.");_5="hybrid"}
_4.mode=_5;if(_2.showProgressDialog==null||_2.showProgressDialog){_4.$261x=isc.FilterViaAIProgressDialog.create(_2.progressDialogProperties,{$266t:_4,canCancel:_2.userCanCancel!=false})}
_4.$261w=1;this.$262i(_4,[{category:"detail",content:isc.AI.startingYourRequestDetailMessage}]);return _4},isc.A.buildCriterion=function isc_c_AI_buildCriterion(_1,_2){this.$2677(this.$274q,_1,_2)},isc.A.asyncBuildCriterion=function isc_c_AI_asyncBuildCriterion(_1){return this.$273t("$274x",_1)},isc.A.$274x=function isc_c_AI__asyncBuildCriterion(_1,_2){var _3=this.$267r(this.$274q,_1,_2),_4=_1.dataSource;if(!_4||!this.$262k(_4,_3.mode)){_3.$267o.reject(isc.createErrorResult(this.dataSourceIsRequiredErrorMessage))}else{this.$267p(_3).then(function(_5){return isc.AI.$267s(_5,_3)}).then(function(_5){_3.$267o.resolve({type:"success",criterion:_5})},function(_5){_3.$267o.reject(isc.defaultAsyncOperationCatchCallback(_5))})}
return _3.$267o.promise},isc.A.$267s=function isc_c_AI__asyncBuildCriterionWithSummarizedUserMessages(_1,_2){if(_2.$274w.canceled){return Promise.reject(_2.$274w.asCanceledResult())}
var _3=isc.InternalAIMessagesBuilder.create({userMessages:_1,target:this,evalVars:{dsSummary:"${dsSummary}",advancedCriteriaFormatDescription:this.advancedCriteriaFormatDescription}});if(_2.mode=="aiAssist"){_3.appendPrompts(this.buildCriteriaAIAssistPrompts)}else if(_2.mode=="AIDE"){_3.appendPrompts(this.applyAIFilterPrompts)}else{_3.appendPrompts(this.buildCriteriaHybridPrompts)}
var _4={messages:_3.aiMessages,responseType:"object"};var _5=this.$2679(_4);if(_5.errorMessage)return isc.rejectWithError(_5.errorMessage);var _6=isc.getValues(_2.dataSource.getFields());var _7=_5.aiEngine.shouldUseAIFieldPaging(_4,_6,_2.$261g);if(!_7){return this.$267t(_6,_4,_2)}
++_2.$261w;this.$262i(_2,[{category:"detail",content:isc.AI.willSubsetFieldsDetailMessage}],true);return _5.aiEngine.asyncRetrieveFieldsForPrompt(_4,"Filter data-records according to the user's description of the filter criteria",_6,_5,_2.$261g).then(function(_8){++_2.$261v;isc.AI.$262i(_2,[{category:"success",content:isc.AI.finishedSubsettingFieldsDetailMessage}]);return isc.AI.$267t(_8,_4,_2)})},isc.A.$267t=function isc_c_AI__asyncBuildCriterionWithFinalFields(_1,_2,_3){if(_3.$274w.canceled){return Promise.reject(_3.$274w.asCanceledResult())}
if(_1==null||(_1.removeEmpty(),_1).isEmpty()){return isc.rejectWithError("No fields were selected for use in building the filter criterion.")}
_3.$261z=_1;var _4=this.summarizeDataSource(_3.dataSource,_1,_3.$261g,false);_3.$263q=_4;if(_3.mode=="AIDE"){return Promise.resolve(this.$2663(_3))}
var _5={dsSummary:_4};var _6={cancellationController:_3.$274w,messages:_2.messages.map(function(_9){if(_9.source=="system"&&isc.AIEngine.$272z(_9.type)){return{source:_9.source,content:String(_9.content).evalDynamicString(this,_5)}}
return _9},this),responseType:_2.responseType};if(!_3.$274w.canceled&&_3.$261x)_3.$261x.show();return this.asyncSendRequest(_6,_3.$261g).then(function(_9){++_3.$261v;isc.AI.$262i(_3);var _7=_9.message.content;if(_3.dataSource.isAdvancedCriteria(_7)){var _8=isc.AI.$268v(_7);return isc.AI.$268w(_8,_3)}else if(_7.result=="method2"){return isc.AI.$2663(_3)}else{return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}})},isc.A.$268w=function isc_c_AI__asyncValidateAdvancedCriteria(_1,_2,_3){var _4=_2.$261z.makeIndex("name"),_5=[],_6=this.$268x(isc.DS.copyCriteria(_1),_4,_2.dataSource,_5);if(_6&&_5.isEmpty()){return Promise.resolve(_6)}
if(_3){return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}
++_2.$261w;this.$262i(_2,[{category:"error",content:"AI generated invalid criteria. Will request a fix..."}]);var _7=isc.JSONEncoder.create({dateFormat:"logicalDateString",strictQuoting:true});var _8=isc.InternalAIMessagesBuilder.create({userMessages:_2.$2615,target:this,evalVars:{dsSummary:_2.$263q,encodedCriterion:_7.encode(_1),validationErrors:_5.join("\n"),encodedValidatedCriterion:_6&&_7.encode(_6)}});_8.appendPrompts(this.fixCriterionPrompts);var _9={messages:_8.aiMessages,responseType:"object"};return this.asyncSendRequest(_9,_2.$261g).then(function(_12){++_2.$261v;isc.AI.$262i(_2);var _10=_12.message.content;if(_2.dataSource.isAdvancedCriteria(_10)){var _11=isc.AI.$268v(_10);return isc.AI.$268w(_11,_2,true)}else{return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}})},isc.A.$268v=function isc_c_AI__maskCriterion(_1,_2,_3){if(_1.operator=="and"||_1.operator=="or"||_1.operator=="not")
{var _4=_1.criteria;_1={operator:_1.operator,criteria:_4};if(!isc.isAn.Array(_4))_4=_1.criteria=[_4];for(var i=0;i<_4.length;){var _6=_4[i];if(_6==null){_4.removeAt(i);continue}
if(isc.isAn.Array(_6)){_4.addListAt(_6,i);_6=_4[i]}
if(isc.isAn.Object(_6))_4[i]=this.$268v(_6,_2,true);++i}}else{_1=isc.applyMask(_1,_2||this.allowedCriterionPropertyNames)}
if(!_3)_1._constructor="AdvancedCriteria";return _1},isc.A.$268x=function isc_c_AI__validateCriterion(_1,_2,_3,_4,_5){if(!_1.operator){_4.push("A criterion was missing the 'operator'.");return null}
var _6=_1.operator,_7=_3.getSearchOperator(_6);if(!_7||!this.$268u.contains(_6)){_4.push("Operator '"+_6+"' is not allowed.");return null}
if(_7.valueType=="none"){delete _1.value}else if(_7.valueType=="criteria"){var _8=_1.criteria;if(!isc.isAn.Array(_8))_8=_1.criteria=[_8];for(var i=0;i<_8.length;){var _10=_8[i];if(_10==null){_8.removeAt(i);continue}
if(!isc.isAn.Object(_10)){_4.push("A subcriterion was not an object.");_8.removeAt(i);continue}
var _11=_8[i]=this.$268x(_10,_2,_3,_4,true);if(!_11){_8.removeAt(i);continue}
++i}}else if(_7.valueType&&_7.valueType!="fieldType"){_4.push("Operator '"+_6+"' is not allowed because the operator valueType is '"+_7.valueType+"'.");return null}else{var _12=_1.fieldName;if(!_12){_4.push("The '"+_6+"' criterion was missing the 'fieldName'.");return null}
var _13=_2[_12];if(!_13){_4.push("The '"+_6+"' criterion referenced field '"+_12+"', but that field is not allowed.");return null}}
if(!_5){_1=_3.validateCriteria(_1);_1=this.$268y(_1,_2,_3,_4);_1=isc.DS.simplifyAdvancedCriteria(_1,true)}
return _1},isc.A.$268y=function isc_c_AI__validateCriterion2(_1,_2,_3,_4,_5){var _6=_1.operator,_7=_3.getSearchOperator(_6);this.$102q(_7!=null);if(_7.valueType=="criteria"){var _8=_1.criteria;this.$102q(isc.isAn.Array(_8));for(var _9=_8.length;_9>0;--_9){var i=_9-1,_11=_8[i];var _12=_8[i]=this.$268y(_11,_2,_3,_4,true);if(!_12){_8.removeAt(i)}}}else if("fieldName"in _1){var _13=_1.fieldName,_14=_2[_13];var _15=_3.getFieldOperators(_14);if(!_15||!_15.contains(_6)){_4.push("Operator '"+_6+"' is not allowed for field '"+_13+"'.");return null}}
return _1},isc.A.$2663=function isc_c_AI__buildAIFilter(_1){var _2=_1.dataSource.getPrimaryKeyFieldNames();var _3,_4;if(_2.length==1){_3=isc.Set.create();_4=isc.Set.create()}else{_3=isc.TupleSet.create();_4=isc.TupleSet.create()}
var _5=_1.buildRequest.$2664;if(_5)isc.AI.$2665(_5);else _5={};isc.addProperties(_5,{_constructor:"AdvancedCriteria",operator:"aiFilter",userAIRequest:_1.buildRequest.userAIRequest,isTrivial:false,$2615:_1.$2615,$264d:_1.dataSource.getID(),$263s:_2,$263t:_1.$261z.getProperty("name"),$263q:_1.$263q,$263v:_3,$2667:null,$264f:_4,$2631:true,clone:isc.AI.$2668});return _5},isc.A.$267u=function isc_c_AI__createApplyAIFilterContext(_1,_2,_3){var _4=this.$267n(_1,_2,_3);this.$102q(_2.aiCriterion.operator=="aiFilter");var _5=_2.aiCriterion&&_2.aiCriterion.$264d;_4.dataSource=_5&&isc.DS.get(_5);if(_2.showProgressDialog==true){_4.$261x=isc.FilterViaAIProgressDialog.create(_2.progressDialogProperties,{$266t:_4,canCancel:_2.userCanCancel!=false})}
this.$262i(_4,[{category:"detail",content:isc.AI.startingYourRequestDetailMessage}]);return _4},isc.A.applyAIFilter=function isc_c_AI_applyAIFilter(_1,_2){this.$2677(this.$274r,_1,_2)},isc.A.asyncApplyAIFilter=function isc_c_AI_asyncApplyAIFilter(_1){return this.$274v("$267w",_1)},isc.A.$267w=function isc_c_AI__asyncApplyAIFilter(_1,_2){if(!_1.aiCriterion||_1.aiCriterion.operator!="aiFilter"){return isc.rejectWithError("The 'aiFilter' AdvancedCriteria to evaluate is required.")}
if(!_1.records){return isc.rejectWithError("The records to apply the AI filter to are required.")}
var _3=this.$267u(this.$274r,_1,_2),_4=_3.dataSource;if(!_4||!isc.AI.$262k(_4,"AIDE")){_3.$267o.reject(isc.createErrorResult(isc.AI.dataSourceIsRequiredErrorMessage))}else{var _5=_1.aiCriterion;this.$102q(_5.operator=="aiFilter");if(!isc.AI.$267a(_5,_4)){_3.$267o.reject(isc.createErrorResult("The 'aiFilter' criterion is not usable."))}else{this.$267v(_5,_3).then(function(_6){_3.$267o.resolve({type:"success",matchingRecords:_6})},function(_6){_3.$267o.reject(isc.defaultAsyncOperationCatchCallback(_6))})}}
return _3.$267o.promise},isc.A.$267v=function isc_c_AI__asyncApplyUsableAICriterion(_1,_2){var _3=_2.applyRequest.records,_4=_2.applyRequest.$267i||isc.AI.$267j(_1,_3,_2.dataSource);this.$102q(_4&&isc.isAn.Array(_4.matchingRecords)&&_4.matchingRecords.length+(_4.remainingRecords==null?0:_4.remainingRecords.length)==_3.length);if(!_4.remainingRecords||_4.remainingRecords.length==0){return Promise.resolve(_4.matchingRecords)}
return this.$274y(_4,_1,_2)},isc.A.$274y=function isc_c_AI___asyncApplyAIFilter(_1,_2,_3){if(_3.$274w.canceled){return Promise.reject(_3.$274w.asCanceledResult())}
var _4=isc.InternalAIMessagesBuilder.create({userMessages:_2.$2615,target:this,evalVars:{dsSummary:_2.$263q}});_4.appendPrompts(this.applyAIFilterPrompts);var _5=_4.aiMessages;var _6=_1.remainingRecords,_7=_6.getLength(),_8=Promise.withResolvers();var _9=function(){if(_3.$274w.canceled){return false}
++_3.$261v;isc.AI.$262i(_3,null,true)};var _10={fieldNames:_2.$263t,aiPageSize:_3.applyRequest.aiPageSize,maxRetries:_3.$261g.maxRetries,serializationFormat:_3.$261g.serializationFormat,progressCallback:_9};var _11=this.$2678(_5);if(_11.errorMessage)return isc.rejectWithError(_11.errorMessage);var _12=_11.aiEngine.doPageRecordsPicking(_5,_6,function(_22,_23){if(_3.$274w.canceled)return;var _13=_23.find({_constructor:"AdvancedCriteria",fieldName:"nonSuccessfulResult",operator:"notNull"});if(_13){_8.reject(_13.nonSuccessfulResult);return}
_1.matchingRecords.addAll(_22);var _14=_2.$263s;var _15=_2.$263v,_16=null,_17=_2.$264f;if(_14.length==1){var _18=_14[0];for(var i=0;i<_22.length;++i){_17.add(_22[i][_18])}
for(var i=0;i<_7;++i){var _20=_6.get(i)[_18];if(!_17.has(_20)){_15.add(_20)}}
if(!_15.isEmpty()){_16={_constructor:"AdvancedCriteria",fieldName:_18,operator:"notInSet",value:_15.getContents()}}}else{isc.AI.$102q(false)}
_2.$2667=_16;isc.AI.$262i(_3,null,true);_8.resolve(_1.matchingRecords)},_10);var _21=_12.batches.length;_3.$261w+=_21;this.$262i(_3,[{category:"detail",content:"AI will evaluate the criteria in "+_21+" batch(es) of records."}],true);return _8.promise},isc.A.removeFromAIFilterCaches=function isc_c_AI_removeFromAIFilterCaches(_1,_2){if(_1.operator!="aiFilter"){this.logWarn("The AdvancedCriteria passed to removeFromAIFilterCaches() has operator '"+_1.operator+"'; expecting 'aiFilter'.","AI");return}
var _3=_1.$263s,_4=_1.$263v,_5=_1.$264f;if(!isc.isA.Class(_4)){_4=_1.$263v=null;_1.$2667=null}
if(!isc.isA.Class(_5)){_5=_1.$264f=null}
if(!isc.isAn.Array(_3))return;if(_3.length==1){var _6=_3[0];if(isc.isA.Class(_4)){var _7=false;for(var _8=0;_8<_2.length;++_8){if(_4.remove(_2[_8][_6]))_7=true}
if(_7){_1.$2667={_constructor:"AdvancedCriteria",fieldName:_6,operator:"notInSet",value:_4.getContents()}}}
if(isc.isA.Class(_5)){for(var _8=0;_8<_2.length;++_8){_5.remove(_2[_8][_6])}}}else{this.$102q(false)}},isc.A.clearAIFilterCaches=function isc_c_AI_clearAIFilterCaches(_1){if(_1.operator!="aiFilter"){this.logWarn("The AdvancedCriteria passed to clearAIFilterCaches() has operator '"+_1.operator+"'; expecting 'aiFilter'.","AI");return}
if(isc.isA.Class(_1.$263v)){_1.$263v.clear()}
_1.$263v=null;_1.$2667=null;if(isc.isA.Class(_1.$264f)){_1.$264f.clear()}
_1.$264f=null},isc.A.asyncReapplyAIFilter=function isc_c_AI_asyncReapplyAIFilter(_1){if(!_1.aiCriterion||_1.aiCriterion.operator!="aiFilter"){return isc.rejectWithError("The 'aiFilter' AdvancedCriteria to re-apply is required.")}
if(!isc.isAn.Array(_1.updatedRecords)){return isc.rejectWithError("The updated records are required.")}
this.removeFromAIFilterCaches(_1.aiCriterion,_1.updatedRecords);var _2=isc.addProperties({},_1,{showProgressDialog:_1.showProgressDialog!=true,records:_1.updatedRecords,updatedRecords:null});return this.asyncApplyAIFilter(_2).then(function(_3){_3.matchingUpdatedRecords=_3.matchingRecords;delete _3.matchingRecords;return _3})},isc.A.$2701=function isc_c_AI__createBuildHilitesContext(_1,_2,_3){var _4=this.$267n(_1,_2,_3);_4.dataSource=_3.dataSource;var _5=_2.mode;if(_5==null)_5="hybrid";else if(_5!="aiAssist"&&_5!="AIDE"&&_5!="hybrid"){this.logWarn("unsupported AI service mode '"+_5+"'. Switching to 'hybrid'.");_5="hybrid"}
_4.mode=_5;if(_2.showProgressDialog==null||_2.showProgressDialog){_4.$261x=isc.HiliteViaAIProgressDialog.create(_2.progressDialogProperties,{$266t:_4,canCancel:_2.userCanCancel!=false})}
_4.$261w=2;this.$262i(_4,[{category:"detail",content:isc.AI.startingYourRequestDetailMessage}]);return _4},isc.A.buildHilites=function isc_c_AI_buildHilites(_1,_2){this.$2677(this.$274s,_1,_2)},isc.A.asyncBuildHilites=function isc_c_AI_asyncBuildHilites(_1){return this.$273t("$274z",_1)},isc.A.$274z=function isc_c_AI__asyncBuildHilites(_1,_2){var _3=this.$2701(this.$274s,_1,_2),_4=_3.dataSource;if(!_4||!isc.AI.$262k(_4,_3.mode)){_3.$267o.reject(isc.createErrorResult(isc.AI.dataSourceIsRequiredErrorMessage))}else{this.$267p(_3).then(function(_5){return isc.AI.$2702(_5,_3)}).then(function(_5){_3.$267o.resolve({type:"success",hilites:_5})},function(_5){_3.$267o.reject(isc.defaultAsyncOperationCatchCallback(_5))})}
return _3.$267o.promise});isc.evalBoundary;isc.B.push(isc.A.$270z=function isc_c_AI__extendColorMap(){var _1=this.$270x;_1.lightgrey=_1.lightgray;_1.grey=_1.gray;_1.darkgrey=_1.darkgray;_1.silver=_1.gray;_1.platinum=_1.lightgray},isc.A.$2702=function isc_c_AI__asyncBuildHilitesWithSummarizedUserMessages(_1,_2){if(_2.$274w.canceled){return Promise.reject(_2.$274w.asCanceledResult())}
var _3=isc.getValues(_2.dataSource.getFields());var _4=isc.InternalAIMessagesBuilder.create({cancellationController:_2.$274w,userMessages:_1,target:this,evalVars:{dsSummary:"${dsSummary}"}});_4.appendPrompts(this.buildHilitesPrompts);var _5={messages:_4.aiMessages,responseType:"object"};return this.$2703(_2,_5,_3)},isc.A.$2703=function isc_c_AI__asyncBuildHilitesWithFinalFields(_1,_2,_3){if(_1.$274w.canceled){return Promise.reject(_1.$274w.asCanceledResult())}
if(_3==null||(_3.removeEmpty(),_3).isEmpty()){return isc.rejectWithError("No fields were selected for use in building the Hilite.")}
_1.$261z=_3;var _4=this.summarizeDataSource(_1.dataSource,_3,_1.$261g,false);_1.$263q=_4;var _5={dsSummary:_4};var _6={cancellationController:_1.$274w,messages:_2.messages.map(function(_13){if(_13.source=="system"&&isc.AIEngine.$272z(_13.type)){return{source:_13.source,content:String(_13.content).evalDynamicString(this,_5)}}
return _13},this),responseType:_2.responseType};if(!_1.$274w.canceled&&_1.$261x)_1.$261x.show();return this.asyncSendRequest(_6,_1.$261g).then(function(_13){var _7=_13.message.content&&_13.message.content.hilites;if(!isc.isAn.Array(_7)){if(isc.isAn.Object(_7)){_7=[_7]}else{return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}}
for(var _8=_7.length;_8>0;--_8){var i=_8-1,_10=_7[i];if(!isc.isAn.Object(_10)||!isc.isA.String(_10.filterDescription)||!isc.isA.String(_10.hiliteDescription)||!_10.filterDescription.trim()||!_10.hiliteDescription.trim())
{_7.removeAt(i)}}
if(_7.isEmpty()){return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}
var _11=_7.length;++_1.$261v;isc.AI.$262i(_1,[{category:"success",content:"AI has determined the hilite styling and field(s) that should be hilited, for "+_11+" hilite(s)."},{category:"detail",content:"Will now validate the hilite and apply the hilite criteria\u2026"}]);var _12=isc.ResolvedValuesMapper.create({values:_7,cancellationController:_1.$274w,maxConcurrent:3,asyncMap:function(_10){return isc.AI.$2704(_1,_10)}});return _12.getPromise()})},isc.A.$2700=function isc_c_AI__makeLikelyCSSColorRegExp(){var _1="\\b(?:"+this.$270y.map(RegExp.$2680).join("|")+")\\b";_1+="|#[a-f\\d]{3}(?:[a-f\\d](?:[a-f\\d]{2}(?:[a-f\\d]{2})?)?)?\\b";var _2="(?:[-+]?\\d+(?:\\.\\d*)?(?:[Ee][-+]?\\d+)?%?)";_1+="|rgba?\\(\\s*"+_2+"\\s*,?\\s*"+_2+"\\s*,?\\s*"+_2+"(?:\\s*,\\s*"+_2+")?\\)";this.$2705=new RegExp(_1)},isc.A.$2706=function isc_c_AI__extractLikelyCSSColor(_1){this.$2705.lastIndex=0;var _2=this.$2705.exec(_1);return _2&&_2[0]},isc.A.$2707=function isc_c_AI__validateCSSColor(_1,_2){var _3=_1[_2];if(!isc.isA.String(_3)){delete _1[_2];return}
_3=_3.trim().toLowerCase();var _4;for(var _5=new RegExp("[a-z]+","g"),_6=_5.exec(_3);_6;_6=_5.exec(_3)){_4=this.$270x[_6[0]];if(_4){break}}
if(!_4){_4=this.$2706(_3)}
if(!_4)delete _1[_2];else _1[_2]=_4},isc.A.$2708=function isc_c_AI__removeCSSComments(_1){var _2=0;do{_2=_1.indexOf("/*",_2);if(_2<0)return _1;var _3=_1.indexOf("*/",_2+1);if(_3<0){return _1.substring(0,_2)}
_1=_1.substring(0,_2)+_1.substring(_3+2)}while(_2<_1.length);return _1},isc.A.$2709=function isc_c_AI__removeCSSProperty(_1,_2,_3,_4){var _5;var _6=new RegExp("[\\s;]*"+RegExp.$2680(_2)+"\\s*:([^;]*)[\\s;]*","gim");var _7;while(_7=_6.exec(_1)){_5=_7[1]+" "+(_5||"");var _8=_1.substring(0,_6.lastIndex-_7[0].length),_9=_1.substring(_6.lastIndex),_10=!_8||!_9?"":";";_1=_8+_10+_9;_6.lastIndex-=_7[0].length}
_3[_4]=(_3[_4]||"")+" "+_5;return _1},isc.A.$2704=function isc_c_AI__asyncValidateAndFinishHilite(_1,_2){if(_2.fieldName!=null){if(!isc.isAn.Array(_2.fieldName))_2.fieldName=[_2.fieldName];for(var _3=_2.fieldName.length;_3>0;--_3){var i=_3-1,_5=_2.fieldName[i];if(!_1.$261z.find("name",_5)){isc.logWarn("AI selected an invalid field '"+_5+"'. Deleting...","AI");_2.fieldName.removeAt(i)}}
if(_2.fieldName.isEmpty())delete _2.fieldName;else if(_2.fieldName.length==1)_2.fieldName=_2.fieldName[0]}
if(!isc.isA.String(_2.cssText)){delete _2.cssText}else{_2.cssText=this.$2708(_2.cssText);_2.cssText=this.$2709(_2.cssText,"color",_2,"textColor");_2.cssText=this.$2709(_2.cssText,"background-color",_2,"backgroundColor");_2.cssText=this.$2709(_2.cssText,"text-decoration-color",_2,"$271a");this.$2707(_2,"$271a");if(_2.$271a){if(_2.cssText)_2.cssText+="; ";_2.cssText+="text-decoration-color: "+_2.$271a}}
this.$2707(_2,"textColor");this.$2707(_2,"backgroundColor");if(!_2.textColor){if(!_2.backgroundColor){_2.textColor=this.$270x["red"]}else{if(isc.ColorUtils.isDark(_2.backgroundColor)){_2.textColor="#fff"}}}
var _6={cancellationController:_1.$274w,userAIRequest:{prompt:_2.filterDescription},dataSource:_1.dataSource,mode:_1.mode,maxRetries:_1.buildRequest.maxRetries,showProgressDialog:false};return isc.AI.asyncBuildCriterion(_6).then(function(_10){var _7=isc.applyMask(_2,["backgroundColor","textColor","cssText","fieldName","replacementValue"]);var _8=_10.criterion;_7.criteria=_8;if(_8.operator!="aiFilter")return _7;var _9={cancellationController:_1.$274w,aiCriterion:_8,dataSource:_1.dataSource,mode:_1.mode,records:_1.buildRequest.records,maxRetries:_1.buildRequest.maxRetries,showProgressDialog:false};return isc.AI.asyncApplyAIFilter(_9).then(Promise.resolve(_7))})},isc.A.$2672=function isc_c_AI__validateAIBuiltUI(_1){var _2=_1.buildRequest;var _3=_1.$261c,_4=_1.$261d,_5;var _6=function(){_1.appliedValidationTypes.add(_5);_4=_1.$261d=_4+1;_1.$261e=0;_1.$261f=null;++_1.$261v;isc.AI.$262i(_1,[{category:"success",content:"Finished applying '"+_5+"' validation"}])};for(;_4<_3.length;_6()){if(_1.$274w.canceled){_1.$2671.reject(_1.$274w.asCanceledResult());return}
_5=_3[_4];var _7=Math.max(0,+_1.$261e);if(isNaN(_7))_7=_1.$261e=0;var _8=Math.max(0,_2.maxValidationRetries==null?1:_2.maxValidationRetries);if(isNaN(_8))_8=1;if(_7>_8){_1.$2671.reject(isc.createErrorResult("Exceeded the maximum number of retries ("+_8+") for '"+_5+"' validation."));return}
var _9;if(_5=="custom"){_9=_2.customValidator;this.$102q(_9!=null)}else if(_5=="default"){_9={target:this,methodName:"buildUIViaAIDefaultValidator"}}
if(_9==null){this.logWarn("validateAIBuiltUI(): Unhandled validation type '"+_5+"'");continue}
this.fireCallback(_9,isc.AI.$265o,[_1,_1.$261f,function(_12,_13){var _10=String.prototype.trim.call(_12.jsCode||"");_1.jsCode=_10;_1.nodes=_12.nodes;_1.$261f=_13;var _11=_12.errorMessage;if(_11!=null){isc.AI.logDebug("validateAIBuiltUI(): validation type '"+_5+"' failed: "+_11,"AI");_11="Validation type '"+_5+"' failed: "+_11;if(_10==""){_1.$2671.reject(isc.createErrorResult("Validation type '"+_5+"' failed: "+_11));return}
++_1.$261e;if(_1.$261e<=_8){try{if(!new RegExp("\\p{P}$","u").test(_11))_11+="."}catch(e){}
if(!/\s$/.test(_11))_11+=" ";_11+="Will retry\u2026"}
isc.AI.$262i(_1,[{category:"recoverableError",content:_11}])}else{_6()}
isc.AI.$2672(_1)}]);return}
_1.$2671.resolve({type:"success",jsCode:_1.jsCode,nodes:_1.nodes})},isc.A.$261q=function isc_c_AI__getPaletteNodesAndValidationResult(_1,_2,_3){var _4=function(_6,_7){var _5;try{_5=isc.EditContext.validatePaletteNodeDefaults(_7)}catch(e){_2(e);return}
_3(_6,_5)};isc.EditContext.createPaletteNodesFromJS2(_1,_4)},isc.A.buildUIViaAIDefaultValidator=function isc_c_AI_buildUIViaAIDefaultValidator(_1,_2,_3){var _4=this;var _5=function(_6){_4.fireCallback(_3,isc.AI.$265p,[_6,_2])};if(isc.EditContext==null){return _5({jsCode:_1.jsCode,nodes:_1.nodes})}
if(_2==null){_2={prevJsCode:[],prevValidationResults:[]}}
this.$261q(_1.jsCode,function(_6){_4.logWarn("buildUIViaAIDefaultValidator(): Error attempting to validate AI-built code: "+_6);_5({errorMessage:"Attempting to validate AI-generated JavaScript caused an error: "+_6})},function(_6,_7){_2.prevJsCode.add(_1.jsCode);_2.prevValidationResults.add(_7);if(_7==null||isc.isAn.emptyObject(_7)){return _5({jsCode:_1.jsCode,nodes:_6})}else{_4.requestUICodeValidationFix(_1,_2,_7,_3);return}})},isc.A.requestUICodeValidationFix=function isc_c_AI_requestUICodeValidationFix(_1,_2,_3,_4){var _5=function(_13){isc.AI.fireCallback(_4,isc.AI.$265p,[_13,_2])};var _6=function(_13){_5({type:"error",errorMessage:_13,jsCode:_1.jsCode})};var _7=isc.InternalAIMessagesBuilder.create({userMessages:_1.$2615,target:this,evalVars:{jsCode:_1.jsCode,errors:this.$260x(_3)}});_7.appendPrompts(this.uiCodeValidationPrompts);_7.appendPrompts(this.uiCodeSuffixPrompts);var _8={cancellationController:_1.$274w,messages:_7.aiMessages};this.asyncSendRequest(_8,_1.$261g).then(function(_11){var _9=_11.message.content||"";var _10=String.prototype.trim.call(isc.AI.extractFencedCode(_9));if(_10==""){return _6("AI returned no UI code in response to the request to generate corrected code.")}
isc.AI.$261q(_10,function(_13){isc.AI.logWarn("requestUICodeValidationFix(): Error attempting to validate AI-built code: "+_13);return _6("Attempting to validate AI-generated JavaScript caused an error: "+_13)},function(_13,_14){if(_14==null||isc.isAn.emptyObject(_14)){return _5({jsCode:_10,nodes:_13})}else{_5({jsCode:_10,errorMessage:"AI returned code that failed validation. A request was made to correct the code."})}})},function(_13){var _11=isc.defaultAsyncOperationCatchCallback(_13);if(_11.type=="canceled"){var _12="An AI request was canceled. ";if(_11.cancellationReason)_12+=_11.cancellationReason;_5({type:_11.type,cancellationReason:_12});return}
_6("An AI request failed: "+_11.errorMessage)})},isc.A.$2670=function isc_c_AI__createBuildUIViaAIContext(_1,_2,_3){var _4=this.$267n(_1,_2,_3);var _5=_2.$261c;if(_5==null){_5=isc.AI.defaultBuildUIViaAIValidationTypes}
if(_2.customValidator==null){if(_5.contains("custom")){_5=_5.duplicate();_5.remove("custom")}}else{if(!_5.contains("custom")){_5=_5.duplicate();_5.add("custom")}}
_4.$261c=_5;_4.appliedValidationTypes=[];_4.$261d=0;_4.$261e=0;_4.$261f=null;_4.$2671=Promise.withResolvers();_4.$261w=2+_5.length;if(_2.showProgressDialog==null||_2.showProgressDialog){_4.$261x=isc.BuildUIViaAIProgressDialog.create({$266t:_4,canCancel:_2.userCanCancel!=false});_4.$261x.show()}
this.$262i(_4,[{category:"detail",content:isc.AI.startingYourRequestDetailMessage}]);return _4},isc.A.buildDataBoundUI=function isc_c_AI_buildDataBoundUI(_1,_2){this.$2677(this.$274t,_1,_2)},isc.A.asyncBuildDataBoundUI=function isc_c_AI_asyncBuildDataBoundUI(_1){return this.$274v("$2740",_1)},isc.A.$2740=function isc_c_AI__asyncBuildDataBoundUI(_1,_2){var _3;var _4=this.$2670(this.$274t,_1,_2);var _5=_1.availableDataSources||isc.AI.getDataSourceNames();if(_5==null){_3=isc.AI.noDataSourcesAvailableOrFoundErrorMessage}else{if(!isc.isAn.Array(_5))_5=[_5];var _6=_5.map(function(_10){return isc.DS.get(_10)});_6.removeEmpty();if(_6.isEmpty()){_3=isc.AI.noDataSourcesAvailableOrFoundErrorMessage}else{_4._dataSources=_6}}
var _7,_8;if(_3==null){_7=this.dataBoundUITypeInfos;if(_1.allowedUITypes!=null){_7=isc.applyMask(_7,_1.allowedUITypes);_8=isc.getKeys(_7);if(_8.length!=_1.allowedUITypes.length){var _9=_1.allowedUITypes.duplicate();_9.removeList(_8);_3="buildDataBoundUI() was passed unknown data-bound UI type(s): "+_9}}else{_8=isc.getKeys(_7)}
if(_8.isEmpty()){_3="At least one UI type must be allowed."}}
_4.$261h=_8;_4.$261i=_7;if(_3!=null){_4.$267o.reject(isc.createErrorResult(_3))}else{this.$267p(_4).then(function(_10){return isc.AI.$2673(_10,_4)}).then(_4.$267o.resolve,function(_10){_4.$267o.reject(isc.defaultAsyncOperationCatchCallback(_10))})}
return _4.$267o.promise},isc.A.$2673=function isc_c_AI__asyncBuildDataBoundUIWithSummarizedUserMessages(_1,_2){if(_2.$274w.canceled){return Promise.reject(_2.$274w.asCanceledResult())}
var _3=_2._dataSources,_4=_2.$261i,_5=_2.$261h;this.$102q(!_3.isEmpty());this.$102q(!_5.isEmpty());var _6={component:_5[0]};var _7=(_3.length>1);if(_7){_6.dataSource="someDataSourceID"}
var _8="";for(var i=0;i<_5.length;++i){var _10=_5[i];_8+="\n\""+_10+"\": "+_4[_10].description}
var _11={uiTypeDescriptions:_8,uiTypes:this.$260x(_5),responseExample:this.$260x(_6)};if(_7){var _12={};for(var i=0;i<_3.length;i++){var _13=_3[i];_12[_13.ID]=this.getShortDSDescription(_13)}
_11.dsDescriptions=this.$260x(_12);_11.dsIDs=this.$260x(_3.getProperty("ID"))}
var _14=isc.InternalAIMessagesBuilder.create({userMessages:_1,target:this,evalVars:_11});_14.appendPrompts(this.dataBoundUIInitiatorPrefixPrompts);_14.appendPrompt(this.dataBoundUIInitiatorPrompt_UIOptions);if(_7){_14.appendPrompt(this.dataBoundUIInitiatorPrompt_DSOptions)}
_14.appendPrompt(this.dataBoundUIInitiator_UIResponseFormat);if(_7){_14.appendPrompt(this.dataBoundUIInitiator_DSResponseFormat)}
_14.appendPrompt(this.dataBoundUIInitiatorSuffix);var _15={cancellationController:_2.$274w,messages:_14.aiMessages,responseType:"object"};return this.asyncSendRequest(_15,_2.$261g).then(function(_18){var _16=_18.message.content;var _10=_16.component;if(_10==null||_10=="invald")
{return isc.rejectWithError("AI could not determine a data-bound UI type to use to satisfy the request.")}
if(!_2.$261h.contains(_10)){return isc.rejectWithError("AI requested to use the unavailable or unknown UI type '"+_10+"'.")}
_2.uiType=_10;if(_7){var _17=_16.dataSource;if(_17==null||_17=="invalid")
{return isc.rejectWithError("AI could not determine which available data source to use to satisfy the request.")}
var _13=_2._dataSources.find("ID",_17);if(_13==null){return isc.rejectWithError("AI requested to use the unavailable or unknown data source '"+_17+"'.")}
_2.dataSource=_13}else{_2.dataSource=_3[0]}
++_2.$261v;isc.AI.$262i(_2,[{category:"success",content:"Gathered initial information about your request"},{category:"detail",content:"AI will build a "+_10+(_7?" using data source '"+_17+"'.":".")}]);return isc.AI.$2674(_2)})},isc.A.$2674=function isc_c_AI__asyncRequestDataBoundUICode(_1){var _2=isc.getValues(_1.dataSource.getFields());var _3=_1.$261i[_1.uiType];var _4=isc.InternalAIMessagesBuilder.create({userMessages:_1.$2615,target:this,evalVars:{componentType:_3.componentType,dsSummary:"${dsSummary}",componentCodePrompt:_3.codePrompt}});_4.appendPrompts(this.dataBoundUICodePrefixPrompts);_4.appendPrompts(this.uiCodeSuffixPrompts);var _5={messages:_4.aiMessages};var _6=this.$2679(_5);if(_6.errorMessage)return isc.rejectWithError(_6.errorMessage);var _7=_6.aiEngine.shouldUseAIFieldPaging(_5,_2,_1.$261g);if(!_7){return this.$2675(_2,_5,_1)}
++_1.$261w;this.$262i(_1,[{category:"detail",content:isc.AI.willSubsetFieldsDetailMessage}],true);return _6.aiEngine.asyncRetrieveFieldsForPrompt(_5,"Build a component to show data from a dataSource",_2,_6,_1.$261g).then(function(_8){++_1.$261v;this.$262i(_1,[{category:"success",content:isc.AI.finishedSubsettingFieldsDetailMessage}]);return isc.AI.$2675(_8,_5,_1)})},isc.A.$2675=function isc_c_AI__asyncBuildDataBoundUIWithFinalFields(_1,_2,_3){if(_3.$274w.canceled){return Promise.reject(_3.$274w.asCanceledResult())}
if(_1==null||(_1.removeEmpty(),_1).isEmpty()){return isc.rejectWithError("No fields were selected for use in building the data-bound UI.")}
_3.$261z=_1;var _4=this.summarizeDataSource(_3.dataSource,_1,_3.$261g,false);var _5={dsSummary:_4};var _6={cancellationController:_3.$274w,messages:_2.messages.map(function(_9){if(_9.source=="system"&&isc.AIEngine.$272z(_9.type)){return{source:_9.source,content:String(_9.content).evalDynamicString(this,_5)}}
return _9},this)};return this.asyncSendRequest(_6,_3.$261g).then(function(_9){if(_3.$274w.canceled){return Promise.reject(_3.$274w.asCanceledResult())}
var _7=_9.message.content||"";var _8=String.prototype.trim.call(isc.AI.extractFencedCode(_7));if(_8==""){return isc.rejectWithError("AI did not generate any UI code.")}
++_3.$261v;isc.AI.$262i(_3,[{category:"success",content:"AI generated UI code. Will now validate\u2026"}]);_3.jsCode=_8;isc.AI.$2672(_3);return _3.$2671.promise})},isc.A.buildDataUI=function isc_c_AI_buildDataUI(_1,_2,_3,_4){var _5;var _6={userAIRequest:{prompt:_1}};if(_3==null){_5="context is required to build a dataUI"}else{_6.availableDataSources=_3.dataSources}
if(_5==null){_6.allowedUITypes=_3.uiTypeNames}
var _7="status,result,context";if(_5!=null){return this.fireCallback(_2,_7,[-1,_5,_3])}
this.getEngine().buildDataBoundUI(_6,function(_8){_5=_8.errorMessage;if(_5!=null){isc.AI.fireCallback(_2,_7,[-1,_5,_3])}else{isc.AI.fireCallback(_2,_7,[0,_8.jsCode,_3])}})},isc.A.extractFencedCode=function isc_c_AI_extractFencedCode(_1){var _2=_1.match(this.fencedCodeRegex);if(_2==null||_2.length<2)return _1;return _2[1]},isc.A.getAIModel=function isc_c_AI_getAIModel(_1){var _2=isc.AI.getEngine(_1);return _2.model},isc.A.loadDataSource=function isc_c_AI_loadDataSource(_1){if(isc.DS.get(_1)){this.dataSourceLoaded(_1);return}
if(!_1||this.$257l[_1])return;this.$257l[_1]=true;isc.DS.load(_1,{target:this,methodName:"dataSourceLoaded"},{loadParents:true})},isc.A.dataSourceLoaded=function isc_c_AI_dataSourceLoaded(_1){delete this.$257l[_1];var _2=this.dataSources[_1]=isc.DataSource.get(_1);if(_2==null){this.$257k[_1]=true}else{var _3=this.$260m;this.$260m=[];for(var i=0;i<_3.length;i++){var _5=_3[i];_5.engine.handleSendRequest(_5.rawRequest,_5.aiRequest,_5.callback,_5.config)}}},isc.A.$2500=function isc_c_AI__getDataSource(_1,_2){var _3=isc.AI.getEngine(_1),_4=_3.getDataSourceName(_2),_5=this.dataSources[_4];var _6=this.dataSources[_4];if(_6&&!_6.$259m){_6.addProperties({$259m:true,$259n:_6.transformRequest,transformRequest:function(_9){if(this.$259n){var _7=this.$259n(_9)}
if(_9.dataProtocol=="clientCustom"){var _8=_9.clientContext;if(_8&&(_8.spoofingMode=="full"||_8.spoofedResponse!=null))
{isc.AI.createSpoofedResponse(_9)}}
return _7}})}
return _6},isc.A.createSpoofedResponse=function isc_c_AI_createSpoofedResponse(_1){var _2=_1.clientContext;if(_2.spoofedResponse==null||_2.spoofingMode=="full"){this.promptForSpoofedResponse(_1)}else{if(_2.spoofedResponse.deferProcessSpoofedResponse){if(_2.spoofedResponse.dsRequest){this.processSpoofedResponse(_2.spoofedResponse.dsRequest,_2.spoofedResponse)}
_2.spoofedResponse.dsRequest=_1}else{var _3=_2.spoofedResponse.getDelay||isc.isA.Number(_2.spoofedResponse.delay);this.delayCall("processSpoofedResponse",[_1,_2.spoofedResponse],_3?0:this.spoofedResponseDelay)}}},isc.A.processSpoofedResponse=function isc_c_AI_processSpoofedResponse(_1,_2){if(_1===_2.dsRequest){delete _2.dsRequest}
if(!_2.deferProcessSpoofedResponse&&(_2.getDelay||isc.isA.Number(_2.delay)))
{var _3;if(_2.getDelay){var _4=_1.clientContext;_3=_2.getDelay(_4.aiRequest,_4.aiEngine)}else{_3=_2.delay}
this.delayCall("$2697",[_1,_2],_3)}else{this.$2697(_1,_2)}},isc.A.$2697=function isc_c_AI__processSpoofedResponse(_1,_2){_1.clientContext.dataSource.processResponse(_1.requestId,{$260o:true,status:0,data:_2})},isc.A.promptForSpoofedResponse=function isc_c_AI_promptForSpoofedResponse(_1){var _2=_1.clientContext;var _3=isc.DynamicForm.create({autoDraw:false,width:"100%",height:"*",numCols:1,titleOrientation:top,items:[{editorType:"HeaderItem",value:_2.aiEngine.name+" Request"},{name:"prompt",titleOrientation:"top",value:_2.aiRequest.prompt,width:"*"},{name:"messages",titleOrientation:"top",editorType:"CanvasItem",width:"*",height:"*",minHeight:400,shouldSaveValue:true,value:_2.aiRequest.messages,createCanvas:function(){var _4=this.$260p=isc.ListGrid.create({$260q:this,autoDraw:false,width:"100%",height:"100%",canEdit:true,canFilter:false,canSort:false,canGroupBy:false,canRemoveRecords:true,canReorderFields:false,wrapCells:true,fixedRecordHeights:false,alternateRecordStyles:true,fields:[{name:"source",title:"Source",width:100,valueMap:["user","system","AI"]},{name:"content",title:"Content",width:"*",editorType:"TextAreaItem",editorProperties:{minHeight:100,canHover:false},formatCellValue:function(_14,_15,_16,_17,_18){if(!_14)return"";if(_15.type=="jpegImage"||_15.type=="pngImage")
{var _5=isc.AIEngine.$269b(_15),_6=_18.getColumnWidth(1);return"<img src='data:"+_5+";base64,"+_14.asHTML()+"' style='width:"+_6+"px'>"}else if(isc.isAn.Object(_14)){return isc.JSON.encode(_14,{dateFormat:"logicalDateString"})}
return String(_14).asHTML()}}],getEditorType:function(_14,_15){if(_14.name=="content"&&_15&&isc.AIEngine.isImageMessage(_15)){return"Base64ImageDataItem"}
return this.Super("getEditorType",arguments)},getEditorProperties:function(_14,_15,_16){var _7=this.Super("getEditorProperties",arguments);if(_14.name=="content"&&_15&&isc.AIEngine.isImageMessage(_15)){_7.accept="image/jpeg,image/png";_7.mimeType=isc.AIEngine.$269b(_15);_7.changed=function(_17,_18,_19){var _5=this.mimeType,_8=this.grid.getEditSession(_16);_8.$31x.type=_5=="image/jpeg"?"jpegImage":"pngImage"}}
return _7},getCellVAlign:function(_14,_15,_16){return(_16==0?"top":"center")},dataChanged:function(){this.$260q.storeValue(this.data)}});var _9=isc.Button.create({autoDraw:false,title:"+",autoFit:true,click:function(){_4.startEditingNew()}});return isc.VLayout.create({autoDraw:false,width:"100%",height:"100%",members:[_4,_9]})},showValue:function(_14,_15){if(this.$260p==null)return;this.$260p.setData(_15)}},{editorType:"HeaderItem",value:"Response"},{editorType:"ButtonItem",title:"Generate AI Response",click:function(_14){var _10=_14.getItem("messages"),_4=_10.$260p;if(_4)_4.endEditing();var _11=_14.getItem("$269c");if(_11)_11.disable();_2.aiEngine.sendRequest(isc.addProperties({},_2.aiRequest,{prompt:_14.getValue("prompt"),messages:_10.getValue()}),function(_15,_16){if(_11)_11.enable();var _12=_15.message&&_15.message.content;if(_15.message&&(_15.message.type=="array"||_15.message.type=="object")){_12=isc.JSON.encode(_12)}
_14.setValue("response",_12)},{responseSpoofingMode:"none"})}},{name:"response",editorType:"TextAreaItem",showTitle:false,width:"*",height:100,value:_2.spoofedResponse},{name:"$269c",editorType:"ButtonItem",title:"Process Response",click:function(){isc.AI.delayCall("processSpoofedResponse",[_1,{value:this.form.getValue("response")}]);this.form.parentWindow.markForDestroy()}}]});var _13=isc.Window.create({title:"Create AI Response",width:700,height:"90%",canDragResize:false,autoCenter:true,showCloseButton:false,items:[_3]});_3.parentWindow=_13;_13.show()});isc.evalBoundary;isc.B.push(isc.A.setDefaultSpoofedResponse=function isc_c_AI_setDefaultSpoofedResponse(_1){this.$259o=_1==null?null:{value:_1}},isc.A.addSpoofedResponses=function isc_c_AI_addSpoofedResponses(_1){this.$259j.addList(_1)},isc.A.addSpoofedResponse=function isc_c_AI_addSpoofedResponse(_1){this.$259j.add(_1)},isc.A.clearSpoofedResponses=function isc_c_AI_clearSpoofedResponses(){this.$259j=[]},isc.A.removeSpoofedResponse=function isc_c_AI_removeSpoofedResponse(_1){var _2=this.$259j.findIndex(_1);if(_2!=-1){this.$259j.removeAt(_2)}},isc.A.removeSpoofedResponses=function isc_c_AI_removeSpoofedResponses(_1){this.$259j.removeList(_1)},isc.A.getSpoofedResponse=function isc_c_AI_getSpoofedResponse(_1,_2){var _3=_2.makePromptText(_1);for(var _4=0;_4<this.$259j.length;++_4){var _5=this.$259j[_4];var _6=false;if(isc.isA.Number(_5.numMatchesRemaining)){if(_5.numMatchesRemaining<=0)continue}else if(_5.singleUse){_5.numMatchesRemaining=1}
if(_5.matchesPrompt!=null){_6=_5.matchesPrompt(_3,_5)}else if(_5.prompt!=null){var _7=_5.textMatchStyle||"iContains",_8=_7.startsWith("i")?_3.toLowerCase():_3,_9=_7.startsWith("i")?_5.prompt.toLowerCase():_5.prompt;switch(_7){case"contains":case"iContains":_6=_8.contains(_9);break;case"startsWith":case"iStartsWith":_6=_8.startsWith(_9);break;case"endsWith":case"iEndsWith":_6=_8.endsWith(_9);break;case"equals":case"iEquals":default:_6=(_8==_9);break}}
if(_6){if(isc.isA.Number(_5.numMatchesRemaining))--_5.numMatchesRemaining;if(isc.isAn.Object(_5.value)){_5.value=isc.JSON.encode(_5.value,{dateFormat:"logicalDateString"})}
return _5}}
if(this.$259o!=null)return this.$259o},isc.A.getInitiatorMessage=function isc_c_AI_getInitiatorMessage(_1){var _2=this.getDataSourceDefinitions();var _3=this.getUISummary(true);var _4=_3[0];if(_1!=null){_1.idMapping=_3[1]}
var _5=navigator.userAgent;var _6=this.initiatorPromptTemplate.evalDynamicString();_6+=this.getApplicationOverviewPrompt(_2,_4,_5);return{source:"system",content:_6,type:"text"}},isc.A.getApplicationOverviewPrompt=function isc_c_AI_getApplicationOverviewPrompt(_1,_2,_3){var _4="** SmartClient application and environment information **\n";if(this.isShowcase){_4+="The user is interacting with a sample application user interface with the following description:\n\n";_4+=window["featureExplorer_exampleDescription"].getContents()+"\n\n"}
_4+="Partial code for the DataSources present in this application is below, with only important properties shown:\n";_4+=_1+"\n\n";_4+="Partial code for the currently visible UI of the application is below, with only important properties shown.\nComponents listed in this summary may be referenced directly by their \"ID\" property or by passing that ID to \"isc.Canvas.getById()\".\"\n\n"
_4+=_2+"\n\n";_4+="The SmartClient version is \""+isc.version+"\" and the browser's userAgent is \""+_3+"\".\n";return _4},isc.A.handleAITransportError=function isc_c_AI_handleAITransportError(_1,_2,_3,_4){var _5=_1.URL||"";if(_5.startsWith("https://api.openai.com/")){return true}else{return false}},isc.A.asyncSuggestRecordSummaryTitle=function isc_c_AI_asyncSuggestRecordSummaryTitle(_1){return this.$273t("$273w",_1)},isc.A.suggestRecordSummaryTitle=function isc_c_AI_suggestRecordSummaryTitle(_1,_2){this.$273v("asyncSuggestRecordSummaryTitle",_1,_2)},isc.A.$273w=function isc_c_AI__asyncSuggestRecordSummaryTitle(_1,_2){var _3=_1.aiRequest;if(!_3){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"aiRequest"}))}
var _4=_2.dataSource;if(!_4){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"dataSource"}))}
var _5=[{content:_3.prompt,type:_3.promptType}],_6=_3.additionalMessages;if(_6){_5.addList(_6);_5.removeEmpty()}
var _7=_5;var _8=_1.visibleFieldNames,_9;if(!_8){var _10;if(_2.component&&(_10=_2.component.getVisibleFields())){var _11=_10.getProperty("name");_9=isc.getValues(isc.applyMask(_2.availableFieldsIndex,_11))}else{_9=_2.availableFields.duplicate()}}else{var _12=_2.availableFieldNames;for(var i=0;i<_8.length;++i){var _14=_8[i];if(!_12.contains(_14)&&!_8.contains(_14,i+1))
{this.logWarn("'"+_14+"' was specified in `visibleFieldNames`, but there is no such available field.","AI")}}
_9=isc.getValue(isc.applyMask(_2.availableFieldsIndex,_8))}
if(_9){for(var _15=_9.length;_15>0;--_15){var i=_15-1,_16=_9[i],_14=_16.name,_17=_16.title;if(!isc.isA.nonemptyString(_14)||!isc.isA.String(_17)||isc.isAn.emptyString(_17.trim())||_16.canView==false||_16.hidden==true)
{_9.removeAt(i)}}
if(_9.isEmpty())_9=null}
var _18=isc.InternalAIMessagesBuilder2.create({ssMessages:_7,messagesSource:_1.aiRequestSource,target:this,evalVars:{dsSummary:"${dsSummary}",dsName:_4.ID}});_18.appendPrompts(this.suggestRecordSummaryTitlePrompts);if(_9){var _19={};for(var i=0;i<_9.length;++i){var _16=_9[i];_19[_16.name]=_16.title}
_18.appendPrompt(this.suggestRecordSummaryTitlePrompts_visibleFields+this.$260x(_19))}else{_18.appendPrompt(this.suggestRecordSummaryTitlePrompts_noVisibleFields)}
_18.appendPrompt(this.suggestRecordSummaryTitlePrompts_final);var _20={messages:_18.aiMessages,responseType:"object"};var _21=_2.availableFields,_22=_2.availableFieldNames;var _23=this.summarizeDataSource(_4,_21,{format:"compactJSON"},false);var _24={dsSummary:_23};var _25={cancellationController:_2.cancellationController,messages:_20.messages.map(function(_30){if(_30.source=="system"&&isc.AIEngine.$272z(_30.type)){return{source:_30.source,content:String(_30.content).evalDynamicString(this,_24)}}
return _30},this),responseType:_20.responseType};var _26=this.$2679(_20);if(_26.errorMessage)return isc.rejectWithError(_26.errorMessage);var _27={maxRetries:_1.maxRetries};return _26.aiEngine.asyncSendRequest(_25,_27).then(function(_30){var _28=_30.message.content,_29;if(!isc.isAn.Object(_28)||!isc.isA.String(_28.suggestedTitle)||!(_29=_28.suggestedTitle.trim()))
{return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}
return{type:"success",suggestedTitle:_29,relevantFieldNames:_22}})},isc.A.isAIFieldRequestNumerical=function isc_c_AI_isAIFieldRequestNumerical(_1){var _2=_1.valueClass;return _2=="ordinal"||_2=="interval"||_2=="ratio"},isc.A.$272h=function isc_c_AI__createBuildAIFieldRequestContext(_1,_2,_3){var _4=this.$267n(_1,_2,_3);_4.dabOpContext=_3;if(_2.showProgressDialog==true){_4.$261x=isc.BuildViaAIProgressDialog.create(_2.progressDialogProperties,{$266t:_4,canCancel:_2.userCanCancel!=false});_4.$261x.show()}
_4.$261w=1;this.$262i(_4,[{category:"detail",content:isc.AI.startingYourRequestDetailMessage}]);return _4},isc.A.buildAIFieldRequest=function isc_c_AI_buildAIFieldRequest(_1,_2){this.$2677(this.$274u,_1,_2)},isc.A.asyncBuildAIFieldRequest=function isc_c_AI_asyncBuildAIFieldRequest(_1){return this.$273t("$272i",_1)},isc.A.$272i=function isc_c_AI__asyncBuildAIFieldRequest(_1,_2){if(!_1.userAIRequest){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"userAIRequest"}))}
var _3=_2.dataSource;if(!_3){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"dataSource"}))}
var _4=this.$272h(this.$274u,_1,_2);this.$274f(_1,_2,_4).then(function(_5){_4.$267o.resolve({type:"success",aiFieldRequest:_5})},function(_5){_4.$267o.reject(isc.defaultAsyncOperationCatchCallback(_5))});return _4.$267o.promise},isc.A.$274f=function isc_c_AI___asyncBuildAIFieldRequest(_1,_2,_3){var _4=_1.userAIRequest;var _5=[{content:_4.prompt,type:_4.promptType}],_6=_4.additionalMessages;if(_6){_5.addList(_6);_5.removeEmpty()}
var _7=_5;var _8=_2.component,_9=_2.dataSource;var _10=isc.InternalAIMessagesBuilder2.create({ssMessages:_7,target:this,evalVars:{dsSummary:"${dsSummary}",dsName:_9.ID}});_10.appendPrompts(this.buildAIFieldRequestPrompts);var _11={messages:_10.aiMessages,responseType:"object"};var _12=_2.availableFields,_13=_2.availableFieldNames;var _14=this.summarizeDataSource(_9,_12,{format:"compactJSON"},false);_3.$263q=_14;var _15={dsSummary:_14};var _16={cancellationController:_3.$274w,messages:_11.messages.map(function(_32){if(_32.source=="system"&&isc.AIEngine.$272z(_32.type)){return{source:_32.source,content:String(_32.content).evalDynamicString(this,_15)}}
return _32},this),responseType:_11.responseType};var _17=this.$2679(_11);if(_17.errorMessage)return isc.rejectWithError(_17.errorMessage);if(_8){}
return _17.aiEngine.asyncSendRequest(_16,_3.$261g).then(function(_32){var _18=_32.message.content;if(!isc.isAn.Object(_18)){return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}
var _19=_18.relevantFieldNames,_20;if(isc.isA.String(_19))_19=[_19];if(!isc.isAn.Array(_19)){_20=_13}else{_20=[];for(var i=0;i<_19.length;++i){var _22=_19[i];if(_22==null||isc.isAn.Object(_22))continue;_22=String(_22).trim();if(_13.contains(_22)&&!_20.contains(_22))
{_20.push(_22)}}
if(_20.isEmpty()){_20=_13}}
_19=_20;var _23=_18.valueClass;if(_23!="categorical"&&_23!="ordinal"&&_23!="interval"&&_23!="ratio")
{_23="general"}
var _24,_25;if(_23=="categorical"||_23=="ordinal"){_24=_18.categories;if(!isc.isAn.Array(_24)){var _26=_18.dataDependentReason;if(_26&&(_26=_26.trim())){return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage)}}else{var _27=[];for(var i=0;i<_24.length;++i){var _28=_24[i];if(_28==null||isc.isAn.Object(_28))continue;_28=String(_28);if(!(_28=_28.trim())){isc.AI.logWarn("AI generated an empty string as a category.","AI");continue}
if(_27.contains(_28)){isc.AI.logWarn("AI generated duplicate category '"+_28+"'.","AI");continue}
_27.push(_28)}
_24=_27;_25={};if(isc.isAn.Object(_18.categoryHints)){for(var _28 in _18.categoryHints){if(!Object.hasOwn(_18.categoryHints,_28))continue;var _29=_18.categoryHints[_28];if(!(_28=_28.trim()))continue;if(!_24.contains(_28)){isc.AI.logWarn("AI generated a hint for non-existent category '"+_28+"'.","AI");continue}
if(!isc.isA.String(_29)){isc.AI.logWarn("AI generated a non-string hint for category '"+_28+"'.","AI");continue}
if(!(_29=_29.trim()))continue;_25[_28]=_29}}}
if(!isc.isAn.Array(_24)||_24.isEmpty()){_25=_24=null;_23="general"}}
var _30,_31;if(_23=="interval"||_23=="ratio"){_30=parseFloat(_18.minValue);if(!isc.isA.Number(_30))_30=null;_31=parseFloat(_18.maxValue);if(!isc.isA.Number(_31))_31=null;else if(isc.isA.Number(_30)&&_30>_31){isc.AI.logWarn("AI selected minValue = "+_30+" greater than maxValue = "+_31+". Ignoring...","AI");_31=_30=null}}
return isc.addPropertiesWithAssign({},_4,{relevantFieldNames:_19,valueClass:_23,categories:_24,categoryHints:_25,minValue:_30,maxValue:_31})})},isc.A.applyAIFieldRequestToFieldDefaults=function isc_c_AI_applyAIFieldRequestToFieldDefaults(_1,_2){this.$102q(_2.aiFieldRequest==null||_2.aiFieldRequest===_1);_2.aiFieldRequest=_1;var _3=_1.valueClass;if(_3=="categorical"||_3=="ordinal"){_2.type="enum";_2.valueMap=_1.categories;_2.editorType="SelectItem"}else if(this.isAIFieldRequestNumerical(_1)){_2.type="float";if(_1.minValue!=null||_1.maxValue!=null){var _4=_2.validators;if(!_4)_4=_2.validators=[];var _5;if(_1.minValue!=null){supplyMinValidator:do{for(var v=0;v<_4.length;++v){var _7=_4[v];if(_7.applyWhen!=null||_7.serverOnly)
{continue}
if(_7.type=="integerRange"||_7.type=="floatLimit"||_7.type=="floatRange")
{if(isc.isA.Number(_7.min)&&_1.minValue<=_7.min)
{break supplyMinValidator}}}
_5={type:"floatRange",min:_1.minValue};_4.push(_5)}while(false)}
if(_1.maxValue!=null){supplyMaxValidator:do{for(var v=0;v<_4.length;++v){var _7=_4[v];if(_7.applyWhen!=null||_7.serverOnly)
{continue}
if(_7.type=="integerRange"||_7.type=="floatLimit"||_7.type=="floatRange")
{if(isc.isA.Number(_7.max)&&_1.maxValue>=_7.max)
{break supplyMaxValidator}}}
if(_5!=null){_5.max=_1.maxValue}else{_5={type:"floatRange",max:_1.maxValue};_4.push(_5)}}while(false)}}}else{_2.type="text"}
return _2},isc.A.asyncSummarizeRecords=function isc_c_AI_asyncSummarizeRecords(_1,_2){return this.$273t("$274e",_1,_2)},isc.A.summarizeRecords=function isc_c_AI_summarizeRecords(_1,_2,_3){this.$273v("asyncSummarizeRecords",_1,_2,_3)},isc.A.$274e=function isc_c_AI__asyncSummarizeRecords(_1,_2,_3){var _4=_1.aiFieldRequest;if(!_4){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"aiFieldRequest"}))}
var _5=_3.dataSource;if(!_5){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"dataSource"}))}
var _6=_1.records;if(!_6){return isc.rejectWithError(isc.AsyncUtil.missingRequiredParameterErrorMessage.evalDynamicString(this,{paramName:"records"}))}
var _7;if(_4.maxRecordsPerBatch){_7=_4.maxRecordsPerBatch;if(_1.maxRecordsPerBatch){_7=Math.min(_7,_1.maxRecordsPerBatch)}}else{_7=_1.maxRecordsPerBatch}
var _8=[{content:_4.prompt,type:_4.promptType}],_9=_4.additionalMessages;if(_9){_8.addList(_9);_8.removeEmpty()}
var _10;if(!isc.isAn.Array(_4.relevantFieldNames)||_4.relevantFieldNames.isEmpty()){_10=_3.availableFields}else{_10=isc.getValues(isc.applyMask(_3.availableFieldsIndex,_4.relevantFieldNames));if(_10.isEmpty()){return isc.rejectWithError("No available field is relevant.")}}
var _11=_10.getProperty("name");var _12={dsSummary:this.summarizeDataSource(_5,_10,{format:"compactJSON"},false)};var _13=isc.InternalAIMessagesBuilder2.create({ssMessages:_8,messagesSource:_1.aiFieldRequestSource,target:this,evalVars:_12});var _14=_4.valueClass,_15=_4.categories;if(_14=="interval"||_14=="ratio"){_13.appendPrompts(this.summarizeRecordsPrompts_interval);if(isc.isA.Number(_4.minValue)){if(isc.isA.Number(_4.maxValue)&&_4.minValue>_4.maxValue){return isc.rejectWithError("`aiFieldRequest.minValue` cannot be greater than `aiFieldRequest.maxValue`.")}
_12.minValue=_4.minValue;_13.appendPrompt(this.summarizeRecordsPrompts_interval_minValue)}
if(isc.isA.Number(_4.maxValue)){_12.maxValue=_4.maxValue;_13.appendPrompt(this.summarizeRecordsPrompts_interval_maxValue)}
_13.appendPrompt(this.summarizeRecordsPrompts_interval_final)}else if(_14=="categorical"||_14=="ordinal"){for(var i=0;i<_15.length;++i){var _17=_15[i];if(!isc.isA.String(_17)){return isc.rejectWithError("Non-string category at index "+i+" within `aiFieldRequest.categories`.")}
if(_15.contains(_17,i+1)){return isc.rejectWithError("Duplicate category '"+_17+"' in `aiFieldRequest.categories`.")}}
if(_15.isEmpty()){return isc.rejectWithError("No categories are defined.")}
var _18=isc.applyMask(_4.categoryHints,_15);_12.categories=this.$260x(_15);_12.categoryHints=this.$260x(_18);_13.appendPrompts(this.summarizeRecordsPrompts_categorical)}else{_13.appendPrompts(this.summarizeRecordsPrompts_general)}
var _19=!this.isAIFieldRequestNumerical(_4);var _20={cancellationController:_3.cancellationController,messages:_13.aiMessages,responseType:"object"};var _21={cancellationController:_3.cancellationController,maxConcurrent:_1.maxConcurrent,maxRecordsPerBatch:_7,maxRetries:_1.maxRetries==null?2:_1.maxRetries,stopOnError:false};var _22=[];var _23={cancellationController:_3.cancellationController,request:_1,partialResults:_22};var _24;return this.asyncRepeatRequestOnBatches(_20,_1.records,_11,_21,function(_36){if(_3.cancellationController&&_3.cancellationController.canceled)return;var _25,_26;if(_36.type!="success"){if(!_24)_24=_36;_25=_36;_26=isc.addPropertiesWithAssign({},_25)}else{var _27=_36.message&&_36.message.content&&_36.message.content.result;if(!isc.isAn.Array(_27))_27=[_27];if(_19){for(var i=0;i<_27.length;++i){if(_27[i]==null)continue;_27[i]=String(_27[i])}}else if(_14=="ordinal"){for(var i=0;i<_27.length;++i){if(_27[i]==null)continue;if(isc.isAn.Object(_27[i])){_27[i]=null;continue}
var _28=_15.indexOf(String(_27[i]));_27[i]=_28<0?null:_28}}else{for(var i=0;i<_27.length;++i){if(_27[i]==null)continue;if(isc.isAn.Object(_27[i])){_27[i]=null;continue}
var _29=parseFloat(_27[i]);if(!isc.isA.Number(_29)){_27[i]=null}else{if(isc.isA.Number(_4.minValue)){_29=Math.max(_4.minValue,_29)}
if(isc.isA.Number(_4.maxValue)){_29=Math.min(_29,_4.maxValue)}
_27[i]=_29}}}
var _30=_36.length;_27.setLength(_30);_25={type:"success",startIndex:_36.startIndex,length:_30};_26=isc.addPropertiesWithAssign({},_25);if(_19){_25.recordSummaries=_27;_26.recordSummaries=_27.duplicate()}else{_25.recordNumericalSummaries=_27;_26.recordNumericalSummaries=_27.duplicate()}}
_22.push(_25);isc.AI.fireCallback(_2,isc.AI.$2693,[_26,_23]);return _25}).$271y(function(_36){if(_24||_36.type!="success"){return Promise.reject(isc.addPropertiesWithAssign({},_24||_36,{partialResults:_22}))}
isc.AI.$102q(!_3.cancellationController||!_3.cancellationController.canceled);_36.aiResponsesForBatches.sortByProperty("startIndex",true);var _31=_36.aiResponsesForBatches.getProperty("callbackReturnValue"),_32=[];for(var _33=0,i=0;i<_31.length;++i){var _25=_31[i];isc.AI.$102q(_33==_25.startIndex);isc.AI.$102q(_25.length>0);var _34=_19?_25.recordSummaries:_25.recordNumericalSummaries;isc.AI.$102q(_34.length==_25.length);_32.addList(_34);_33+=_25.length}
var _35={type:"success",partialResults:_22};if(_19)_35.recordSummaries=_32;else _35.recordNumericalSummaries=_32;return _35})},isc.A.translateText=function isc_c_AI_translateText(_1,_2,_3,_4){if(!_1||!_2){this.logWarn("'phrase' and 'targetLocales' parameters are required");return}
if(!isc.isAn.Array(_2))_2=[_2];var _5=_2.duplicate();if(_2.contains("sr")){_2.remove("sr");_2.add("sr-Cyrl")}
var _6="Please translate the source phrase '"+_1+"' to this list of locales: "+_2.join(", ")+".\n\n";_6+="All punctuation, HTML markup and non-alpha characters in the source phrase should be included in your translation and any word prefixed with a '$' character, such as '$description' or '$titleField', must be included verbatim without translation.\n\n ";_6+="Your response should be a simple JSON object where property-names are the list of requested locale-codes, and each value is your translation to that locale.  Any content outside of this JSON object, such as a prefix like 'Response:' is invalid and should not be included.\n\n";if(_4&&_4.attrName){_6+="For context, the source phrase is the default value for an Isomorphic SmartClient framework property with the approximate name '"+_4.attrName.replace("_"," ")+"' and the following description: "+_4.doc+"\n"}
var _7=this;isc.AI.sendPrompt(_6,function(_9){_9=_9.replaceAll("\"sr-Cyrl\"","\"sr\"");var _8=_7._extractJsonResult(_9);_7.fireCallback(_3,"result,context",[_8,_4])},{showPrompt:false})},isc.A.buildFormula=function isc_c_AI_buildFormula(_1,_2,_3,_4){_4=isc.addProperties({},_4,{showPrompt:false});var _5=_3.grid||_3.rootCanvas;var _6=_3.dataSource;var _7=_6!=null?isc.getValues(_6.getFields()):_5.getFields();var _8=["float","integer","int","long","number","decimal","double"];var _9=[];for(var i=0;i<_7.length;i++){if(_8.contains(_7[i].type||"text"))
_9.add(_7[i])}
var _11="You are to generate an Isomorphic SmartClient UserFormula object based on a user-provided description.\n\n";_11+="A SmartClient UserFormula is an object with two properties - 'text', which is a mathematical formula that can contain variable-names, and 'formulaVars' which is an object mapping those variable-names to the names of fields on an associated data-record.  The variable-names range from A-Z, and then onward to a maximum of ZZZ.  You should map natural language to the most appropriate field-names, which are listed below.  Only fields in this list are allowed.\n\n";_11+="For example, a user might ask for and expect the following:\n\nuser-prompt: '(field1 plus field2) times 100'\nresponse: {text:'(A+B)*100',formulaVars:{A:'field1',B:'field2'}}\n\nor\n\nuser-prompt: 'Show the average of distance1 and distance2'\nresponse: ({text:'(A+B)/2',formulaVars:{A:'distance1',B:'distance2'}})\n\n";_11+="A trinary operator may be used if a user requests conditional logic. For example:\n\nuser-prompt: 'if field1 is greater than zero, field2 * field3, otherwise -(field2 * field3)'\nresponse: ({text:'(A > 0) ? (B * C) : -(B*C)',formulaVars:{A:'field1',B:'field2',C:'field3'}})\n\n";_11+="In addition to simple operators ('+','-','*','/'), the UserFormula text may make use of any of the following MathFunction(s).\nmax(val1,val2): Maximum of two values\nmin(val1,val2): Minimum of two values\nround(value,decimalDigits): Round a value up or down, optionally providing decimalDigits as the maximum number of decimal places to round to. For fixed or precision rounding, use toFixed() and toPrecision() respectively.\nceil(value): Round a value up\nfloor(value): Round a value down\nabs(value): Absolute value\npow(value1,value2): value1 to the power of value2\nsqrt(value): Square root of a value\ndateAdd(value,interval,amount): Excel-compatible dataAdd function: adds quantities of a time interval to a date value. Also supports being passed interval names, like \"hour\" or \"week\".\nyear(value): 4-digit integer that represents the year of a date.\nmonth(value): 1-12 integer that represents the month of a date.\nday(value): 1-31 integer that represents the day of month of a date.\ntoPrecision(value,precision): Format a number to a length of precision digits, rounding or adding a decimal point and zero-padding as necessary. Note that the values 123, 12.3 and 1.23 have an equal precision of 3. Returns a formatted string and should be used as the outermost function call in a formula. For rounding, use round().\ntoFixed(value,digits): Round or zero-pad a number to digits decimal places. Returns a formatted string and should be used as the outermost function call in a formula. To round values or restrict precision, use round() and toPrecision() respectively.\nsin(value): Sine of a value\ncos(value): Cosine of a value\ntan(value): Tangent of a value\nln(value): natural logarithm of a value\nlog(base,value): logarithm of a value with the specified base\nasin(value): Arcsine of a value\nacos(value): Arccosine of a value\natan(value): Arctangent of a value (-PI/2 to PI/2 radians)\natan2(value1,value2): Angle theta of a point (-PI to PI radians)\nexp(value): The value of Evalue\nrandom(): Random number between 0 and 1\n\nFor example:\n\nuser-prompt: 'show the maximum of region1Revenue, region2Revenue'\nresponse: ({text:'max(A,B)',formulaVars:{A:'region1Revenue',B:'region2Revenue'}})\n\n";_11+="The user-prompt may indicate a name or title to use for the formula.  If not, please generate a short (two to four word) title.  Either way, please include it in the UserFormula object you generate, as the 'title' property.\n\n";_11+="Here is the list of fields available for use in UserFormula objects - ";if(this.shouldUseAIFieldPaging(_11,_9,_4)){var _12=this;this.retrieveFieldsForPrompt(_1,"Create a userFormula field for a ListGrid",_9,function(_13){_12.$260a(_1,_11,_2,_3,_4,_13)},_3,_4)}else{this.$260a(_1,_11,_2,_3,_4,_9)}},isc.A.$260a=function isc_c_AI__buildFormulaWithFinalFields(_1,_2,_3,_4,_5,_6){_2+=this.getSerializedFields(_6,_5);_2+="Your task is to generate a UserFormula object to satisfy this user request: '"+_1+"'\n\n";_2+="Please respond only with the UserFormula object - any surrounding content will cause JSON decode issues down-stream.\n"
var _7=this;isc.AI.sendPrompt(_2,function(_9){var _8=_7._extractJsonResult(_9);_7.fireCallback(_3,"result,context",[_8,_4])},_5)},isc.A.getMultiActionAIWindow=function isc_c_AI_getMultiActionAIWindow(){var w=this.multiActionAIWindow;if(!w){w=isc.AI.multiActionAIWindow=isc.Window.create(this.multiActionAIWindowDefaults)}
return w},isc.A.buildCompositeViewSettings=function isc_c_AI_buildCompositeViewSettings(_1,_2,_3,_4){var _5=_3.grid||_3.component;var _6=_5&&_5.getScClassName();if(_6==null)_6="ListGrid";if(!_3.grid)_3.grid=_5;var _7=_3.actions||isc.getKeys(this.componentActions);var _8="A user is interacting with a(n) "+_6+" component in an application built with Isomorphic SmartClient Javascript framework.\nThe user has issued the following request:\n\n\""+_1+"\"\n\nThis may be requesting one or more actions of the following type(s):\n";for(var i=0;i<_7.length;i++){var _10=_7[i];if(this.componentActions[_10]==null)continue;_8+=_10+": "+this.componentActions[_10].description+"\n"}
_8+="\n\nPlease determine which action(s) the user is requesting and return a series of rephrased queries as a JSON string where each attribute name is the requested action type, and the attribute value is a rephrased version of the part of the query that requests that action type.\n\n"
_8+="For example if the user prompt was: \n'Show only items where cost is greater than 1 and hilite the cost field for items that are on sale'\nAn example response might be:\n"+'{"filter":"Show only items where cost is greater than 1", "hilite":"hilite the cost field for items that are on sale"}\n\n';_8+="\nIf you can't determine which of actions are being requested, return an empty JSON object";var _11=this;var _12=function(_14){_11.processSplitCompositeViewRequests(_14,_1,_2,_3,_4)}
var w=isc.AI.getMultiActionAIWindow();w.setTitle("Configure via AI - Determining tasks");w.setFirstAction(null);w.show();this.sendPrompt(_8,_12)});isc.evalBoundary;isc.B.push(isc.A.processSplitCompositeViewRequests=function isc_c_AI_processSplitCompositeViewRequests(_1,_2,_3,_4,_5){_1=_1.replaceAll("```json","").replaceAll("```","");var _6=JSON.parse(_1);var _7=false;_4.actions=_6;_4.actionResults={};_4.callback=_3;var _8=_4.component;var w=isc.AI.getMultiActionAIWindow();w.setTitle("Configure via AI - Executing tasks");w.addActions(isc.addProperties({},_6));var _10=this;for(var _11 in _6){var _12=_6[_11];if(this.componentActions[_11]!=null){_7=true;var _13=isc.addProperties({actionType:_11,originalContext:_4},_4);var _14=this.componentActions[_11].methodName;if(_14=="buildFilter"){var _15=isc.addProperties({showProgressDialog:false},{userAIRequest:{prompt:_12},dataSource:_8.getDataSource(),mode:_8.filterViaAIMode=="AIDE"?"AIDE":"aiAssist"});var _16=isc.addProperties({},_13);isc.AI.asyncBuildCriterion(_15).$271y(this.ns.EH.$2762("PromiseSettled",function(_18){if(_18.type!="canceled"){if(_18.type!="success"){isc.logWarn("buildCriterion() resulted in type: "+_18.type+", errorMessage: "+_18.errorMessage,"AI")}}
_10.buildCompositeViewSettingsReply(_18.criterion,_16)}))}else if(_14=="buildHilite"){var _15={userAIRequest:{prompt:_12},records:_8.$2642(),dataSource:_8.getDataSource(),mode:_8.hiliteViaAIMode=="AIDE"?"AIDE":"aiAssist",aiPageSize:_8.aiPageSize,showProgressDialog:false};var _17=isc.addProperties({},_13);isc.AI.buildHilites(_15,function(_18){if(_18.type!="success"){isc.warn("Hilite-via-AI failed: "+_18.errorMessage)}
_10.buildCompositeViewSettingsReply(_18.hilites,_17)})}else{this[_14](_12,function(_18,_13){_10.buildCompositeViewSettingsReply(_18,_13)},_13,_5)}}else{this.logWarn("Unrecognized action type '"+_11+"' for AI-generated partial request:"+_6[_11]);delete _6[_11]}}},isc.A.buildCompositeViewSettingsReply=function isc_c_AI_buildCompositeViewSettingsReply(_1,_2){var _3=_2.actionType;var _4=_2.originalContext;_4.actionResults[_2.actionType]=_1;var w=isc.AI.getMultiActionAIWindow();w.updateAction(_3,true);delete _4.actions[_3];if(isc.isA.emptyObject(_4.actions)){this.fireCallback(_4.callback,"data,context",[_4.actionResults,_4]);w.hide()}});isc.B._maxIndex=isc.C+181;isc.A=isc.Operators;isc.A.aiFilterTitle="matches a natural language description of a filter, as determined by AI";isc.A.aiFilterDescriptionPrefix="Filter via AI: ";isc.DataSource.addSearchOperator({ID:"aiFilter",titleProperty:"aiFilterTitle",symbol:"\uD83E\uDD16",hidden:true,clientOnly:true,valueType:"custom",getDescription:function(_1,_2){return isc.Operators.aiFilterDescriptionPrefix+isc.AI.$268n(_1,_2).asHTML()},getCleanCriterion:function(_1,_2){return isc.AI.$268o(_1)},fromCleanCriterion:function(_1,_2){return isc.AI.$268p(_1)},condition:function(_1,_2,_3,_4){var _5=_3.criterion;if(!isc.AI.$267a(_5,_4)||_5.isTrivial)
{return true}
var _6=_5.$263s,_7=_3.record;if(_6.length==1){var _8=_7[_6[0]];if(isc.isA.Class(_5.$263v)&&_5.$263v.has(_8)){return false}
if(isc.isA.Class(_5.$264f)&&_5.$264f.has(_8)){return true}}else{this.$102q(false)}
if(_4.$59u){if(!_5.$267f)return false;return _4.evaluateCriterion(_7,_5.$267f)}else{if(!_5.$267g)return true;return _4.evaluateCriterion(_7,_5.$267g)}},compareCriteria:function(_1,_2){if(_1.$264d!=_2.$264d){return-1}
var _3=isc.DS.getDataSource(_1.$264d);if(_3==null||!isc.AI.$267a(_1,_3)||!isc.AI.$267a(_2,_3))
{return-1}
if(_1.isTrivial){if(_2.isTrivial)return 0}else{if(_2.isTrivial)return 1}
return-1},getServerCriterion:function(_1,_2,_3){var _4=_2?isc.DS.$2652:isc.DS.$2653;if(!isc.AI.$267a(_1,_3)){return _4}
if(_1.isTrivial){return isc.DS.$2653}
var _5;if(_2){var _6=null,_7=_1.$263s;if(_7.length==1){var _8=_7[0];if(isc.isA.Class(_1.$264f)){_6={_constructor:"AdvancedCriteria",fieldName:_8,operator:"inSet",value:_1.$264f.getContents()}}}else{this.$102q(false)}
_5=_3.combineCriteria(_6,_1.$267f)}else{_5=_3.combineCriteria(_1.$2667,_1.$267g)}
return _5==null?_4:_5},asyncFilter:function(_1,_2,_3){var _4=_3.dataSource;if(!isc.AI.$267a(_1,_4)){return Promise.reject(isc.createErrorResult("The 'aiFilter' is not usable."))}
if(_1.isTrivial)return null;var _5={aiCriterion:_1,showProgressDialog:false,cancellationController:_3.cancellationController};if(_3.recordsWereUpdated){_5.updatedRecords=_2;return isc.AI.asyncReapplyAIFilter(_5)}
var _6=isc.AI.$267j(_1,_2,_4);isc.AI.$102q(isc.isAn.Array(_6.matchingRecords)&&_6.matchingRecords.length+(_6.remainingRecords==null?0:_6.remainingRecords.length)==_2.length);if(!_6.remainingRecords||_6.remainingRecords.length==0){return null}
_5.records=_2;_5.$267i=_6;return isc.AI.asyncApplyAIFilter(_5)},removeFromFilterCaches:function(_1,_2){isc.AI.removeFromAIFilterCaches(_1,_2)},clearFilterCaches:function(_1){isc.AI.clearAIFilterCaches(_1)},getDependencies:function(_1){if(_1.isTrivial)return[];return _1.$263t}});isc.AI.init();isc.FieldGeneratorRegistry.register({ID:"AI",asyncGenerateValues:function(_1,_2,_3,_4){var _5=_3.component,_6=this.getNonSuccessfulResultAtOutset(_1,_5);if(_6){isc.Class.$102q(_6.type!="success");return Promise.reject(_6)}else if(_2.getLength()>_5.aiMaxRecords){return isc.rejectAsDisabled(_5.$278z())}
var _7={cancellationController:_3.cancellationController,component:_5,dataSource:_3.dataSource,excludeFieldNames:_3.excludeFieldNames,aiFieldRequest:_1.aiFieldRequest,records:_2};return isc.AI.asyncSummarizeRecords(_7,function(_10){var _8=_10.startIndex,_9=_8+_10.length;_10.records=_2.slice(_8,_9);if(_10.type=="success"){_10.generatedValues=_10.recordSummaries||_10.recordNumericalSummaries}
isc.AI.fireCallback(_4,"partialResult",[_10])}).then(function(_10){return{type:_10.type,generatedValues:_10.recordSummaries||_10.recordNumericalSummaries}})},getNonSuccessfulResultAtOutset:function(_1,_2){if(!isc.AI.isEnabled()){return isc.createDisabledResult(isc.AI.aiWasDisabledMessage)}},getNonSuccessfulRecordSortResultAtOutset:function(_1,_2){var _3=_2.getDataAsList();if(!_3)return;if(_3.lengthIsKnown&&!_3.lengthIsKnown()){return isc.createDisabledResult(isc.AsyncUtil.dataBeingFetchedMessage)}else if(_3.getLength()>_2.$273n()){return isc.createDisabledResult(_2.$2780())}},getDependencies:function(_1,_2){if(!_1.aiFieldRequest)return[];return _1.aiFieldRequest.relevantFieldNames},settingFieldPropertyInvalidatesCache:function(_1,_2,_3,_4){if(_3=="aiFieldRequest"){if(_1.aiFieldRequest==null)return _4!=null;else if(_4==null)return true;else{isc.Class.$102q(_1.aiFieldRequest!=null&&_4!=null);return _1.aiFieldRequest!==_4}}},controllingFieldProperties:["aiFieldRequest"]});isc.PseudoFieldGeneratorRegistry.register({type:"hover",ID:"AI",asyncGenerateValue:function(_1,_2,_3){var _4=_1.masterFieldName;if(!isc.isA.nonemptyString(_4)){return isc.rejectWithError("Expecting `masterFieldName` to be a single field name.")}
var _5=_3.component.getSpecifiedField(_4);if(!_5){return isc.rejectWithError("No such field named '"+_4+"'")}
var _6=_5.aiHoverRequest;if(!_6){return isc.rejectWithError("The master field is missing an `aiHoverRequest`.")}
var _7={cancellationController:_3.cancellationController,value:_2[_4],aiRequest:_6,examples:_6.examples};if(_6.includeRecord!=false){_7.component=_3.component;_7.record=_2;_7.relevantFieldNames=_6.relevantFieldNames;_7.fieldName=_4}
return isc.AI.asyncSummarizeValue(_7).then(function(_8){return{type:_8.type,generatedValue:_8.summary.trim().asHTML()}})},getDependencies:function(_1,_2){var _3=_1.masterFieldName;if(!isc.isA.nonemptyString(_3))return[];var _4=_2.getSpecifiedField(_3);if(!_4)return[];var _5=_4.aiHoverRequest;if(!_5)return[];if(_5.includeRecord!=false)return[_3];var _6=_5.relevantFieldNames;if(!_6)return null;if(!_6.contains(_3)){_6=_6.duplicate();_6.push(_3)}
return _6},getRetryDelay:function(_1,_2){return _2.aiHoverRetryDelay},getPlaceholderHoverContents:function(_1,_2,_3){return _3.placeholderAIHoverContents},formatHoverContents:function(_1,_2,_3,_4){var _5=_1.masterFieldName,_6=!isc.isA.nonemptyString(_5)?null:_3.getSpecifiedField(_5),_7=(_6&&_6.aiHoverContentsPrefix!=null?_6.aiHoverContentsPrefix:_3.aiHoverContentsPrefix)||"";if(!_4||!(_4=String(_4))){_7+=_3.emptyAIHoverContents}else{_7+=_4}
return _7}});isc.defineClass("AnswerEngineOperation","PausableAsyncOperation");isc.A=isc.AnswerEngineOperation;isc.A.allDashboardComponentTypes=["label","list","chart","value"];isc.A=isc.AnswerEngineOperation.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.jsonEncoderDefaults={prettyPrint:false,dateFormat:"logicalDateString",strictQuoting:true};isc.A.maxRecordsPerQuery=15;isc.B.push(isc.A.init=function isc_AnswerEngineOperation_init(){this.Super("init",arguments);if(!this.jsonEncoder){this.jsonEncoder=isc.JSONEncoder.create(this.jsonEncoderDefaults,this.jsonEncoderProperties)}
var _1=this.maxRecordsPerQuery;if(_1==null||!isc.isA.Number(_1)||_1!=Math.trunc(_1)||_1<0)
{_1=this.maxRecordsPerQuery=this.getClass().getInstanceProperty("maxRecordsPerQuery");this.logWarn("Invalid 'maxRecordsPerQuery'. Resetting to "+_1,"AnswerEngine")}
if(!this.isCanceled()){isc.AI.$2801(this);this.$2802()}},isc.A.getID=function isc_AnswerEngineOperation_getID(){if(this.ID==null)this.ns.ClassFactory.addGlobalID(this);return this.ID},isc.A.$280z=function isc_AnswerEngineOperation__getLogIdString(){return this.getID()+"[questionId: '"+this.dataQuestion.ID+"']"},isc.A.handleCancel=function isc_AnswerEngineOperation_handleCancel(_1,_2){this.Super("handleCancel",arguments);if(_1){isc.AI.$2803(this)}},isc.A.unpause=function isc_AnswerEngineOperation_unpause(_1){var _2=this.Super("unpause",arguments);if(_2){isc.AI.$2801(this,_1)}
return _2},isc.A.$2802=function isc_AnswerEngineOperation___doContinue(){if(this.dataQuestion.result){this.logDebug("$2802() called, but already have a result, so returning","AnswerEngine");return}
this.continueWith(function(_3){var _1=_3.currentStep;if(!_1){if(!_3.dataQuestion.summarizedUserMessages){_1={type:"summarizeUserAIRequest"}}else{_1={type:"determineNextStep"}}}
return _3.$2804(_1)}).$2800(function(_3){this.currentStep=_3;this.$2802()},function(_3){var _2=isc.defaultAsyncOperationCatchCallback(_3);if(this.logIsDebugEnabled("AnswerEngine")){this.logDebug("Received a non-successful result: "+isc.echoFull(_2)+" Have a DQ result: "+!!this.dataQuestion.result,"AnswerEngine")}
if(!this.dataQuestion.result){this.dataQuestion.result=_2}
this.postResult(_2)},this)},isc.A.$2804=function isc_AnswerEngineOperation__asyncPerformAndGetNextStep(_1){var _2=_1.type;this.logDebug("Performing a step of type '"+_2+"'","AnswerEngine");if(_2=="summarizeUserAIRequest"){var _3=this.dataQuestion.userAIRequest,_4=[{content:_3.prompt,type:_3.promptType}];if(_3.additionalMessages){_4.addList(_3.additionalMessages);_4.removeEmpty()}
this.dataQuestion.summarizedUserMessages=_4;return Promise.resolve({type:"determineNextStep"})}else if(_2=="determineNextStep"){return isc.AI.$281f(this)}else if(_2=="makeQuery"){return isc.AI.$281g(this,_1).$2800(function(_14){var _5={step:_1,dsRequestProperties:_14};return{type:"validateQuery",makeQueryStepResult:_5}},null,this)}else if(_2=="validateQuery"){return this.$281h(_1).$2800(function(_14){if(_14!=null){return isc.rejectWithError("not yet implemented")}
return{type:"executeQuery",validatedMakeQueryStepResult:_1.makeQueryStepResult}},null,this)}else if(_2=="executeQuery"){return this.$281j(_1).$2800(function(_14){var _6=_14.data;if(!isc.isAn.Array(_6)){if(isc.isAn.Object(_6))_6=[_6];else _6=[]}
var _7={step:_1,data:_14.data};if(_14.progressiveLoading!=true){var _8=_14.totalRows;if(_8!=null){_7.totalRows=_8;_7.estimatedTotalRows=String(_8)}}else{_7.estimatedTotalRows=_14.estimatedTotalRows}
if(!this.dataQuestion.prevStepResults)this.dataQuestion.prevStepResults=[];this.dataQuestion.prevStepResults.push(_7);return null},null,this)}else if(_2=="createDashboardComponent"){return isc.AI.$281q(this,_1).$2800(function(_14){var _9={step:_1,jsCode:_14};return{type:"validateDashboardComponent",createDashboardComponentStepResult:_9}},null,this)}else if(_2=="validateDashboardComponent"){return this.$281r(_1).$2800(function(_14){if(_14.validationErrors){var _10=_1.createDashboardComponentStepResult.step;delete _1.createDashboardComponentStepResult.step;return{type:"fixDashboardComponent",createDashboardComponentStep:_10,prevValidateDashboardComponentStepResults:[_14]}}
return{type:"$281t",nodes:_14.nodes,jsCode:_1.createDashboardComponentStepResult.jsCode}},null,this)}else if(_2=="fixDashboardComponent"){return isc.AI.$281u(this,_1).$2800(function(_14){var _11={type:"validateDashboardComponent",createDashboardComponentStepResult:{step:_1.createDashboardComponentStep,jsCode:_14}};return this.continueWith({target:this,methodName:"$281r",args:[_11]}).$2800(function(_15){delete _11.createDashboardComponentStepResult.step;if(_15.validationErrors){var _12=isc.addPropertiesWithAssign({},_1);_12.prevValidateDashboardComponentStepResults.push(_15);return _12}
return{type:"$281t",nodes:_15.nodes,jsCode:_14}},null,this)},null,this)}else if(_2=="createDashboard"){return this.$281s(_1).$2800(function(_14){var _13={type:"success",promiseOutcomes:_14};if(this.logIsDebugEnabled("AnswerEngine")){this.logDebug("Received a successful result: "+isc.echoFull(_13)+" Have a DQ result: "+!!this.dataQuestion.result,"AnswerEngine")}
if(!this.dataQuestion.result){this.dataQuestion.result=_13}
this.postResult(_13);return null},null,this)}
return isc.rejectWithError("The code to perform step type '"+_2+"' is not implemented.")},isc.A.$281h=function isc_AnswerEngineOperation__asyncAnswerEngineValidateQuery(_1){var _2=this;return Promise.resolve()},isc.A.$281j=function isc_AnswerEngineOperation__asyncAnswerEngineExecuteQuery(_1){var _2=_1.validatedMakeQueryStepResult,_3=_2.step.dataSourceName,_4=_2.dsRequestProperties;var _5=isc.DS.get(_3);var _6=isc.addPropertiesWithAssign({},_4,{showPrompt:false});return _5.asyncExecute(_6)},isc.A.$281r=function isc_AnswerEngineOperation__asyncAnswerEngineValidateDashboardComponent(_1){var _2=this,_3=_1.createDashboardComponentStepResult;return new Promise(function(_5,_6){var _4=function handleError(_7){_5({step:_1,nodes:null,validationErrors:[{jsError:_7}]})};try{isc.AI.$261q(_3.jsCode,_4,function(_7,_8){_5({step:_1,nodes:_7,validationErrors:_8})})}catch(e){_4(e)}})},isc.A.$281s=function isc_AnswerEngineOperation__asyncAnswerEngineCreateDashboard(_1){var _2=isc.CreateDashboardComponentsMapper.create({cancellationController:this.cancellationController,values:_1.createDashboardComponentSteps,answerEngineOperation:this});return _2.getPromise()});isc.B._maxIndex=isc.C+11;isc.defineClass("CreateDashboardComponentsMapper","ResolvedValuesMapper");isc.A=isc.CreateDashboardComponentsMapper.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.keepSettledStatus=true;isc.A.maxConcurrent=3;isc.B.push(isc.A.asyncMap=function isc_CreateDashboardComponentsMapper_asyncMap(_1,_2){return this.answerEngineOperation.continueWith({target:this,methodName:"$281x",args:[_1,_1]})},isc.A.$281x=function isc_CreateDashboardComponentsMapper___asyncMap(_1,_2){return this.answerEngineOperation.$2804(_2).$2800(function(_3){if(!_3)return isc.rejectWithError("No next step");if(_3.type=="$281t"){return Promise.resolve({step:_1,jsCode:_3.jsCode,nodes:_3.nodes})}
return this.answerEngineOperation.continueWith({target:this,methodName:"$281x",args:[_1,_3]})},null,this)});isc.B._maxIndex=isc.C+2;isc.A=isc.AI;isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.maxActiveAnswerEngineOperations=10;isc.A.$2805=[];isc.A.$2806={};isc.A.$281d="result,dataQuestion";isc.A.defaultMaxFixAttempts=2;isc.A.answerEnginePrompts_initial="You are an intelligent Answer Engine embedded in an Isomorphic SmartClient app, which is able to answer natural language questions about a data model via making a series of queries against different DataSources in the app, and then assembling an Answer Dashboard using SmartClient UI components to convey the answer.";isc.A.answerEnginePrompts_applicationPurpose="The described purpose of the application is: \"${applicationPurpose}\"";isc.A.answerEnginePrompts_dataQuestion=["The end user's question for you is:","${userMessages}"];isc.A.answerEnginePrompts_dataSourcesIntro="The DataSources in the application are:";isc.A.answerEnginePrompts_perDataSourceDump="DataSource '${dsName}', which is summarized as \"${dsSummary}\" and has the following fields:\n${dsFields}";isc.A.answerEnginePrompts_prevStepsDumpIntro="The previous steps you have taken, and their results, are as follows:";isc.A.answerEnginePrompts_perPrevStepDump="A '${prevStepType}' step (${prevStep}) with the result: ${prevStepResult}";isc.A.determineNextStepPrompts_nextStepPrompts="You are to determine the next step to take in order to answer the end user's question. Your response should be a single JSON object with key \"nextStepType\" set to one of the following choices, along with the additional step-specific data:\n\n1. \"makeQuery\" - Describe a query on one of the DataSources which is likely to result in useful information for answering the end user's question. If you select this step type, your response JSON object must have the following format:\n{\n\"nextStepType\":\"makeQuery\",\n\"dataSourceName\":The ID of the DataSource to query,\n\"queryPurpose\":A string containing a detailed explanation of the purpose for making a query,\n\"queryDescription\":A string containing a detailed description of the query to make against the selected DataSource. This should include the relevant names of fields to select, how to group records, the summary functions (such as count(), sum(), max(), and min()) to use and on which fields for each group.\n}\n\n2. \"createDashboard\" - Describe a dashboard to visually explain an answer to the end user's question. If you select this step type, your response JSON object must have the following format:\n{\n\"nextStepType\":\"createDashboard\",\n\"components\":An array of objects, where each object has the following format:\n    {\n        \"componentType\":One of the component types listed below,\n        \"description\":A string that describes in detail a single component of the specified type to add to the dashboard.\n    }\n}\nThe choice of component types are:\n- \"label\" - A component that displays a static string of text.- \"list\" - A ListGrid which displays data from a single DataSource, and which may:     * apply a filter to select a subset of the records from the DataSource according to criteria\n    * sort the displayed records by one or more fields, with the sort by each field either in ascending or descending order\n    * hilite a subset of the records according to criteria\n    * group the records by one or more fields\n    * apply summary functions to each group of records\n    * show the data from a subset of the fields of the DataSource\n    * have additional 'formula' fields which contain the result of an arithmetical formula involving values of each record- \"chart\" - A chart, such as a line graph, bar chart, or pie chart to display data from a single DataSource, and which may:    * apply a filter to select a subset of the records from the DataSource according to criteria\n    * plot one or more fields of records from the DataSource\n    * have a title and labels for axes of the chart\n- \"value\" - A Label displaying a single value (scalar) derived from the data in a dataSource\nYou are free to incorporate the results of previous steps.\n\nIf you do not have enough information to answer the end user's question, default to describing a \"makeQuery\" next step, in order to obtain more information from the data.";isc.A.allowedDSRequestPropertyNames=["data","groupBy","summaryFunctions","sortBy","startRow","endRow"];isc.A.makeQueryStepPrompts="You have previously decided to make a query on the '${dsName}' DataSource.\n\nYou stated that the purpose of the query is \"${queryPurpose}\"\n\nA detailed description of the query that you want to make is: \"${queryDescription}\"\n\nYou are now to convert your description of the query into a JSON object, a DSRequest object.\n\nThe following properties are available for a DSRequest object:\n\n\n\"data\": An AdvancedCriteria object that can be used to filter records in the DataSource to only those matching the specified criteria.\nThe format of AdvancedCriteria is:\n${advancedCriteriaFormatDescription}\n\"groupBy\": An array of field name strings to group records by. Note that records are filtered by the AdvancedCriteria before they are grouped.\n\n\"summaryFunctions\": An object that maps a field name to the summary function to use on that field. The available summary functions are:\n    * \"sum\"\n    * \"avg\"\n    * \"max\"\n    * \"min\"\n    * \"count\"\n\n\"sortBy\": Field name to sort by, prefixed with optional \"-\" indicating descending sort. For example, to sort by the field \"userName\" in ascending order, set \"sortBy\" to just \"userName\". For descending sort on \"userName\", set \"sortBy\" to \"-userName\".\nTo sort by multiple fields, an array of field names is also supported. For example, to sort by the field \"department\" in ascending order, followed by the field \"userName\" in descending order, set \"sortBy\" to: [\"department\", \"-userName\"]\n\n\"startRow\": Zero-based index of the starting row to fetch from the query results. If not specified, the default is 0.\n\n\"endRow\": Zero-based index of the ending row to fetch from the query results. The record at index \"endRow\" is not included. If not specified, the default is ${maxRecordsPerQuery}.\n";isc.A.createDashboardComponentPrompts_intro="You have previously decided to build a ${componentType} dashboard component.\n\nA detailed description of the component to be created is: \"${description}\"\n\nPlease generate JavaScript code to create a SmartClient ${componentType} according to this description.\n\nFurther instructions for creating the code for a SmartClient ${componentType} are as follows:\n${codePrompt}";isc.A.createDashboardComponentPrompts_labelCodePrompt="A Label displays a single, static string of HTML.\nThe \"contents\" property of the Label is the HTML string to display.\nThe \"align\" property may be set to \"center\", \"left\", or \"right\" to align the contents to the center, left, or right of the container, respectively.";isc.A.fixDashboardComponentPrompts="You generated the following JavaScript:\n\n```javascript\n${prevJSCode}\n```\n\nThis JavaScript code is not correct for the following reasons:\n${validationErrors}\n\nPlease try again to generate JavaScript code to create the component, correcting these errors.";isc.B.push(isc.A.$2801=function isc_c_AI__touchAnswerEngineOperation(_1,_2){if(_1.isCanceled())return;var _3=_1.dataQuestion,_4=_3.ID,_5=this.$2806[_4];if(_5&&_5!==_1&&!_5.isCanceled())
{_5.cancel("A different <code>AnswerEngineOperation</code> instance ("+_5.getID()+") was working on data question ID '"+String(_4).asHTML()+"'. Replacing...",_2)}
this.$2806[_4]=_1;while(this.$2805.remove(_1)){}
this.$2805.addAt(_1,0);var _6=this.maxActiveAnswerEngineOperations;if(_6<0||_6==Infinity)return;var _7=0;for(var o=0;o<this.$2805.length;++o){_1=this.$2805[o];if(_1.isCanceled()||_1.paused)continue;if(++_7>_6){_1.cancel("Canceling all but "+Math.trunc(_6)+" active <b><em>Answer Engine</em></b> operations.",_2)}}},isc.A.$2803=function isc_c_AI__removeAnswerEngineOperation(_1){var _2=_1.dataQuestion,_3=_2.ID,_4=this.$2806[_3];if(_4&&_4===_1)
{delete this.$2806[_3]}
while(this.$2805.remove(_1)){}},isc.A.$281e=function isc_c_AI__createAnswerEngineOperation(_1,_2,_3){var _4=isc.isA.String(_1)?{prompt:_1}:_1;if(!_2&&_3.dataSourceNames){_2=_3.dataSourceNames.map(function(_13){return isc.DS.get(_13)})}
var _5;if(!_2){_5=this.getDataSourceNames();_2=_5.map(function(_13){return isc.DS.get(_13)})}else{for(var _6=_2.length;_6>0;--_6){var d=_6-1,_8=_2[d];if(isc.isA.nonemptyString(_8))_8=isc.DS.get(_8);if(!_8){_2.removeAt(d);this.logWarn("`dataSources["+d+"]` either is not a global data source name, or the data source does not have a global ID. Removing...","AnswerEngine")}}
_5=_2.getProperty("ID")}
if(!_3)_3={};_3.dataSourceNames=_5;var _9=_3.allowedDashboardComponentTypes;if(_9){for(var _10=_9.length;_10>0;--_10){var t=_10-1,_12=_9[t];if(!isc.AnswerEngineOperation.allDashboardComponentTypes.contains(_12)){this.logWarn("Unknown dashboard component type '"+_12+"' specified in the list of allowed types. Removing...","AnswerEngine");_9.removeAt(t)}}}
return isc.AnswerEngineOperation.create({dataQuestion:{ID:isc.Math.randomUUID(),userAIRequest:_4,settings:_3},dataSources:_2,$261g:{maxRetries:0,serializationFormat:"compactJSON"}})},isc.A.askDataQuestion=function isc_c_AI_askDataQuestion(_1,_2,_3,_4){var _5=this.$281e(_1,_2,_3);return _5.asyncGetResult().$271y(function(_6){this.fireCallback(_4,this.$281d,[_6,_5.dataQuestion])},this)},isc.A.cancelDataQuestion=function isc_c_AI_cancelDataQuestion(_1,_2){var _3=this.$2806[_1];if(!_3){this.logError("Unknown questionId '"+_1+"'","AnswerEngine")}else if(_3.isCanceled()){this.logWarn("The Answer Engine operation for questionId '"+_1+"' is already canceled.","AnswerEngine")}else{_3.cancel("AI.cancelDataQuestion() was called to cancel the <b><em>Answer Engine</em></b> operation.",_2)}},isc.A.pauseDataQuestion=function isc_c_AI_pauseDataQuestion(_1,_2){var _3=this.$2806[_1];if(!_3){this.logError("Unknown questionId '"+_1+"'","AnswerEngine")}else{var _4=_3.pause(_2);if(_4)_4["catch"](isc.noOp)}},isc.A.resumeDataQuestion=function isc_c_AI_resumeDataQuestion(_1,_2){var _3=this.$2806[_1];if(!_3){this.logError("Unknown questionId '"+_1+"'","AnswerEngine")}else{_3.unpause(_2)}},isc.A.$281i=function isc_c_AI__getAnswerEngineMessagesBuilder(_1){var _2=_1.dataQuestion;var _3=_2.settings;var _4={applicationPurpose:_3.applicationPurpose,dsName:"${dsName}",dsSummary:"${dsSummary}",dsFields:"${dsFields}",prevStepType:"${prevStepType}",prevStep:"${prevStep}",prevStepResult:"${prevStepResult}"};var _5=isc.InternalAIMessagesBuilder.create({userMessages:_2.summarizedUserMessages,target:this,evalVars:_4});_5.appendPrompts(this.answerEnginePrompts_initial);if(isc.isA.nonemptyString(_3.applicationPurpose)){_5.appendPrompts(this.answerEnginePrompts_applicationPurpose)}
_5.appendPrompts(this.answerEnginePrompts_dataQuestion);var _6=_1.dataSources;if(_6){_5.appendPrompts(this.answerEnginePrompts_dataSourcesIntro);for(var d=0;d<_6.length;++d){var _8=_6[d],_9=_8.getAllFields();_4.dsName=_8.getID();_4.dsSummary=isc.AI.getShortDSDescription(_8);_4.dsFields=isc.AI.getSerializedFields(_9,{format:"compactJSON"});_5.appendPrompts(this.answerEnginePrompts_perDataSourceDump)}}
var _10=_2.prevStepResults;if(_10){_5.appendPrompts(this.answerEnginePrompts_prevStepsDumpIntro);for(var _11=0;_11<_10.length;++_11){var _12=isc.addPropertiesWithAssign({},_10[_11]),_13=isc.addPropertiesWithAssign({},_12.step),_14=_13.type;delete _12.step;delete _13.type;if(_14=="executeQuery"){_14="makeQuery";var _15=_13.validatedMakeQueryStepResult,_16=_15.step;_13={dataSourceName:_16.dataSourceName,queryPurpose:_16.queryPurpose,queryDescription:_16.queryDescription,dsRequest:_15.dsRequestProperties}}
_4.prevStepType=_14;_4.prevStep=_1.jsonEncoder.encode(_13);_4.prevStepResult=_1.jsonEncoder.encode(_12);_5.appendPrompts(this.answerEnginePrompts_perPrevStepDump)}}
return _5},isc.A.$281f=function isc_c_AI__asyncAnswerEngineDetermineNextStep(_1){var _2=this.$281i(_1);_2.appendPrompts(this.determineNextStepPrompts_nextStepPrompts);var _3={cancellationController:_1.cancellationController,messages:_2.aiMessages,responseType:"object"};return this.asyncSendRequest(_3,_1.$261g).$2800(function(_16){var _4=_16.message.content;if(!isc.isAn.Object(_4))return isc.rejectWithError(isc.AI.aiNotAbleToProcessRequestErrorMessage);var _5=_4.nextStepType;if(!isc.isA.nonemptyString(_5))return isc.rejectWithError("AI did not provide a next step type.");if(_5=="makeQuery"){var _6=_4.dataSourceName;if(!isc.isA.nonemptyString(_6))return isc.rejectWithError("AI did not specify a data source.");var _7=isc.DS.get(_6);if(!_7)return isc.rejectWithError("AI specified a non-existent data source name '"+String(_7).asHTML()+"'.");var _8=_1.dataSources;if(!_8||!_8.contains(_7)){return isc.rejectWithError("AI did not select an available data source; data source name '"+String(_7).asHTML()+"' is not available.")}
if(!isc.isA.nonemptyString(_4.queryPurpose)){return isc.rejectWithError("AI did not specify a purpose for making the query.")}
if(!isc.isA.nonemptyString(_4.queryDescription)){return isc.rejectWithError("AI did not describe the query to make.")}
return{type:"makeQuery",dataSourceName:_6,queryPurpose:_4.queryPurpose,queryDescription:_4.queryDescription}}else if(_5=="createDashboard"){var _9=_4.components;if(!isc.isAn.Array(_9)||_9.isEmpty()){return isc.rejectWithError("AI determined to create a dashboard; however, it did not specify any dashboard components.")}
var _10=[],_11=this.dataQuestion.settings.allowedDashboardComponentTypes||isc.AnswerEngineOperation.allDashboardComponentTypes;for(var c=0;c<_9.length;++c){var _13=_9[c],_14,_15;if(!isc.isAn.Object(_13)||isc.isAn.Array(_13)||!isc.isA.String(_14=_13.componentType)||isc.isAn.emptyString(_14=_14.trim())||!isc.isA.String(_15=_13.description)||isc.isAn.emptyString(_15=_15.trim()))
{this.logDebug("`componentSpecs["+c+"]` does not look like a valid component spec. Skipping...","AnswerEngine");continue}
if(!_11.contains(_14)){this.logDebug("componentType '"+_14+"' is "+(!isc.AnswerEngineOperation.allDashboardComponentTypes.contains(_14)?"unknown":"not allowed")+". Skipping...","AnswerEngine");continue}
_10.push({type:"createDashboardComponent",componentType:_14,description:_15})}
if(_10.isEmpty()){return isc.rejectWithError("AI determined to create a dashboard; however, it did not validly specify any dashboard components.")}
return{type:"createDashboard",createDashboardComponentSteps:_10}}
return isc.rejectWithError("Unhandled next step type '"+String(_5).asHTML()+"'")},null,this)},isc.A.$281v=function isc_c_AI__maskFetchDSRequestProperties(_1,_2,_3,_4,_5){_4=_4||this.allowedDSRequestPropertyNames;_1=isc.applyMask(_1,_4);_1.dataSource=_2;var _6=_1.startRow;if(_6!=null)_6=_1.startRow=Math.trunc(_6);if(!isc.isA.Number(_6)){_6=_1.startRow=0}
var _7=_1.endRow;if(_7!=null)_7=_1.endRow=Math.trunc(_7);if(_1.endRow==null){_7=_1.endRow=_3}
if(_7<_6){var _8=_6;_6=_7;_7=_8;_1.startRow=_6;_1.endRow=_7}else if(_6==_7){_1.endRow=_7=_6+1}
if((_7-_6)>_3){_1.endRow=_7=_6+_3}
var _9=_1.data;if(isc.isAn.Object(_9)&&!isc.isAn.Array(_9)){var _10=_2&&isc.DS.get(_2);if(_10){if(_10.isAdvancedCriteria(_9)){_1.data=this.$268v(_9,_5)}else{}}}else{delete _1.data}
return _1},isc.A.$281g=function isc_c_AI__asyncAnswerEngineMakeQuery(_1,_2){var _3=this.$281i(_1),_4=_3.evalVars,_5=_2.dataSourceName,_6=_1.maxRecordsPerQuery;_4.dsName=_5;_4.queryPurpose=_2.queryPurpose;_4.queryDescription=_2.queryDescription;_4.advancedCriteriaFormatDescription=this.advancedCriteriaFormatDescription;_4.maxRecordsPerQuery=_6;_3.appendPrompts(this.makeQueryStepPrompts);var _7={cancellationController:_1.cancellationController,messages:_3.aiMessages,responseType:"object"};return this.asyncSendRequest(_7,_1.$261g).$2800(function(_9){var _8=_9.message.content;if(!isc.isAn.Object(_8))return isc.rejectWithError(this.aiNotAbleToProcessRequestErrorMessage);return this.$281v(_8,_5,_6)},null,this)},isc.A.$281s=function isc_c_AI__asyncAnswerEngineCreateDashboard(_1,_2){return isc.rejectWithError("not yet implemented")},isc.A.$281w=function isc_c_AI__getAnswerEngineCreateComponentMessagesBuilder(_1,_2){var _3=this.$281i(_1),_4=_3.evalVars,_5=_2.componentType;var _6;if(_5=="label"){_5="Label";_6=this.createDashboardComponentPrompts_labelCodePrompt}else{var _7=this.dataBoundUITypeInfos[_5];if(_7){_5=_7.componentType;_6=this.generalDataBoundUICodeNotes+"\n"+_7.codePrompt}}
_4.componentType=_5;_4.description=_2.description;_4.codePrompt=_6;_3.appendPrompts(this.createDashboardComponentPrompts_intro);return _3},isc.A.$281q=function isc_c_AI__asyncAnswerEngineCreateDashboardComponent(_1,_2){var _3=this.$281w(_1,_2);_3.appendPrompts(this.uiCodeSuffixPrompts);var _4={cancellationController:_1.cancellationController,messages:_3.aiMessages};return this.asyncSendRequest(_4,_1.$261g).$2800(function(_7){var _5=_7.message.content||"",_6=String.prototype.trim.call(this.extractFencedCode(_5));if(_6==""){return isc.rejectWithError("AI did not generate any UI code.")}
return _6},null,this)},isc.A.$281u=function isc_c_AI__asyncAnswerEngineFixDashboardComponent(_1,_2){var _3=_2.prevValidateDashboardComponentStepResults,_4=_3.length,_5=_1.dataQuestion.settings.maxFixAttempts!=null?_1.dataQuestion.settings.maxFixAttempts:this.defaultMaxFixAttempts;if(_4>_5){return isc.rejectWithError("AI did not generate valid UI code in "+_5+" attempts.")}
var _6=_3[_4-1],_7=this.$281w(_1,_2.createDashboardComponentStep),_8=_7.evalVars;_8.prevJSCode=_6.step.createDashboardComponentStepResult.jsCode;_8.validationErrors=_1.jsonEncoder.encode(_6.validationErrors);_7.appendPrompts(this.fixDashboardComponentPrompts);_7.appendPrompts(this.uiCodeSuffixPrompts);var _9={cancellationController:_1.cancellationController,messages:_7.aiMessages};return this.asyncSendRequest(_9,_1.$261g).$2800(function(_12){var _10=_12.message.content||"",_11=String.prototype.trim.call(this.extractFencedCode(_10));if(_11==""){return isc.rejectWithError("AI did not generate any UI code.")}
return _11},null,this)});isc.B._maxIndex=isc.C+15;isc.defineClass("AIFieldBuilder","SummaryBuilder");isc.A=isc.AIFieldBuilder.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.autoTest=false;isc.A.showFieldKey=false;isc.A.showHelpIcon=false;isc.A.showMessageLabel=false;isc.A.showAutoHideCheckBox=false;isc.A.builderTypeText="Description";isc.A.canEditAttributeName="canEditAISummary";isc.A.instructionsTextStart="Enter a description of what information you want to see in the field.  AI will receive the complete record and be asked to generate a value for the record in the field.<p>AI can do things like:<ul><li>text summarization (<q>give a two line summary of the abstract</q> or <q>list the applicant's top 3 skills</q> or <q>extract any urgent request within the message</q>)<li>sentiment analysis (<q>rate the customer's satisfaction on a scale of 1 (least satisfied) to 10 (most satisfied) based on their review</q>)<li>use common knowledge (<q>guess the contact's time zone</q>)</ul>";isc.A.initialAutoSuggestTitleHint="[use AI-generated title]";isc.A.pendingSuggestTitleHint="[generating a title]";isc.A.nonSuccessfulSuggestTitleHint="[failed to generate a title: ${message}]";isc.A.suggestedTitleHint="[AI-generated: ${suggestedTitle}]";isc.A.testButtonTitle="Try It";isc.A.testButtonHoverContents="Click to have AI generate a value from your description";isc.A.testButtonHoverContents_cantTest="You cannot try having AI generate a value at this time.";isc.A.testButtonHoverContents_cantTestWithoutData="Without data, you cannot try having AI generate a value.";isc.A.undeterminedResponsePrompt="<i>Could not determine an answer</i>";isc.A.autoSuggestTitle=true;isc.A.autoSuggestTitleDelay=500;isc.A.suggestTitleThreshold=20;isc.A.anotherSuggestedTitleRequestedCancellationReason="Another suggested title was requested.";isc.A.loadingIconSize=24;isc.A.loadingIconSrc="[SKINIMG]loadingSmall.gif";isc.A.loadingDivStyle="display:flex;align-items:center;justify-content:center;height:100%";isc.A.loadingMessage="<div style='${loadingStyle}'>${loadingImage}</div>";isc.B.push(isc.A.$2732=function isc_AIFieldBuilder__evalNonSuccessfulSuggestTitleHint(_1){return this.nonSuccessfulSuggestTitleHint.evalDynamicString(this,{message:_1&&_1.asHTML()})},isc.A.$2733=function isc_AIFieldBuilder__evalSuggestedTitleHint(_1){return this.suggestedTitleHint.evalDynamicString(this,{suggestedTitle:_1&&_1.asHTML()})},isc.A.$2734=function isc_AIFieldBuilder__getInitialTitleFieldHint(){var _1=this.getValue();if(_1==this.$49c&&this.$2735){return this.$2733(this.$2735)}
return!this.$2736()?null:this.initialAutoSuggestTitleHint},isc.A.$274l=function isc_AIFieldBuilder__getTestButtonHoverHTML(){if(this.$274m())return this.testButtonHoverContents;if(!this.getTestRecord())return this.testButtonHoverContents_cantTestWithoutData;return this.testButtonHoverContents_cantTest},isc.A.testButtonClick=function isc_AIFieldBuilder_testButtonClick(){this.requestTestSummary("user")},isc.A.$2736=function isc_AIFieldBuilder__shouldAutoSuggestTitle(){return this.autoSuggestTitle!=false},isc.A.setAutoSuggestTitle=function isc_AIFieldBuilder_setAutoSuggestTitle(_1){var _2=this.$2736();this.autoSuggestTitle=_1;var _3=this.$2736();if(_2==_3)return;this.setTitleFieldHint(this.$2734());if(!_3){this.cancelActionOnPause("suggestTitle")}else{this.$2737("application")}},isc.A.itemChanged=function isc_AIFieldBuilder_itemChanged(_1,_2){if(_1===this.formulaField){if(this.$2736()){this.fireOnPause("suggestTitle",{methodName:"$2737",args:["user"]},this.autoSuggestTitleDelay)}}else if(_1===this.titleField){if(!this.$2738()){this.setTitleFieldHint(this.$2734());var _3=this.$2739;if(_3&&!_3.canceled){_3.cancel(null,"user")}}}},isc.A.$274a=function isc_AIFieldBuilder__setLastValue(_1){if(_1!=this.$49c){this.$49c=_1;delete this.$2735;delete this.$2721}},isc.A.$2738=function isc_AIFieldBuilder__shouldSuggestTitle(_1){return _1&&_1.length>=this.suggestTitleThreshold&&(!this.titleField||!this.titleField.getValue())&&isc.AI.isEnabled()},isc.A.$2737=function isc_AIFieldBuilder__suggestTitle(_1){var _2=this.getValue();if(!this.$2738(_2)){this.setTitleFieldHint(this.$2734());return}
var _3=this.$2739;if(_3&&!_3.canceled){_3.cancel(this.anotherSuggestedTitleRequestedCancellationReason,_1)}
_3=this.$2739=this.$273x().createSubController();if(_2==this.$49c&&this.$2735)
{this.setTitleFieldHint(this.$2733(this.$2735));return}
this.setTitleFieldHint(this.pendingSuggestTitleHint);var _4=this;this.$274b(_2,_3).then(function(_8){var _5=_4.getValue();if(_2!=_5)return;_4.$274a(_2);_4.$2735=_8;_4.setTitleFieldHint(_4.$2734())},function(_8){var _6=isc.defaultAsyncOperationCatchCallback(_8);if(_6.type!="canceled"){var _7=isc.getAsyncMessage(_6);_4.logWarn("Failed to get a suggested title for the prompt '"+_2+"': "+_7,"AI");_4.setTitleFieldHint(_4.$2732(_7))}})},isc.A.$274b=function isc_AIFieldBuilder__asyncGetSuggestedTitle(_1,_2){if(_1==this.$49c&&this.$2735)
{return Promise.resolve(this.$2735)}
var _3=this.component,_4=this.field.name,_5;if(_4&&_3.getField(_4)){_5=[_4]}
var _6={cancellationController:_2,aiRequest:{prompt:_1},component:_3,excludeFieldNames:_5};return isc.AI.asyncSuggestRecordSummaryTitle(_6).then(function(_7){return _7.suggestedTitle})},isc.A.getUniqueFieldName=function isc_AIFieldBuilder_getUniqueFieldName(){return this.getNewUniqueFieldName("aiField")},isc.A.getCompleteValueObject=function isc_AIFieldBuilder_getCompleteValueObject(){var _1=this.getValue();var _2=this.titleField&&this.titleField.getValue(),_3=false,_4=false;if(!this.$2730()){_3=this.field._hasDefaultTitle;_4=this.field._hasSuggestedTitle;_2=this.field.title}
if((!_2||_3||(_4&&this.$273z()))&&_1==this.$49c&&this.$2735)
{_2=this.$2735;_3=false;_4=true}
var _5={title:_2,_hasDefaultTitle:_3,_hasSuggestedTitle:_4},_6=this.$2721||{prompt:_1};return isc.AI.applyAIFieldRequestToFieldDefaults(_6,_5)},isc.A.$2722=function isc_AIFieldBuilder__asyncGetAIFieldRequest(_1,_2,_3){if(_1==this.$49c&&this.$2721)
{return Promise.resolve(this.$2721)}
var _4={cancellationController:_3,userAIRequest:{prompt:_1},component:this.component,showProgressDialog:_2};return isc.AI.asyncBuildAIFieldRequest(_4).then(function(_5){return _5.aiFieldRequest})},isc.A.$274m=function isc_AIFieldBuilder__canTest(){return isc.AI.isEnabled()&&!!this.getTestRecord()},isc.A.requestTestSummary=function isc_AIFieldBuilder_requestTestSummary(_1){var _2=this.getTestRecord(),_3=this.getValue();if(!_3||!_2)return;var _4=this.$274d;if(_4&&!_4.canceled){_4.cancel(this.anotherTestRequestedCancellationReason,_1)}
_4=this.$274d=this.$273x().createSubController();this.showLoadingPrompt();if(this.testButton)this.testButton.disable();var _5=this;this.$2722(_3,false,_4).then(function(_7){var _6={cancellationController:_4,aiFieldRequest:_7,component:_5.component,records:[_2]};return isc.AI.asyncSummarizeRecords(_6).then(function(_10){_10.$2723=_7;return _10})}).$271y(function(_10){if(_10.type!="success"){if(_10.type!="canceled"){isc.warn("Failed to summarize the test record.<br>"+isc.getAsyncMessage(_10).asHTML())}
return}else _5.$102q(!_4.canceled);var _7=_10.$2723;var _8=!isc.AI.isAIFieldRequestNumerical(_7)?_10.recordSummaries:_10.recordNumericalSummaries;var _9=_8[0];if(_9==null){isc.warn(isc.AI.aiNotAbleToProcessRequestErrorMessage);return}
if(_7.valueClass=="ordinal"){_9=_7.categories[_9]}
_5.$274a(_3);_5.$2721=_7;_5.$48r=_2;_5.$2425=_9}).$271k(function(){if(_5.destroyed)return;_5.testFunction();if(_5.testButton)_5.testButton.enable()})},isc.A.getTitle=function isc_AIFieldBuilder_getTitle(){var _1=this.Super("getTitle",arguments);if(_1!=null)_1=String(_1).trim();return _1},isc.A.setInitialTitle=function isc_AIFieldBuilder_setInitialTitle(){var _1=this.field.title,_2=this.field._hasDefaultTitle,_3=this.field._hasSuggestedTitle;if(!_1){_1=isc.DataSource.getAutoTitle(this.field.name);_2=true;_3=false}
if(_1)_1=String(_1).trim();if(_3)this.$2735=_1;if(!(this.$2736()&&(_2||_3))){this.setTitle(_1)}
this.setTitleFieldHint(this.$2734())},isc.A.getValue=function isc_AIFieldBuilder_getValue(){var _1=this.Super("getValue",arguments);if(_1!=null)_1=String(_1).trim();return _1},isc.A.setInitialValue=function isc_AIFieldBuilder_setInitialValue(){var _1;if(this.field.aiFieldRequest&&isc.AIEngine.$272z(this.field.aiFieldRequest.promptType)){_1=this.field.aiFieldRequest.prompt;if(_1!=null)_1=String(_1).trim();this.$49c=_1;this.$2723=this.field.aiFieldRequest}
this.setValue(_1)},isc.A.save=function isc_AIFieldBuilder_save(){var _1=this.$273y;if(_1&&!_1.canceled){_1.cancel(this.userSavedCancellationReason,"user")}
var _2=this.getValue();if(!_2||!this.$273z()){return this.Super("save",arguments)}
if(this.editMode){isc.FieldGeneratorUtil.$275p(this.component,this.field,"user")}
var _3=this;this.$2722(_2,true,null).then(function(_4){_3.$274a(_2);_3.$2721=_4;_3.Super("save",arguments)},function(_4){if(_4.type!="canceled"){_3.completeEditing(true)}else{_3.logWarn("Failed to build the AIFieldRequest: "+isc.getAsyncMessage(_4),"AI")}})},isc.A.showLoadingPrompt=function isc_AIFieldBuilder_showLoadingPrompt(){var _1=this.loadingIconSize;this.sampleLabel.setContents(this.loadingMessage.evalDynamicString(this,{loadingStyle:this.loadingDivStyle,loadingImage:this.imgHTML(this.loadingIconSrc,_1,_1)}))});isc.B._maxIndex=isc.C+23;isc.AIFieldBuilder.changeDefaults("titleFieldDefaults",{showHintInField:true,autoFocus:false});isc.AIFieldBuilder.changeDefaults("formulaFormDefaults",{numCols:1,titleOrientation:"top",autoFocus:true});isc.A=isc.AIFieldBuilder;isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.buildDummyTestRecords=false;isc.B.push(isc.A.testFunction=function isc_c_AIFieldBuilder_testFunction(_1,_2,_3,_4,_5,_6,_7){var _8={};_8.component=_3;if(_2.text==""){_8.emptyTestValue=true;return _8}
_8.record=_6.$48r;_8.result=_6.$2425;return _8});isc.B._maxIndex=isc.C+1;isc.defineClass("AISortFieldBuilder","AIFieldBuilder");isc.A=isc.AISortFieldBuilder.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.titleFieldTitle="Title for sort field";isc.A.instructionsTextStart="Enter a description of what information you want to sort by.  AI will receive the complete record and be asked to generate a value for the record.<p>Some examples:<ul><li><q>guess how heavy the item is in pounds: 'Less than 1', '1-4', '5-10', 'More than 10'&#8201;</q><li><q>rate the customer's satisfaction on a scale of 1 (least satisfied) to 10 (most satisfied) based on their review</q><li><q>rate the item's usefulness in running a small bakery</q></ul>";isc.A.showSaveAddAnotherButton=false;isc.A.titleFormDefaults={_constructor:"DynamicForm",autoFocus:true,extraSpace:5,colWidths:[40,"*"]};isc.A.formulaFormDefaults={_constructor:"DynamicForm",numCols:1,titleOrientation:"top",extraSpace:5};isc.A.undeterminedResponsePrompt="<i>Could not determine a score</i>";isc.B.push(isc.A.save=function isc_AISortFieldBuilder_save(){this.Super("save",arguments);var _1=this.component.data;if(isc.isAn.Array(_1)||isc.isA.ResultSet(_1)&&_1.allMatchingRowsCached()){this.component.delayCall("$255x",[this.field.name],0)}else{isc.warn("Some records are not loaded.  Sort values will be computed as they are loaded, but you'll need to wait for that and sort on your own")}});isc.B._maxIndex=isc.C+1;isc.defineClass("BuildViaAIProgressDialog",isc.Dialog);isc.A=isc.BuildViaAIProgressDialog.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$2485="$2481";isc.A.autoDraw=false;isc.A.minWidth=150;isc.A.height=230;isc.A.minHeight=230;isc.A.autoSize=true;isc.A.isModal=true;isc.A.canDragResize=true;isc.A.canDragReposition=true;isc.A.showCloseButton=false;isc.A.title="Building via AI\u2026";isc.A.canCancel=false;isc.A.headerLabelDefaults=isc.addProperties({},isc.BuildViaAIProgressDialog.getSuperClass().getInstanceProperty("headerLabelDefaults"),{icon:"AIAssist"});isc.A.progressbarDefaults={_constructor:"Progressbar",length:50,breadth:10,layoutAlign:"center"};isc.A.message="";isc.A.messageLabelDefaults=isc.addProperties({},isc.BuildViaAIProgressDialog.getSuperClass().getInstanceProperty("messageLabelDefaults"),{height:25,align:"center"});isc.A.messagesGridDefaults={_constructor:"ListGrid",width:"100%",height:"100%",wrapCells:true,fixedRecordHeights:false,showHeader:false,showRollOver:false,selectionType:"none",cellPadding:0,defaultFields:[{name:"category",width:30,valueIcons:{"success":"ok","detail":"configure","recoverableError":"exclamation","error":"cancel"},showValueIconOnly:true,valueIconSize:16,valueIconLeftPadding:0,valueIconRightPadding:0,imageURLPrefix:"[SKINIMG]/actions/",imageURLSuffix:".png"},{name:"content",width:"*"}],drawn:function(){isc.Class.delayCall("scrollToBottom",[],1,this.body)}};isc.B.push(isc.A.initWidget=function isc_BuildViaAIProgressDialog_initWidget(){this.Super("initWidget",arguments);this.progressbar=this.createAutoChild("progressbar");this.messagesGrid=this.createAutoChild("messagesGrid");if(this.canCancel){this.setButtons([isc.Dialog.CANCEL])}},isc.A.createChildren=function isc_BuildViaAIProgressDialog_createChildren(){this.Super("createChildren",arguments);this.body.addMember(this.progressbar,0);this.body.addMember(this.messagesGrid,2)},isc.A.resized=function isc_BuildViaAIProgressDialog_resized(){if(this.destroyed)return;this.progressbar.setLength(this.messageLabel.getWidth()-4);isc.Class.delayCall("scrollToBottom",[],1,this.messagesGrid.body)},isc.A.setProgress=function isc_BuildViaAIProgressDialog_setProgress(_1,_2){if(this.destroyed)return;var _3=Math.max(0,Math.min(Math.floor(_1/_2*100),100));if(isNaN(_3))_3=0;this.progressbar.setPercentDone(_3);this.progressbar.setTitle("Completed "+_1+" out of an estimated "+_2+" step(s)");this.setMessage(_1+"\u2009/\u2009"+_2)},isc.A.addMessages=function isc_BuildViaAIProgressDialog_addMessages(_1){if(this.destroyed)return;if(_1!=null){for(var i=0;i<_1.length;++i){this.messagesGrid.addData(_1[i])}
if(this.messagesGrid.body!=null)isc.Class.delayCall("scrollToBottom",[],1,this.messagesGrid.body)}},isc.A.finish=function isc_BuildViaAIProgressDialog_finish(_1){if(this.destroyed)return;this.progressbar.disable();if(this.messageStack==null){this.messageStackProperties=isc.addProperties({},this.messageStackProperties,{disabled:true})}else{this.messageStack.disable()}
this.messagesGrid.setOpacity(60);if(!_1){this.show();this.setButtons([isc.Dialog.OK])}else{this.hide();this.destroy()}},isc.A.okClick=function isc_BuildViaAIProgressDialog_okClick(){if(this.destroyed)return;this.hide();this.destroy()},isc.A.cancelClick=function isc_BuildViaAIProgressDialog_cancelClick(){isc.AI.$265h(this.$266t,null,"user");if(this.destroyed)return;this.hide();this.destroy()});isc.B._maxIndex=isc.C+8;isc.defineClass("BuildUIViaAIProgressDialog",isc.BuildViaAIProgressDialog);isc.A=isc.BuildUIViaAIProgressDialog.getPrototype();isc.A.title="Building UI via AI&hellip;";isc.defineClass("FilterViaAIProgressDialog",isc.BuildViaAIProgressDialog);isc.A=isc.FilterViaAIProgressDialog.getPrototype();isc.A.title="Filtering via AI&hellip;";isc.defineClass("HiliteViaAIProgressDialog",isc.BuildViaAIProgressDialog);isc.A=isc.HiliteViaAIProgressDialog.getPrototype();isc.A.title="Hiliting via AI&hellip;";isc.defineClass("FilterViaAIPanel",isc.DynamicForm);isc.A=isc.FilterViaAIPanel.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.minWidth=400;isc.A.numCols=3;isc.A.colWidths=[130,"*","20%"];isc.A.fields=[{name:"prompt",title:"Filter via AI",width:"*",endRow:true},{type:"SpacerItem"},{name:"$268q",type:"StaticText",showTitle:false,canEdit:false,colSpan:2}];isc.B.push(isc.A.getPrompt=function isc_FilterViaAIPanel_getPrompt(_1){var _2=(_1?this.getOldValues().prompt:this.getValue("prompt"));if(_2)return _2.trim();else return""},isc.A.promptDidChange=function isc_FilterViaAIPanel_promptDidChange(){var _1=this.getPrompt(true),_2=this.getPrompt();return _1!=_2},isc.A.getUserAIRequest=function isc_FilterViaAIPanel_getUserAIRequest(){var _1=this.getPrompt();if(!_1)return null;return{prompt:_1}});isc.B._maxIndex=isc.C+3;isc.defineClass("AIWindow","Window");isc.A=isc.AIWindow.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$2485="$2481";isc.A.width=400;isc.A.autoCenter=true;isc.A.autoSize=true;isc.A.isModal=true;isc.A.canDragResize=true;isc.A.canDragReposition=true;isc.A.showMinimizeButton=false;isc.A.height=100;isc.A.showHeaderIcon=true;isc.A.bodyProperties={padding:10,layoutMargin:10,membersMargin:10};isc.A.title="AI Window";isc.A.description="Enter your question and click the button below to contact the AI.";isc.A.hint="Describe what you need here.";isc.A.grid=null;isc.A.labelDefaults={_constructor:"Label",width:"100%",height:1,contents:"",extraSpace:10};isc.A.formDefaults={_constructor:"DynamicForm",height:"*",autoFocus:true,cellPadding:0};isc.A.footerLayoutDefaults={_constructor:"HLayout",height:1,width:"100%",align:"bottom",defaultLayoutAlign:"center",membersMargin:10};isc.A.progressBarDefaults={_constructor:"Progressbar",width:"*",height:30,length:"*",showTitle:true,visibility:"hidden"};isc.A.cancelButtonTitle="Cancel";isc.A.cancelButtonDefaults={_constructor:"Button",autoFit:true,disabled:true,click:function(){this.creator.cancelWindow()},layoutAlign:"right"};isc.A.aiButtonTitle="Ask the AI";isc.A.aiButtonDefaults={_constructor:"Button",autoFit:true,click:function(){this.creator.tellTheAI()},layoutAlign:"right"};isc.B.push(isc.A.setMode=function isc_AIWindow_setMode(_1,_2,_3,_4,_5){this.mode=_1;if(_2)this.setTitle(_2);if(_3)this.label.setContents(_3);if(_4)this.form.getItem(0).setHint(_4);if(_5)this.aiButton.setTitle(_5)},isc.A.initWidget=function isc_AIWindow_initWidget(){this.headerIconDefaults.src="AIAnswerEngine:size:22,22;";this.Super("initWidget",arguments);this.addItem(this.addAutoChild("label",{contents:this.labelContents}));this.addItem(this.addAutoChild("form",{items:[{name:"userText",type:"textArea",minHeight:50,width:"*",height:"*",colSpan:"*",showTitle:false,hint:this.hint,showHintInField:true,keyPress:function(_1,_2,_3,_4){if(_3=="Enter"){this.form.creator.tellTheAI();return false}}}]}));this.addAutoChild("progressBar");this.addAutoChild("cancelButton",{title:this.cancelButtonTitle});this.addAutoChild("aiButton",{title:this.aiButtonTitle});this.addAutoChild("footerLayout",{members:[this.progressBar,isc.LayoutSpacer.create({width:1}),this.cancelButton,this.aiButton]});this.addItem(this.footerLayout,this.items.length)},isc.A.cancelWindow=function isc_AIWindow_cancelWindow(){if(this.$2658){this.$2658.cancel(null,"user");delete this.$2658}
this.resetUI()},isc.A.resetUI=function isc_AIWindow_resetUI(){this.aiButton.setDisabled(false);this.form.setDisabled(false);this.progressBar.setPercentDone(0);this.progressBar.hide();if(this.$2658){this.$2658.destroy();delete this.$2658}},isc.A.getPromptText=function isc_AIWindow_getPromptText(){return this.form.getValue("userText")},isc.A.setPromptText=function isc_AIWindow_setPromptText(_1){if(this.form)this.form.setValue("userText",_1)},isc.A.tellTheAI=function isc_AIWindow_tellTheAI(){var _1=this.form.getValue("userText");this.form.setDisabled(true);this.aiButton.setDisabled(true);this.cancelButton.setDisabled(false);this.progressBar.setPercentDone(0);this.progressBar.setTitle("Preparing&hellip;");this.progressBar.show();var _2=this.$2658=isc.CancellationController.create();var _3=this;if(this.mode=="filter"){if(!_1){_3.resetUI();_3.hide();this.grid.setAICriterion(null)}else{var _4={prompt:_1};this.grid.setUserAIFilterRequest(_4,{cancellationController:_2,showProgressDialog:false,progressCallback:function(_7,_8,_9,_10){_3.progressBar.setPercentDone(100*_8/_9);if(_8>0){_3.progressBar.setTitle(_8+"\u2009/\u2009"+_9)}}},function(_7){if(!_2.canceled){_3.resetUI();_3.hide();if(_7.type!="success"){isc.warn("Filter-via-AI failed: "+_7.errorMessage)}}})}}else if(this.mode=="hilite"){if(!_1){_3.resetUI();_3.hide();var _5=_3.grid.getHilites();if(_5&&_5.removeList(this.$271b)){this.grid.setHilites(_5)}}else{var _6={cancellationController:_2,userAIRequest:{prompt:_1},records:this.grid.$2642(),dataSource:this.grid.getDataSource(),mode:this.grid.hiliteViaAIMode,aiPageSize:this.grid.aiPageSize,showProgressDialog:false,progressCallback:function(_7,_8,_9,_10){_3.progressBar.setPercentDone(100*_8/_9);if(_8>0){_3.progressBar.setTitle(_8+"\u2009/\u2009"+_9)}}};isc.AI.buildHilites(_6,function(_7){if(!_2.canceled){_3.resetUI();_3.hide();if(_7.type!="success"){isc.warn("Hilite-via-AI failed: "+_7.errorMessage)}else if(_7.hilites){var _5=_3.grid.getHilites()||[];_5.removeList(_3.$271b);_5.addList(_3.$271b=_7.hilites);_3.grid.setHilites(_5)}}})}}else if(this.mode=="configure"){_3.resetUI();_3.hide();_3.grid.aiAssist(_1)}},isc.A.closeClick=function isc_AIWindow_closeClick(){this.cancelWindow();this.hide()});isc.B._maxIndex=isc.C+8;isc.defineClass("AISortProgressDialog","Window");isc.A=isc.AISortProgressDialog.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.autoCenter=true;isc.A.autoSize=true;isc.A.isModal=true;isc.A.showModalMask=true;isc.A.canDragResize=true;isc.A.canDragReposition=true;isc.A.autoParent=isc.Canvas.NONE;isc.A.visibility="hidden";isc.A.bodyDefaults={layoutMargin:10};isc.A.title="Please wait - Computing record sort values";isc.A.dismissButtonTitle="Dismiss";isc.A.progressbarDefaults={_constructor:"Progressbar",autoParent:isc.Canvas.NONE,length:"100%"};isc.A.dismissButtonDefaults={_constructor:"IButton",autoParent:isc.Canvas.NONE,layoutAlign:"center",click:function(){this.creator.hide()}};isc.A.bodyProperties={membersMargin:20};isc.B.push(isc.A.initWidget=function isc_AISortProgressDialog_initWidget(){this.Super("initWidget",arguments);this.addItems([this.addAutoChild("progressbar"),this.addAutoChild("dismissButton",{title:this.dismissButtonTitle})])},isc.A.hide=function isc_AISortProgressDialog_hide(){this.Super("hide",arguments);this.progressbar.setPercentDone(0);delete this.callback},isc.A.updateProgress=function isc_AISortProgressDialog_updateProgress(){this.progressbar.setPercentDone(100*this.currentRecords/this.totalRecords);if(this.currentRecords>=this.totalRecords){this.delayCall("$255u",[],0)}},isc.A.$255u=function isc_AISortProgressDialog__progressComplete(){this.fireCallback(this.callback);this.hide()},isc.A.advanceOneRecord=function isc_AISortProgressDialog_advanceOneRecord(){this.currentRecords++;this.updateProgress()},isc.A.setCurrentRecords=function isc_AISortProgressDialog_setCurrentRecords(_1){this.currentRecords=_1;this.updateProgress()},isc.A.setTotalRecords=function isc_AISortProgressDialog_setTotalRecords(_1){this.totalRecords=_1;this.updateProgress()},isc.A.isWaitingOnField=function isc_AISortProgressDialog_isWaitingOnField(_1){return this.isVisible()&&this.fieldName==_1},isc.A.deploy=function isc_AISortProgressDialog_deploy(_1,_2,_3){var _4=this.creator;if(this.isVisible()||this.callback){this.logWarn("The AI sort progress dialog for field "+_2+" of  component "+_4.getID()+" is still running; not cannot redeploy");return}
this.currentRecords=0;this.totalRecords=_1;this.fieldName=_2;this.callback=_3;this.show()});isc.B._maxIndex=isc.C+9;isc.ClassFactory.defineClass("AIAssistItem","TextItem");isc.A=isc.AIAssistItem.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.width="*";isc.A.colSpan="*";isc.A.hint=isc.AI.assistantHint;isc.A.showHint=true;isc.A.showHintInField=true;isc.A.prompt=isc.AI.assistantBlurb;isc.A.hoverAutoFitWidth=true;isc.A.hoverAutoFitMaxWidth=400;isc.A.icons=[{inline:true,src:"[SKINIMG]actions/help.png",click:function(_1,_2,_3){_2.sendPrompt(_1,_2)}}];isc.B.push(isc.A.keyPress=function isc_AIAssistItem_keyPress(_1,_2,_3,_4){if(_3=="Enter"){_1.sendPrompt(_2,_1);return false}},isc.A.sendPrompt=function isc_AIAssistItem_sendPrompt(_1,_2){var _3=_2.getValue();isc.AI.useAssistant(_3,{rootCanvas:_2.rootCanvas})});isc.B._maxIndex=isc.C+2;isc._nonDebugModules=(isc._nonDebugModules!=null?isc._nonDebugModules:[]);isc._nonDebugModules.push('AI');isc.checkForDebugAndNonDebugModules();isc._moduleEnd=isc._AI_end=(isc.timestamp?isc.timestamp():new Date().getTime());if(isc.Log&&isc.Log.logIsInfoEnabled('loadTime'))isc.Log.logInfo('AI module init time: '+(isc._moduleEnd-isc._moduleStart)+'ms','loadTime');delete isc.definingFramework;if(isc.Page)isc.Page.handleEvent(null,"moduleLoaded",{moduleName:'AI',loadTime:(isc._moduleEnd-isc._moduleStart)});}else{if(window.isc&&isc.Log&&isc.Log.logWarn)isc.Log.logWarn("Duplicate load of module 'AI'.");}/** AIModule End **/

